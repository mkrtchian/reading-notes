<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>The Design of Web APIs – Reading notes</title><meta name="robots" content="index,follow"/><meta name="description" content="My detailed reading notes from computer science books"/><meta property="og:title" content="The Design of Web APIs – Reading notes"/><meta property="og:description" content="My detailed reading notes from computer science books"/><meta name="theme-color" content="#111" media="(prefers-color-scheme: dark)"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/><style>
        :root {
          --nextra-primary-hue: 212deg;
          --nextra-primary-saturation: 100%;
          --nextra-navbar-height: 4rem;
          --nextra-menu-height: 3.75rem;
          --nextra-banner-height: 2.5rem;
        }
        
        .dark {
          --nextra-primary-hue: 204deg;
          --nextra-primary-saturation: 100%;
        }
      </style><meta name="msapplication-TileColor" content="#fff"/><meta http-equiv="Content-Language" content="en"/><meta name="description" content="My detailed reading notes from computer science books"/><meta property="og:title" content="Reading notes"/><meta property="og:description" content="My detailed reading notes from computer science books"/><meta name="apple-mobile-web-app-title" content="Reading notes"/><link rel="icon" type="image/x-icon" href="/reading-notes/favicon.ico"/><meta name="next-head-count" content="16"/><link rel="preload" href="/reading-notes/_next/static/css/e0ae992ef9be83da.css" as="style" crossorigin=""/><link rel="stylesheet" href="/reading-notes/_next/static/css/e0ae992ef9be83da.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/reading-notes/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/reading-notes/_next/static/chunks/webpack-94b934e1f7075309.js" defer="" crossorigin=""></script><script src="/reading-notes/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/reading-notes/_next/static/chunks/main-456465bb171feab1.js" defer="" crossorigin=""></script><script src="/reading-notes/_next/static/chunks/pages/_app-63a309e84f977e9c.js" defer="" crossorigin=""></script><script src="/reading-notes/_next/static/chunks/673-c9f6925171f8c938.js" defer="" crossorigin=""></script><script src="/reading-notes/_next/static/chunks/pages/books/the-design-of-web-apis-10614882e5944d52.js" defer="" crossorigin=""></script><script src="/reading-notes/_next/static/VVUuQo8BOBEVRgyHJwtVI/_buildManifest.js" defer="" crossorigin=""></script><script src="/reading-notes/_next/static/VVUuQo8BOBEVRgyHJwtVI/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div dir="ltr"><script>document.documentElement.setAttribute('dir','ltr')</script><div class="nextra-nav-container nx-sticky nx-top-0 nx-z-20 nx-w-full nx-bg-transparent print:nx-hidden"><div class="nextra-nav-container-blur nx-pointer-events-none nx-absolute nx-z-[-1] nx-h-full nx-w-full nx-bg-white dark:nx-bg-dark nx-shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] dark:nx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:nx-shadow-[0_0_0_1px_#000] contrast-more:dark:nx-shadow-[0_0_0_1px_#fff]"></div><nav class="nx-mx-auto nx-flex nx-h-[var(--nextra-navbar-height)] nx-max-w-[90rem] nx-items-center nx-justify-end nx-gap-2 nx-pl-[max(env(safe-area-inset-left),1.5rem)] nx-pr-[max(env(safe-area-inset-right),1.5rem)]"><a class="nx-flex nx-items-center hover:nx-opacity-75 ltr:nx-mr-auto rtl:nx-ml-auto" href="/reading-notes/"><img alt="Reading notes homepage" loading="lazy" width="30" height="30" decoding="async" data-nimg="1" style="color:transparent" src="/reading-notes/logo.png"/></a><div class="nextra-search nx-relative md:nx-w-64 nx-hidden md:nx-inline-block mx-min-w-[200px]"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div><a href="https://github.com/mkrtchian/reading-notes" target="_blank" rel="noreferrer" class="nx-p-2 nx-text-current"><svg width="24" height="24" fill="currentColor" viewBox="3 3 18 18"><title>GitHub</title><path d="M12 3C7.0275 3 3 7.12937 3 12.2276C3 16.3109 5.57625 19.7597 9.15374 20.9824C9.60374 21.0631 9.77249 20.7863 9.77249 20.5441C9.77249 20.3249 9.76125 19.5982 9.76125 18.8254C7.5 19.2522 6.915 18.2602 6.735 17.7412C6.63375 17.4759 6.19499 16.6569 5.8125 16.4378C5.4975 16.2647 5.0475 15.838 5.80124 15.8264C6.51 15.8149 7.01625 16.4954 7.18499 16.7723C7.99499 18.1679 9.28875 17.7758 9.80625 17.5335C9.885 16.9337 10.1212 16.53 10.38 16.2993C8.3775 16.0687 6.285 15.2728 6.285 11.7432C6.285 10.7397 6.63375 9.9092 7.20749 9.26326C7.1175 9.03257 6.8025 8.08674 7.2975 6.81794C7.2975 6.81794 8.05125 6.57571 9.77249 7.76377C10.4925 7.55615 11.2575 7.45234 12.0225 7.45234C12.7875 7.45234 13.5525 7.55615 14.2725 7.76377C15.9937 6.56418 16.7475 6.81794 16.7475 6.81794C17.2424 8.08674 16.9275 9.03257 16.8375 9.26326C17.4113 9.9092 17.76 10.7281 17.76 11.7432C17.76 15.2843 15.6563 16.0687 13.6537 16.2993C13.98 16.5877 14.2613 17.1414 14.2613 18.0065C14.2613 19.2407 14.25 20.2326 14.25 20.5441C14.25 20.7863 14.4188 21.0746 14.8688 20.9824C16.6554 20.364 18.2079 19.1866 19.3078 17.6162C20.4077 16.0457 20.9995 14.1611 21 12.2276C21 7.12937 16.9725 3 12 3Z"></path></svg><span class="nx-sr-only">GitHub</span><span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a><button type="button" aria-label="Menu" class="nextra-hamburger -nx-mr-2 nx-rounded nx-p-2 active:nx-bg-gray-400/20 md:nx-hidden"><svg fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" class=""><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16"></path></g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16"></path><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 18h16"></path></g></svg></button></nav></div><div class="nx-mx-auto nx-flex nx-max-w-[90rem]"><div class="motion-reduce:nx-transition-none [transition:background-color_1.5s_ease] nx-bg-transparent"></div><aside class="nextra-sidebar-container nx-flex nx-flex-col md:nx-top-16 md:nx-shrink-0 motion-reduce:nx-transform-none nx-transform-gpu nx-transition-all nx-ease-in-out print:nx-hidden md:nx-w-64 md:nx-sticky md:nx-self-start max-md:[transform:translate3d(0,-100%,0)]"><div class="nx-px-4 nx-pt-4 md:nx-hidden"><div class="nextra-search nx-relative md:nx-w-64"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div></div><div class="nx-overflow-y-auto nx-overflow-x-hidden nx-p-4 nx-grow md:nx-h-[calc(100vh-var(--nextra-navbar-height)-var(--nextra-menu-height))] nextra-scrollbar"><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100"><ul class="nx-flex nx-flex-col nx-gap-1 nextra-menu-desktop max-md:nx-hidden"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/">Introduction</a></li><li class="open"><button class="nx-items-center nx-justify-between nx-gap-2 nx-text-left nx-w-full nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">Reading notes<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-h-[18px] nx-min-w-[18px] nx-rounded-sm nx-p-0.5 hover:nx-bg-gray-800/5 dark:hover:nx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="nx-origin-center nx-transition-transform rtl:-nx-rotate-180 ltr:nx-rotate-90 rtl:nx-rotate-[-270deg]"></path></svg></button><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100 ltr:nx-pr-0 rtl:nx-pl-0 nx-pt-1"><ul class="nx-flex nx-flex-col nx-gap-1 nx-relative before:nx-absolute before:nx-inset-y-1 before:nx-w-px before:nx-bg-gray-200 before:nx-content-[&quot;&quot;] dark:before:nx-bg-neutral-800 ltr:nx-pl-3 ltr:before:nx-left-0 rtl:nx-pr-3 rtl:before:nx-right-0 ltr:nx-ml-3 rtl:nx-mr-3"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/accelerate/">Accelerate</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/continuous-discovery-habits/">Continuous Discovery Habits</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/designing-cloud-data-platforms/">Designing Cloud Data Platforms</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/designing-data-intensive-applications/">Designing Data-Intensive Applications</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/effective-kafka/">Effective Kafka</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/effective-typescript/">Effective TypeScript</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/get-your-hands-dirty-on-clean-architecture/">Get Your Hands Dirty on Clean Architecture</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/learning-domain-driven-design/">Learning Domain-Driven Design</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/learning-to-scale/">Learning to Scale</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/monolith-to-microservices/">Monolith to Microservices</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/no-rules-rules/">No Rules Rules</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/outcomes-over-output/">Outcomes Over Output</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/refactoring/">Refactoring: Improving the Design of Existing Code</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/reinventing-organizations/">Reinventing Organizations</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/team-topologies/">Team Topologies</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/test-driven-development-by-example/">Test-Driven Development: By Example</a></li><li class="nx-flex nx-flex-col nx-gap-1 active"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-bg-primary-100 nx-font-semibold nx-text-primary-800 dark:nx-bg-primary-400/10 dark:nx-text-primary-600 contrast-more:nx-border-primary-500 contrast-more:dark:nx-border-primary-500" href="/reading-notes/books/the-design-of-web-apis/">The Design of Web APIs</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/the-five-dysfunctions-of-a-team/">The Five Dysfunctions of a Team</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/turn-the-ship-around/">Turn the Ship Around!</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-400 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/unit-testing/">Unit Testing: Principles, Practices, and Patterns</a></li></ul></div></div></li></ul></div></div></div><div class="nx-sticky nx-bottom-0 nx-bg-white dark:nx-bg-dark nx-mx-4 nx-py-4 nx-shadow-[0_-12px_16px_#fff] nx-flex nx-items-center nx-gap-2 dark:nx-border-neutral-800 dark:nx-shadow-[0_-12px_16px_#111] contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-shadow-none nx-border-t" data-toggle-animation="off"><div class="nx-grow nx-flex nx-flex-col"><button title="Change theme" class="nx-h-7 nx-rounded-md nx-px-2 nx-text-left nx-text-xs nx-font-medium nx-text-gray-600 nx-transition-colors dark:nx-text-gray-400 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50" id="headlessui-listbox-button-:Rlsr6:" type="button" aria-haspopup="listbox" aria-expanded="false" data-headlessui-state=""><div class="nx-flex nx-items-center nx-gap-2 nx-capitalize"><svg fill="none" viewBox="3 3 18 18" width="12" height="12" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="currentColor" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><span class="">Light</span></div></button></div></div></aside><nav class="nextra-toc nx-order-last nx-hidden nx-w-64 nx-shrink-0 xl:nx-block print:nx-hidden nx-px-4" aria-label="table of contents"><div class="nextra-scrollbar nx-sticky nx-top-16 nx-overflow-y-auto nx-pr-4 nx-pt-6 nx-text-sm [hyphens:auto] nx-max-h-[calc(100vh-var(--nextra-navbar-height)-env(safe-area-inset-bottom))] ltr:-nx-mr-4 rtl:-nx-ml-4"><p class="nx-mb-4 nx-font-semibold nx-tracking-tight">On This Page</p><ul><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#1---what-is-api-design" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">1 - What is API design</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#2---designing-an-api-for-users" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">2 - Designing an API for users</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#3---designing-a-programming-interface" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">3 - Designing a programming interface</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#4---describing-an-api-with-an-api-description-format" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">4 - Describing an API with an API description format</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#5---designing-a-straightforward-api" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">5 - Designing a straightforward API</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#6---designing-a-predictable-api" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">6 - Designing a predictable API</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#7---designing-a-concise-and-well-organized-api" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">7 - Designing a concise and well-organized API</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#8---designing-a-secure-api" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">8 - Designing a secure API</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#9---evolving-an-api-design" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">9 - Evolving an API design</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#10---designing-a-network-efficient-api" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">10 - Designing a network-efficient API</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#11---designing-an-api-in-context" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">11 - Designing an API in context</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#12---documenting-an-api" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">12 - Documenting an API</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#13---growing-apis" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">13 - Growing APIs</a></li></ul><div class="nx-mt-8 nx-border-t nx-bg-white nx-pt-8 nx-shadow-[0_-12px_16px_white] dark:nx-bg-dark dark:nx-shadow-[0_-12px_16px_#111] nx-sticky nx-bottom-0 nx-flex nx-flex-col nx-items-start nx-gap-2 nx-pb-8 dark:nx-border-neutral-800 contrast-more:nx-border-t contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-border-neutral-400"><a href="https://github.com/mkrtchian/reading-notes/issues/new?title=Feedback%20for%20%E2%80%9CThe%20Design%20of%20Web%20APIs%E2%80%9D&amp;labels=feedback" target="_blank" rel="noreferrer" class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50">Question? Give me feedback →<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a><a class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50" href="https://github.com/mkrtchian/reading-notes/blob/main/pages/books/the-design-of-web-apis.mdx">Edit this page</a></div></div></nav><div id="reach-skip-nav"></div><article class="nx-w-full nx-break-words nextra-content nx-flex nx-min-h-[calc(100vh-var(--nextra-navbar-height))] nx-min-w-0 nx-justify-center nx-pb-8 nx-pr-[calc(env(safe-area-inset-right)-1.5rem)]"><main class="nx-w-full nx-min-w-0 nx-max-w-6xl nx-px-6 nx-pt-4 md:nx-px-12"><div class="nextra-breadcrumb nx-mt-1.5 nx-flex nx-items-center nx-gap-1 nx-overflow-hidden nx-text-sm nx-text-gray-500 dark:nx-text-gray-400 contrast-more:nx-text-current"><div class="nx-whitespace-nowrap nx-transition-colors nx-min-w-[24px] nx-overflow-hidden nx-text-ellipsis" title="Reading notes">Reading notes</div><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-w-3.5 nx-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg><div class="nx-whitespace-nowrap nx-transition-colors nx-font-medium nx-text-gray-700 contrast-more:nx-font-bold contrast-more:nx-text-current dark:nx-text-gray-100 contrast-more:dark:nx-text-current" title="The Design of Web APIs">The Design of Web APIs</div></div><h1 class="nx-mt-2 nx-text-4xl nx-font-bold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100">The Design of Web APIs</h1>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">1 - What is API design<a href="#1---what-is-api-design" id="1---what-is-api-design" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ici nous parlons des <strong>API web</strong>, c&#x27;est-à-dire utilisant le protocole <strong>HTTP</strong>.</li>
<li class="nx-my-2">Une API est dite <strong>publique</strong> quand elle est fournie comme service à une autre entreprise, et <strong>privée</strong> quand elle est fournie à des services internes.</li>
<li class="nx-my-2">Le design d&#x27;une API web doit être fait pour rendre la vie simple aux développeurs qui vont la consommer.</li>
<li class="nx-my-2">L&#x27;API doit <strong>cacher l&#x27;implémentation</strong>, et n&#x27;exposer que ce dont l&#x27;utilisateur a besoin.</li>
<li class="nx-my-2">L&#x27;API doit être <strong>intuitive</strong>, ressembler à ce à quoi on s&#x27;attendrait.</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">2 - Designing an API for users<a href="#2---designing-an-api-for-users" id="2---designing-an-api-for-users" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut comprendre les <strong>besoins de l&#x27;utilisateur</strong> de l&#x27;API pour designer une API qui y réponde, et non pas utiliser le point de vue du backend.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Éviter d&#x27;adopter le point de vue du créateur de l&#x27;API passe par :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>Éviter l&#x27;influence des structures de données</strong> côté backend. Si on expose exactement ce qui est en BDD c&#x27;est un signe qu&#x27;on n&#x27;adopte probablement pas le point de vue du consommateur.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut correctement nommer les choses, mais aussi introduire de l&#x27;abstraction pour masquer les détails qui n&#x27;intéressent pas le consommateur.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Éviter l&#x27;influence du code business</strong> côté backend. Si le consommateur n&#x27;a pas besoin de savoir ce qui se passe finement, on peut lui exposer une API grossière et faire ce qu&#x27;il faut dans l&#x27;implémentation, ce sera plus simple et plus sûr.</li>
<li class="nx-my-2"><strong>Éviter l&#x27;influence de l&#x27;architecture</strong> du backend. Par exemple, si le backend utilise une architecture séparée en services, le fait de faire apparaître cette même séparation interne sur l&#x27;API exposée n&#x27;est probablement pas une bonne idée. Il faut se concentrer sur le besoin du consommateur.</li>
<li class="nx-my-2"><strong>Éviter l&#x27;influence de l&#x27;organisation humaine</strong> du provider de l&#x27;API. Le fait que le provider soit structuré avec tels ou tels départements par exemple ne doit pas influencer l&#x27;API.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">En fait, il faut traiter les consommateurs de l&#x27;API vis-à-vis de celle-ci comme des utilisateurs finaux vis-à-vis du produit : on doit se demander <strong>ce que le consommateur veut, et de quelle manière il le veut</strong>. Ça revient à créer des User Stories du consommateur d&#x27;API.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les deux autres choses dont on a besoin sur les utilisateurs c&#x27;est <strong>les inputs et outputs</strong> : ce que l&#x27;utilisateur doit apporter, et ce dont il a besoin en retour lors de l&#x27;action.</li>
<li class="nx-my-2">Enfin, pour trouver des éléments manquants et compléter l&#x27;API, on va analyser <strong>d&#x27;où vont venir les inputs requis</strong>, et <strong>ce qui sera fait des outputs</strong>.</li>
<li class="nx-my-2">Autre question importante qui nous permettra d&#x27;être plus efficace : trouver qui sont nos utilisateurs.</li>
<li class="nx-my-2">L&#x27;<strong>API goals canvas</strong> est donc un tableau avec les cases suivantes :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Whos : les utilisateurs de l&#x27;API</li>
<li class="nx-my-2">Whats : Ce que les utilisateurs font</li>
<li class="nx-my-2">Hows : les étapes de ce qu&#x27;ils font</li>
<li class="nx-my-2">Inputs : ce dont ils ont besoin à chaque étape, et d&#x27;où ils l&#x27;ont</li>
<li class="nx-my-2">Outputs : ce qu&#x27;ils récupèrent à chaque étape, et ce qu&#x27;ils en feront</li>
<li class="nx-my-2">Goals : Reformulation concise du besoin</li>
</ul>
</li>
<li class="nx-my-2">Ce tableau ne peut pas être rempli à l&#x27;avance pour toute l&#x27;application. Il s&#x27;agit d&#x27;un processus itératif où on traite les fonctionnalités par petits bouts.</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">3 - Designing a programming interface<a href="#3---designing-a-programming-interface" id="3---designing-a-programming-interface" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">REST est une méthode de design d&#x27;API qui se calque sur HTTP. Il s&#x27;agit d&#x27;utiliser à chaque fois une <strong>action HTTP</strong> (par exemple GET), et <strong>un chemin identifiant une ressource</strong> (par exemple /product/123), et un <strong>contenu optionnel</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La réponse est un <strong>statut</strong> qui indique si la transaction s&#x27;est bien passée, et <strong>un contenu</strong>.</li>
</ul>
</li>
<li class="nx-my-2">Pour faire une API REST, il va s&#x27;agir de trouver les ressources à partir des API goals qu&#x27;on a pu analyser par exemple avec le canvas, et ensuite de leur attribuer des actions.</li>
<li class="nx-my-2">Quand on a plusieurs ressources citées dans un API goal, il faut identifier la ressource principale. C&#x27;est sur elle que porte l&#x27;action. L&#x27;autre n&#x27;étant en général qu&#x27;une information donnée dans le chemin ou le contenu additionnel de la requête.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Exemple : Rechercher des produits dans un catalogue avec une requête textuelle : c&#x27;est bien le catalogue qui est la ressource principale.</li>
</ul>
</li>
<li class="nx-my-2">Les chemins doivent refléter cette organisation, en ayant un nom compréhensible pour la ressource au début (/catalogue), suivi des paramètres.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La manière la plus standard de faire des chemins c&#x27;est d&#x27;avoir un nom pluriel pour les collections, suivi d&#x27;un identifiant d&#x27;une des ressources de cette collection :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">/ressources/{ressourceId}</code></li>
<li class="nx-my-2"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">/ressources/{ressourceId}/sub-ressources/{subRessourceId}</code></li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Si on a un paramètre à donner dans une requête qui doit simplement récupérer un résultat (par exemple faire une recherche), alors on utilise GET et on donne la chaîne de recherche dans un paramètre de l&#x27;URL.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ex : GET /products?free-query=blabla</li>
</ul>
</li>
<li class="nx-my-2">De même que le path et l&#x27;action de l&#x27;API doit être conçue selon les besoins du client et non pas selon la structure du backend, le contenu des données doit aussi être structuré dans ce but :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si certaines propriétés ne sont pas nécessaires au client pour son usage, on les supprime.</li>
<li class="nx-my-2">Si certaines propriétés seraient plus claires dans ce contexte sous un autre nom : on les renomme.</li>
</ul>
</li>
<li class="nx-my-2">Quand on ne sait pas quelle méthode REST choisir pour une action, par défaut on choisit <strong>POST</strong>.</li>
<li class="nx-my-2">Il est facile de faire correspondre une action métier avec une API REST, tant qu&#x27;on est dans du CRUD d&#x27;une ressource. Mais quand on veut faire des actions plus complexes, alors il faut faire des <strong>compromis</strong> entre la <strong>user-friendlyness</strong>, et la <strong>conformité avec le standard REST</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ex : Valider son panier peut être fait avec :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">POST /cart/check-out, ce qui est très user friendly, mais pas très conforme à la norme de manipulation de ressources de REST.</li>
<li class="nx-my-2">POST /orders, ce qui est plus conforme à REST mais on perd la notion métier de panier dans l&#x27;histoire.</li>
<li class="nx-my-2">En réalité il n&#x27;y a pas de “bonne solution”, il s&#x27;agit de faire un compromis. Il n&#x27;y a pas toujours de bonne API.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;architecture REST :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">a été élaborée par un thésard en 2000, et a depuis envahi l&#x27;univers des API réseau.</li>
<li class="nx-my-2">a été conçue spécifiquement pour les <strong>architectures distribuées</strong>, dont d&#x27;ailleurs l&#x27;architecture navigateur / serveur en est un rudiment. Il s&#x27;agit de favoriser l&#x27;efficacité, la stabilité, la scalabilité.</li>
<li class="nx-my-2">Pour être RESTful, il faut respecter ces 6 principes :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>Séparation Client / Serveur</strong></li>
<li class="nx-my-2"><strong>Statelessness</strong> : toute l&#x27;information d&#x27;une requête est contenue dans la requête. Le serveur ne conserve pas de session.</li>
<li class="nx-my-2"><strong>Cacheability</strong> : une réponse doit indiquer si elle peut être stockée par le client, et si oui pour combien de temps avant qu&#x27;il faille qu&#x27;il refasse la requête.</li>
<li class="nx-my-2"><strong>Layered system</strong> : quand le client interagit avec le serveur, il n&#x27;en voit qu&#x27;une couche, le reste est caché derrière l&#x27;API.</li>
<li class="nx-my-2"><strong>Code on demand</strong> (optionnel) : le serveur peut transférer du code exécutable au client, par exemple du JavaScript.</li>
<li class="nx-my-2"><strong>Uniform Interface</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Toutes les interactions se font au travers d&#x27;actions standardisées sur des ressources, et en fonction de l&#x27;état de ces ressources (qu&#x27;on obtient par GET, et qu&#x27;on modifie par PATCH etc.).</li>
<li class="nx-my-2">Les interactions doivent aussi fournir les metadata suffisantes pour comprendre la structure de ces états et ce qu&#x27;il est possible de faire aux ressources.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Si on se rend compte qu&#x27;un des paramètres d&#x27;une méthode de notre API ne peut pas être fournie par le client, alors c&#x27;est qu&#x27;on a sans doute oublié quelque chose… Il faut revoir l&#x27;API, ajouter une méthode etc.</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">4 - Describing an API with an API description format<a href="#4---describing-an-api-with-an-api-description-format" id="4---describing-an-api-with-an-api-description-format" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Décrire une API selon un format standardisé permet de la partager avec des êtres humains qui vont savoir la lire, et avec des outils automatisés qui pourront l&#x27;exploiter pour générer une documentation HTML, ou dans n&#x27;importe quel autre but.</li>
<li class="nx-my-2">L&#x27;OAS (Open API Specification) est un format ouvert, communautaire, et très utilisé pour REST.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Initialement la spécification s&#x27;appelait Swagger, mais elle a été renommée OpenAPI en 2016.</li>
<li class="nx-my-2">On peut utiliser JSON ou YAML pour écrire le document, mais Arnaud recommande YAML pour la lisibilité accrue pour les humains.</li>
<li class="nx-my-2">On édite le fichier à la main et on le versionne.</li>
<li class="nx-my-2">VSCode a une extension Swagger viewer qui aide à visualiser ce qu&#x27;on a écrit.</li>
</ul>
</li>
<li class="nx-my-2">Tips YAML :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour indiquer qu&#x27;il n&#x27;y a rien, il faut mettre des <!-- -->, par exemple quand il n&#x27;y a pas encore de paths : <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">paths: {}</code></li>
<li class="nx-my-2">Pour écrire une string multiligne, on met un | d&#x27;abord :<!-- -->
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="yaml" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">description</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-keyword)">|</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">blabla</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">blabla</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">Les noms de propriété doivent être des strings en YAML, donc il faut entourer les chiffres par des guillemets quand ils sont en propriété.</li>
</ul>
</li>
<li class="nx-my-2">Le format OpenAPI :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il ne faut pas hésiter à écrire des descriptions.</li>
<li class="nx-my-2">ex<!-- -->
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="yaml" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">paths</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">/objects</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">description</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">description du path</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">get</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">summary</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">résumé court de la méthode</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">description</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">résumé long de la méthode</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">responses</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-string-expression)">&quot;200&quot;</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">description</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">description de la réponse</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">content</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">application/json</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">schema</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-comment)"># et on décrit le schéma de la réponse</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">Dans le cas où une méthode GET prend un paramètre, ça se passe dans parameter :<!-- -->
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="yaml" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">get</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">parameters</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># il s&#x27;agit du nom qui va apparaître dans l&#x27;URL</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    - </span><span style="color:var(--shiki-token-keyword)">name</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">nom-du-parametre</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">description</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">description du paramètre</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># où se trouve le paramètre</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">in</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">query</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># caractère obligatoire ou non</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">required</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">false</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">schema</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-comment)"># type de données du paramètre</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">type</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">string</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">Même chose pour les <strong>path parameters</strong> quand un morceau du path est paramétrisé. Dans ce cas il faut l&#x27;indiquer entre accolades :<!-- -->
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="yaml" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">paths</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-token-string-expression)">/objects/{objectId}</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">delete</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">parameters</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        - </span><span style="color:var(--shiki-token-keyword)">name</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">objectId</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">in</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">path</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-comment)"># obligatoire, sinon ça ne compilera pas</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">required</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">true</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">schema</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">            </span><span style="color:var(--shiki-token-keyword)">type</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">string</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">Pour décrire les formats JSON attendus en entrée, ou en réponse, OpenAPI utilise la <strong>spécification JSON-schema</strong> :
Exemple pour <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">{prop1: &quot;&quot;, prop2: { prop2-1: &quot;&quot;}}</code>
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="yaml" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">type</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">object</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">description</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">une description de l&#x27;objet JSON</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">required</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">prop1</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">- </span><span style="color:var(--shiki-token-string-expression)">prop2</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">properties</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">prop1</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">type</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">string</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">description</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">description de prop1</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">example</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">Exemple de valeur</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">prop2</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">type</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">object</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">properties</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-string-expression)">prop2-1</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">type</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">string</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        </span><span style="color:var(--shiki-token-keyword)">example</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">Exemple de valeur</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">Pour les méthodes comme POST qui ont besoin de données en entrée, ça se fait dans <strong>requestBody</strong>, à côté de <strong>responses</strong>.</li>
</ul>
</li>
<li class="nx-my-2">On peut <strong>réutiliser des schémas</strong> JSON déjà définis pour éviter de les répéter dans notre fichier OpenAPI :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut renseigner le schéma à la racine du document, dans :<!-- -->
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="yaml" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">components</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">schemas</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">mon_objet</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">type</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">object</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">properties</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># [...]</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">Et ensuite on peut le référencer avec :<!-- -->
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="yaml" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">schema</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">$ref</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-comment)">#/components/schemas/mon_objet</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
</ul>
</li>
<li class="nx-my-2">On peut placer le mot-clé <strong>parameters</strong> non seulement au niveau des actions (get, post etc.), mais aussi un niveau au-dessus, au niveau des ressources (c&#x27;est-à-dire au niveau du path). Et alors à ce moment là ces paramètres s&#x27;appliquent à toutes les méthodes du path. Ça évite de les répéter, fût-ce avec un $ref.</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">5 - Designing a straightforward API<a href="#5---designing-a-straightforward-api" id="5---designing-a-straightforward-api" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Une des clés d&#x27;un design “straitforward” est de <strong>reproduire l&#x27;habitude des gens</strong>, et ça dans tous les domaines.</li>
<li class="nx-my-2">Il faut des noms de propriété clairs et évocateurs.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Éviter les abréviations (min ou max c&#x27;est OK parce que c&#x27;est entré dans la langue commune)</li>
<li class="nx-my-2">Éviter les détails techniques qu&#x27;on peut retrouver autrement (ex. type de variable booléenne)</li>
<li class="nx-my-2">Éviter ce qui n&#x27;intéresse pas le consommateur de manière générale.</li>
<li class="nx-my-2">Essayer de ne pas dépasser 3 mots dans un nom quel qu&#x27;il soit.</li>
</ul>
</li>
<li class="nx-my-2">Il faut des <strong>formats de données bien choisis</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple le format ISO 8601 pour une date.</li>
<li class="nx-my-2">Adopter le point de vue du consommateur :
<code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">&quot;type&quot;: &quot;checking&quot;</code> plutôt que <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">&quot;type&quot;: 1</code></li>
</ul>
</li>
<li class="nx-my-2">Il faut aussi que les données qu&#x27;on donne soient pertinentes pour le consommateur.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ne pas hésiter à <strong>ajouter des données</strong> pour que le consommateur ait ce qu&#x27;il lui faut déjà préparé.</li>
</ul>
</li>
<li class="nx-my-2">A propos des erreurs :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut bien distinguer 3 types d&#x27;erreurs par leur type :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">erreur de format parmi les paramètres fournis</li>
<li class="nx-my-2">erreur fonctionnelle</li>
<li class="nx-my-2">erreur interne du serveur</li>
</ul>
</li>
<li class="nx-my-2">Pour une erreur interne, en général la seule chose qu&#x27;a besoin de savoir l&#x27;utilisateur c&#x27;est qu&#x27;il y a eu une erreur et que ce n&#x27;est pas de sa faute.</li>
<li class="nx-my-2">En HTTP, les codes <strong>4XX</strong> concernent les erreurs causés par l&#x27;utilisateur, alors que les codes <strong>5XX</strong> concernent les erreurs sur lesquelles l&#x27;utilisateur n&#x27;a pas d&#x27;influence.</li>
<li class="nx-my-2">Le code de statut ne suffit pas. Il faut aussi donner d&#x27;autres informations, <strong>à la fois du texte pour les êtres humains, et des informations pour les machines</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour les machines ça peut être un string représentant un type d&#x27;erreur précis, une valeur d&#x27;ID etc.</li>
</ul>
</li>
<li class="nx-my-2">Dans le cas où il y a plusieurs erreurs, il vaut mieux <strong>les signaler toutes</strong> dans la même réponse.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si les erreurs sont de plusieurs types (par ex données mal formées et erreur fonctionnelle), on peut utiliser le code de retour 400 qui est générique.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Pour les messages de succès c&#x27;est comme pour les erreurs :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Bien renseigner le bon code <strong>2XX</strong></li>
<li class="nx-my-2">Donner des informations supplémentaires, comme par exemple retourner l&#x27;objet qu&#x27;on vient de créer avec son ID générée.</li>
</ul>
</li>
<li class="nx-my-2">Il faut regarder le flow dans son ensemble, et repérer ce dont l&#x27;utilisateur d&#x27;API a besoin pour lui éviter des erreurs qui seraient de son fait.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Une fois qu&#x27;on a repéré les choses dont il aurait besoin, on les lui fournit avec une API pour lui faciliter le travail.</li>
<li class="nx-my-2">Ne pas hésiter à agréger des données ensemble dans une API, si ça peut aider le consommateur à consulter une autre API en évitant des erreurs<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple lui fournir les éléments qui ont <em>une particularité</em> plutôt que bruts, pour qu&#x27;il puisse les utiliser dans une autre API qui a besoin en paramètre d&#x27;un élément qui a <em>la particularité</em>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">6 - Designing a predictable API<a href="#6---designing-a-predictable-api" id="6---designing-a-predictable-api" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut rester <strong>consistant au sein de l&#x27;API</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans le nommage et le format des différents paramètres dans notre API.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ex : si on a choisi <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">accountNumber</code> quelque part, on ne le change pas en juste <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">number</code> dans un des autres endpoints.</li>
<li class="nx-my-2">Et si c&#x27;était un nombre, ça reste un nombre.</li>
</ul>
</li>
<li class="nx-my-2">Entre les différents paths de nos API endpoints.</li>
<li class="nx-my-2">Dans la structure des données prises en paramètre ou renvoyées.</li>
<li class="nx-my-2">Dans les flows permis par les différents API endpoints.</li>
</ul>
</li>
<li class="nx-my-2">En plus de la consistance au sein de l&#x27;API, il faut respecter la consistance au sein de <strong>l&#x27;organisation</strong>, au sein du <strong>domaine métier</strong>, et enfin avec ce qui est partagé par le <strong>reste du monde</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ne pas hésiter à utiliser des standards ISO et autres.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">TIP : chercher “&lt;some data&gt; standard” ou “&lt;some data&gt; format” sur google.</li>
</ul>
</li>
<li class="nx-my-2">Ne pas hésiter à copier ce que fait une autre API connue, les utilisateurs se sentiront chez eux et tout le monde sera gagnant.</li>
</ul>
</li>
<li class="nx-my-2">Il faut formaliser les règles choisies pour l&#x27;API dans un document (cf. chapitre 13), au risque de les oublier et de faire perdre à l&#x27;API peu à peu sa consistance.</li>
<li class="nx-my-2">Il peut être intéressant de rendre l&#x27;API <strong>adaptable</strong> aux besoins de l&#x27;utilisateur :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Un même endpoint peut proposer d&#x27;envoyer les données sous <strong>plusieurs formats</strong>, par ex CSV et JSON.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut utiliser un paramètre dans l&#x27;URL : <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">/ressource?format=csv</code></li>
<li class="nx-my-2">Et on peut aussi utiliser un header HTTP fait pour ça : <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Accept: text/csv</code>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si le serveur ne peut pas répondre dans ce format, il peut renvoyer le code <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">406 Not Acceptable</code>.</li>
</ul>
</li>
<li class="nx-my-2">A contrario, quand c&#x27;est le client qui envoie par exemple du contenu XML, il peut le spécifier avec le header <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">HTTP Content-type: application/xml</code>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si le serveur ne comprend pas ce format, il peut répondre <strong><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">415 Unsupported Media</code></strong>.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">De la même manière que pour les formats, un endpoint peut supporter <strong>plusieurs langues</strong> (traduction des phrases, système de mesure etc.).<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut là aussi tirer avantage du protocole HTTP en utilisant ses headers :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Accept-Language: en-US</code> pour dire qu&#x27;on accepte l&#x27;anglais US.</li>
<li class="nx-my-2"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Content-Language: en-US</code> pour dire que le body sera en anglais US.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Enfin on peut aussi permettre à l&#x27;utilisateur des fonctionnalités de <strong>pagination, de filtrage ou d&#x27;ordre des éléments</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le plus courant est d&#x27;utiliser des paramètres dans l&#x27;URL :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">/ressources?page=3&amp;sort=-amount&amp;category=car</code></li>
</ul>
</li>
<li class="nx-my-2">Pour la pagination on pourrait penser au header HTTP <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Range: items=10-19</code> qui dit qu&#x27;on veut les items du 10ème au 19ème.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Il peut être très pratique le notre API soit <strong>discoverable</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut faire ça à l&#x27;aide de <strong>metadata</strong> qu&#x27;on place dans le body. Par exemple, si on renvoie du contenu paginé, avoir un attribut “pagination” qui va donner la page actuelle et le nombre total de pages, pour aider l&#x27;utilisateur.</li>
<li class="nx-my-2">On peut aussi ajouter des URLs pour aider l&#x27;utilisateur à faire ses prochaines requêtes d&#x27;API : ça fait des <strong>hypermedia API</strong>. Par exemple pour la pagination, ajouter en plus un attribut <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">next</code> et un <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">last</code> avec en valeur les URLs permettant d&#x27;obtenir ces pages.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il s&#x27;agit d&#x27;une certaine manière de faire la même chose qu&#x27;avec les pages web et leurs liens, mais avec les APIs.</li>
<li class="nx-my-2">Usuellement, les URLs vers le reste de l&#x27;API sont mis dans des attributs nommés <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">href</code>, <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">links</code>, ou <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">_links</code>.</li>
<li class="nx-my-2">Plusieurs spécifications ont été créées sur la manière d&#x27;organiser ces URLs d&#x27;API, parmi eux HAL, Collection+JSON, JSON API, JSON-LD, Hydra et Siren.</li>
</ul>
</li>
<li class="nx-my-2">Un des moyens d&#x27;obtenir des informations sur un endpoint est d&#x27;utiliser la méthode HTTP <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">OPTIONS</code>, qui devrait renvoyer les autres méthodes disponibles sur cet endpoint, mais aussi des informations sur le format, ou encore des URLs vers d&#x27;autres endpoints utiles liés.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Attention cependant à bien documenter ce qu&#x27;on implémente dans notre API, les utilisateurs sont rarement des experts du protocole HTTP…</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">7 - Designing a concise and well-organized API<a href="#7---designing-a-concise-and-well-organized-api" id="7---designing-a-concise-and-well-organized-api" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut bien <strong>organiser</strong> son API :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Organiser les <strong>données</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple en groupant les propriétés liées entre elles ensemble, côte à côte ou même au sein d&#x27;un objet.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans le cas où une propriété est optionnelle, et qu&#x27;une autre propriété n&#x27;a de sens que si la première est utilisée, les grouper dans un objet serait une bonne idée.</li>
</ul>
</li>
<li class="nx-my-2">En classant les propriétés des plus importantes aux moins importantes à mesure qu&#x27;on descend</li>
</ul>
</li>
<li class="nx-my-2">Organiser le <strong>feedback</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Quand des erreurs se produisent, on peut les catégoriser avec un type précis avec un système d&#x27;enums (en plus du statut HTTP).</li>
<li class="nx-my-2">Et on peut les classer de la plus importante à la moins importante.</li>
</ul>
</li>
<li class="nx-my-2">Organiser les <strong>API endpoints</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut les grouper par catégorie fonctionnelle dans notre document OpenAPI, pour plus de clarté.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Et dans chaque catégorie, classer du plus important au moins important.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Il faut bien <strong>dimensionner</strong> ses endpoints :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Bien réfléchir au <strong>nombre de propriétés</strong> d&#x27;une structure de données, et à la <strong>profondeur d&#x27;imbrication</strong> en fonction de son cas d&#x27;usage.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour la profondeur, il est recommandé de ne pas dépasser 3 niveaux.</li>
</ul>
</li>
<li class="nx-my-2">Bien réfléchir aux endpoints eux-mêmes et à la <strong>complexité</strong> qu&#x27;ils peuvent embarquer pour l&#x27;utilisateur :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, un endpoint qui permet d&#x27;avoir des infos sur un compte en banque, et qui donne en même temps la liste de toutes les transactions du compte sera probablement surchargé inutilement si l&#x27;utilisateur veut juste les infos sur le compte.</li>
<li class="nx-my-2">Il vaut mieux s&#x27;assurer que <strong>notre endpoint ne fait pas 2 choses très différentes</strong> (ou plus) en même temps.</li>
</ul>
</li>
<li class="nx-my-2">Le dimensionnement dépend en fait du contexte et doit être optimisé pour l&#x27;expérience utilisateur des consommateurs. En général, les petites unités fonctionnent mieux qu&#x27;un énorme couteau suisse.</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">8 - Designing a secure API<a href="#8---designing-a-secure-api" id="8---designing-a-secure-api" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Une des techniques utilisées couramment pour sécuriser des API web est le framework <strong>OAuth</strong> 2.0.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">il faut enregistrer des <strong>consumers</strong>.</li>
</ol>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ca peut se faire par exemple sur un portail de développement où on va se connecter, payer ce qu&#x27;il faut etc.</li>
<li class="nx-my-2">Quand on enregistre le consumer, on va lui attribuer des <strong>scopes</strong> d&#x27;autorisation, qui vont correspondre à la possibilité d&#x27;accéder à un certain nombre d&#x27;API endpoints et de méthodes.</li>
</ul>
</li>
<li class="nx-my-2">
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6" start="2">
<li class="nx-my-2">le <strong>client</strong> consumer va pouvoir demander un token au <strong>serveur d&#x27;authentification</strong>.</li>
</ol>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;utilisateur final propriétaire entre ses identifiants sur la page du serveur d&#x27;authentification, et après vérification le serveur d&#x27;authentification envoie le token au client.</li>
<li class="nx-my-2">Il existe d&#x27;autres flows possibles dans OAuth.</li>
</ul>
</li>
<li class="nx-my-2">
<ol class="nx-mt-6 nx-list-decimal first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6" start="3">
<li class="nx-my-2">Le client va pouvoir consommer l&#x27;API en fournissant à chaque fois le token.</li>
</ol>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">A chaque requête, le serveur qui a les ressources va valider auprès du serveur d&#x27;authentification que le token est valide et possède les bons scopes d&#x27;autorisation.</li>
<li class="nx-my-2">Le serveur de ressources a connaissance du user ID et du scope d&#x27;autorisation attaché au token, et donc va pouvoir éventuellement <strong>filtrer le contenu</strong> avant de le renvoyer ce que spécifie l&#x27;API.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;ID de l&#x27;utilisateur et les scopes attachés à son compte ne sont en général pas dans le body de la requête ou les paramètres d&#x27;URL, mais sont pourtant là de par l&#x27;authentification initiale. Il est donc intéressant de remarquer qu&#x27;un même API endpoint peut <strong>renvoyer différentes données en fonction de l&#x27;utilisateur qui y fait appel</strong>.</li>
<li class="nx-my-2">Selon l&#x27;organisation internationale OWASP, il faut <strong>réduire la surface d&#x27;attaque</strong> pour réduire le risque. Et donc il faut éviter de donner la possibilité de faire certaines actions à des utilisateurs qui n&#x27;en ont pas besoin.</li>
<li class="nx-my-2">Comment bien définir les <strong>scopes d&#x27;autorisation</strong> ?<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut choisir la bonne <strong>granularité</strong> : un scope par endpoint et méthode c&#x27;est très flexible mais très complexe à configurer pour les utilisateurs, et si on a trop peu de scopes on risque d&#x27;être obligé de donner trop de pouvoir à certains utilisateurs.</li>
<li class="nx-my-2">On peut par exemple partir de l&#x27;API goals canvas qui nous a permis de construire notre API en fonction des besoins de l&#x27;utilisateur qu&#x27;on a définis, et regrouper sous un même scope les actions qui concernent un même flow.</li>
<li class="nx-my-2">On peut aussi avoir des scopes arbitraires, comme un scope “admin” qui a accès à tout.</li>
<li class="nx-my-2">Il existe plusieurs manières de définir des scopes et pas de solution magique, et la bonne manière dépend en fait du contexte.</li>
<li class="nx-my-2">On peut aussi définir plusieurs granularités en même temps : des scopes grossiers mais faciles à configurer, et des scopes plus fins. L&#x27;utilisateur pourra alors utiliser un mélange et configurer plus finement les parties qu&#x27;il veut.</li>
</ul>
</li>
<li class="nx-my-2">OpenAPI permet de spécifier des scopes pour chaque endpoint/méthode défini :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ca se fait dans components -&gt; securitySchemes<!-- -->
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="yaml" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">components</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">securitySchemes</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">BankingAPIScopes</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">type</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">oauth2</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">flows</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">implicit</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">authorizationURL</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;https://...&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">scopes</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-string-expression)">&quot;beneficiary:read&quot;</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">List beneficiaries</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-string-expression)">&quot;beneficiary:manage&quot;</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">Create, list beneficiaries</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">Et ensuite on les indique dans nos paths existants :<!-- -->
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="yaml" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">paths</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">/beneficiaries</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">get</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">description</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">Get beneficiaries list</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">security</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    - </span><span style="color:var(--shiki-token-keyword)">BankingAPIScopes</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        - </span><span style="color:var(--shiki-token-string-expression)">&quot;beneficiary:read&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">        - </span><span style="color:var(--shiki-token-string-expression)">&quot;beneficiary:manage&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">responses</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-string-expression)">…</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
</ul>
</li>
<li class="nx-my-2">Toujours dans l&#x27;optique de réduire la surface d&#x27;attaque, il faut <strong>identifier les données sensibles</strong> et ne pas les fournir quand ce n&#x27;est pas nécessaire.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, quand on obtient les informations d&#x27;un compte, on peut donner par défaut les autres infos mais pas le numéro du compte, ou seulement les 4 derniers chiffres.</li>
<li class="nx-my-2">Quand il faut les fournir quand même, ou quand il faut fournir une action avec des conséquences jugées sensibles, alors on peut y faire attention et utiliser des techniques pour s&#x27;assurer qu&#x27;elles sont protégées :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Isoler l&#x27;action sensible dans un <strong>endpoint dédié</strong> qu&#x27;on va pouvoir mieux protéger, dans le cas où il y a une vraie différence de nature entre la version sensible et la version non sensible d&#x27;un point de vue utilisateur.</li>
<li class="nx-my-2">Utiliser un <strong>scope dédié</strong>, pour que par défaut la donnée sensible ne soit pas retournée ou actionnée, et le soit si le scope d&#x27;autorisation est activé.</li>
<li class="nx-my-2">Se baser sur les <strong>permissions de l&#x27;utilisateur</strong> qui fait l&#x27;appel pour ne dévoiler la donnée sensible qu&#x27;à certaines personnes.</li>
<li class="nx-my-2">Et enfin on peut <strong>combiner</strong> l&#x27;access control de l&#x27;utilisateur et du consommateur (scope) pour être sûr qu&#x27;il s&#x27;agit de la bonne personne (et non pas d&#x27;une personne qui a une délégation par exemple) et qu&#x27;elle le fait dans un cadre où elle a la permission de le faire.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Concernant le feedback lié à la sécurité, quand on demande quelque chose auquel on n&#x27;a pas accès, on peut recevoir une réponse <strong><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">401 Unauthorized</code></strong> si on n&#x27;est pas correctement authentifié, ou <strong><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">403 Forbidden</code></strong> si les scopes qui nous sont associés ne sont pas suffisants pour qu&#x27;on fasse l&#x27;action.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Attention à ne pas dévoiler inutilement des informations : il vaut parfois mieux renvoyer systématiquement <strong><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">404 Not Found</code></strong> plutôt qu&#x27;un 403 même si la donnée existe, pour éviter qu&#x27;un attaquant essaye de nombreuses données et puisse savoir lesquelles existent même s&#x27;il n&#x27;a pas les autorisations d&#x27;y accéder.</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">9 - Evolving an API design<a href="#9---evolving-an-api-design" id="9---evolving-an-api-design" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Quand on change notre API, il faut surtout éviter les <strong>breaking changes</strong>, c&#x27;est-à-dire ce qui obligerait les consommateurs à changer leur code pour ne pas que leur application casse.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Sur les <strong>données en sortie</strong> de l&#x27;API :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il ne faut pas :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Enlever, modifier ou déplacer des propriétés.</li>
<li class="nx-my-2">Modifier le format / type d&#x27;une donnée.</li>
<li class="nx-my-2">Augmenter la taille d&#x27;une chaîne qui était limitée.</li>
<li class="nx-my-2">Rendre optionnelle une propriété qui était obligatoire.</li>
<li class="nx-my-2">Ajouter des valeurs à un enum.</li>
</ul>
</li>
<li class="nx-my-2">En revanche on peut :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ajouter des propriétés, optionnelles ou obligatoires.</li>
<li class="nx-my-2">Rendre obligatoire une propriété qui ne l&#x27;était pas.</li>
<li class="nx-my-2">Diminuer la taille maximale de chaînes limitées.</li>
</ul>
</li>
<li class="nx-my-2">Une des possibilités c&#x27;est d&#x27;ajouter des données déjà existantes dans de nouvelles propriétés, mais sous une autre forme. Ça peut par contre avoir des limites dans la mesure où ça complique aussi l&#x27;API.</li>
</ul>
</li>
<li class="nx-my-2">Sur les <strong>données en entrée</strong> et les paramètres :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">C&#x27;est pareil que pour les données en entrée, sauf :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut rendre optionnelle une propriété qui était obligatoire, mais pas l&#x27;inverse.</li>
<li class="nx-my-2">On peut augmenter la taille maximale d&#x27;une chaîne et pas la diminuer.</li>
<li class="nx-my-2">On peut ajouter des valeurs à un enum.</li>
<li class="nx-my-2">Si on ajoute une propriété, il faut qu&#x27;elle soit optionnelle.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Sur le <strong>feedback</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le feedback peut être traité comme des données de sortie.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On ne peut donc pas ajouter un élément à un enum d&#x27;erreurs existant.</li>
</ul>
</li>
<li class="nx-my-2">Pour les codes de statut HTTP, la spécification dit que les clients sont censés au moins comprendre les classes d&#x27;erreur (2XX, 4XX, 5XX etc.), et donc que s&#x27;ils rencontrent une erreur qu&#x27;ils ne savent pas gérer (par ex 429), ils doivent se rabattre sur l&#x27;erreur par défaut de la classe (par ex 400).<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans la réalité, les clients ne vont pas forcément suivre la spec, et n&#x27;importe quel changement de feedback pourrait les impacter (sauf peut être d&#x27;enlever un code d&#x27;erreur qui ne peut plus arriver). Donc si on peut éviter d&#x27;introduire de nouvelles erreurs avec des clients qu&#x27;on connait pas, c&#x27;est mieux.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Sur les <strong>endpoints et les flows d&#x27;appels</strong> eux-mêmes :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Renommer le path d&#x27;un endpoint est en théorie possible en renvoyant <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">301 Moved Permanently</code> sur l&#x27;ancien path, mais dans les faits les clients ne vont pas forcément le prendre en compte et se retrouver en état d&#x27;erreur.</li>
<li class="nx-my-2">On ne peut pas non plus enlever des endpoints sans casser les clients.</li>
<li class="nx-my-2">On peut en ajouter, mais à condition que ça ne change pas les flows existants.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, si on ajoute un endpoint de validation qui devra être appelé juste après un ancien endpoint pour améliorer la sécurité, les clients non mis à jour ne l&#x27;appelleront pas, et auront des échecs &quot;silencieux&quot;, parce que le flow aura changé.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Même sans changer le contrat d&#x27;API, on peut quand même casser les clients par des changements d&#x27;apparence anodins du <strong>contrat invisible</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La loi de Hyrum dit : <em>“With a sufficient number of users of an API, it does not matter what you promise in the contract: all observable behaviors of your system will be depended on by somebody”</em>.</li>
</ul>
</li>
<li class="nx-my-2">Les breaking changes sont bien plus graves sur les API publiques. Sur les API privées on peut en général se débrouiller pour mettre à jour les clients. Mais c&#x27;est quand même un poids non négligeable, qui doit nous amener à nous poser la question pour chaque breaking change, de savoir si on le veut vraiment.</li>
<li class="nx-my-2">Quand les breaking changes deviennent inévitables, on peut <strong>versionner son API</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le semantic versioning classique des implémentations (Major.Minor.patch) pourrait se transcrire dans l&#x27;univers des API par une version à 2 chiffres : <strong>Breaking.Non-breaking</strong>.</li>
<li class="nx-my-2">Pour créer les nouvelles versions, on peut :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Utiliser l&#x27;URL (blabla.com/apiv2/) ou les sous-domaines (v2.blabla.com/api/). C&#x27;est ce qui est le plus courant.</li>
<li class="nx-my-2">Ajouter des paramètres aux requêtes, que ce soit dans l&#x27;URL, dans le header HTTP ou autre. Mais globalement cette option-là est moins claire, et moins appréciée des consommateurs.</li>
<li class="nx-my-2">Utiliser le fait que l&#x27;utilisateur de l&#x27;API est identifié, et donc stocker côté provider une association UserID / Version. C&#x27;est plus simple pour le consommateur qui n&#x27;a rien à faire de son côté à part demander à passer à la V2, mais moins flexible aussi.</li>
</ul>
</li>
<li class="nx-my-2">Il est possible de versionner avec une plus grande granularité que l&#x27;API entière, par exemple ajouter une V2 seulement pour certains endpoints, seulement certaines méthodes, ou encore donner la possibilité de visionner le contenu du body avec des headers HTTP.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Mais c&#x27;est peu connu des consommateurs, surtout dans le monde de REST, et ça peut porter à confusion. Donc bien réfléchir avant d&#x27;aller par là.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Pour éviter d&#x27;avoir à faire des breaking changes, on peut essayer dès le début d&#x27;avoir des structures <strong>extensibles</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, prendre l&#x27;habitude d&#x27;<strong>encapsuler dans un objet</strong> toute propriété qui nous paraît importante va nous permettre d&#x27;y ajouter des propriétés par la suite.</li>
<li class="nx-my-2">Si on a des propriétés similaires, il peut être judicieux de les <strong>mettre dans une liste</strong> ou un objet, pour pouvoir facilement les étendre plus tard.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par ex si on a une date de début, de fin, on peut les mettre dans une liste d&#x27;événements, pour peut être plus tard ajouter une date d&#x27;exécution comme élément de liste supplémentaire.</li>
</ul>
</li>
<li class="nx-my-2">Utiliser des formats de données standard permet aussi de baisser le risque de vouloir les changer plus tard.</li>
<li class="nx-my-2">Concernant les erreurs, les mettre dans une liste, avec chacune dans son objet permet de les rendre extensibles, et de pouvoir en ajouter aussi.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La propriété <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">type</code> correspondant à un enum indiquant le type d&#x27;erreur doit être le plus générique possible parce qu&#x27;on ne peut pas changer les enums sans breaking change.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ex : <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">MISSING_MANDATORY_ATTRIBUTE</code>, plutôt que <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">MISSING_AMOUNT</code> si la propriété manquante était un amount.</li>
</ul>
</li>
<li class="nx-my-2">Autre exemple : l&#x27;auteur conseille de ne pas retourner d&#x27;erreur si l&#x27;utilisateur demande 150 résultats par page et que le maximum est de 100, mais d&#x27;en retourner simplement 100. Et plus tard, si on veut abaisser ce maximum à 50, on ne provoquera pas non plus d&#x27;erreurs chez les clients.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Bien sûr, si l&#x27;utilisateur veut transférer 1500€ et qu&#x27;il a 1000€, il ne faut pas faire le transfert de 1000€ silencieusement, quand ça concerne le domaine métier ce genre de choix doit être réfléchi avec soin :)</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Plus l&#x27;API va grossir, et plus l&#x27;étendre va devenir difficile sans casser soit les données, soit les flows. Une bonne pratique est de garder les API petites, et d&#x27;en faire plusieurs autonomes.</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">10 - Designing a network-efficient API<a href="#10---designing-a-network-efficient-api" id="10---designing-a-network-efficient-api" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le “design idéal” d&#x27;API est contrebalancé par des facteurs supplémentaires à prendre en compte. L&#x27;un d&#x27;entre eux est la performance réseau. Il faut trouver un <strong>compromis</strong> entre les deux.</li>
<li class="nx-my-2">Les problèmes de performance réseau dépendent :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">de la vitesse du réseau</li>
<li class="nx-my-2">du volume de données échangée</li>
<li class="nx-my-2">du nombre d&#x27;appels API</li>
</ul>
</li>
<li class="nx-my-2">Il y a d&#x27;abord des <strong>optimisations au niveau du protocole</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La <strong>compression</strong> et les <strong>connexions persistantes</strong> sont disponibles par défaut dans HTTP, et peuvent être activées dès le début.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La compression permet de <strong>réduire les données échangées</strong></li>
<li class="nx-my-2">Les connexions persistantes permettent de réutiliser les mêmes connexions pour plusieurs requêtes, pour <strong>gagner de la latence</strong>.</li>
</ul>
</li>
<li class="nx-my-2">Chaque endpoint/méthode peut renvoyer des métadonnées indiquant combien de temps la réponse doit être <strong>mise en cache</strong> (donc conservée sans refaire d&#x27;appel API) par le client.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour le protocole HTTP ça se fait avec le header <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Cache-Control</code>.</li>
<li class="nx-my-2">Pour choisir la valeur on se base sur le contexte au cas par cas : est-ce qu&#x27;il est probable statistiquement que telle donnée soit changée dans l&#x27;heure ? Dans les 10 mn ? Est-ce que c&#x27;est important d&#x27;avoir des données très à jour sur telle ou telle donnée ?</li>
</ul>
</li>
<li class="nx-my-2">En plus du cache on peut aussi utiliser les <strong>requêtes conditionnelles</strong> : cette fois il s&#x27;agira pour le backend de soit retourner la donnée si elle a été modifiée depuis la dernière fois, soit une simple réponse <strong><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">304 Not Modified</code></strong> sans rien dans le body.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On gagne en bande passante.</li>
<li class="nx-my-2">Le mécanisme consiste à ce que le backend envoie un <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Etag</code> dans le header HTTP la première fois, et que ce tag soit renvoyé par le client pour les prochaines fois. Le backend peut alors savoir si depuis cet Etag la donnée a changé ou non. Si elle a changé, il renverra un nouvel Etag pour la prochaine fois.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Mais on peut aussi optimiser l&#x27;utilisation réseau grâce à des <strong>techniques de design d&#x27;API</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Permettre la <strong>pagination</strong> et le <strong>filtrage</strong> est une des panières d&#x27;envoyer moins de données à la fois.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans le cas d&#x27;une pagination, si des éléments sont ajoutés au fur et à mesure et qu&#x27;on veut garder une fiabilité et une exhaustivité de ce qui est affiché, on peut demander les X prochains éléments à partir de l&#x27;élément qui a tel ID, plutôt que juste la page 2.</li>
</ul>
</li>
<li class="nx-my-2">Bien <strong>choisir les propriétés</strong> pour les <strong>éléments d&#x27;une liste</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut trouver une balance entre trop de propriétés (voir toutes) quand on fait GET sur une ressource sans préciser laquelle, et pas assez de propriétés. Dans un cas on a beaucoup de données quelle que soit l&#x27;utilisation, dans l&#x27;autre on peut se retrouver à devoir refaire un GET mais cette fois avec l&#x27;ID de chaque objet, pour obtenir le détail avec les propriétés qui nous intéressent.</li>
<li class="nx-my-2">La solution est de trouver les propriétés qui sont souvent utiles quand on traite une liste d&#x27;objets, et les ajouter à la réponse de l&#x27;API de liste.</li>
<li class="nx-my-2">Une autre solution serait d&#x27;accepter un paramètre ou un header HTTP (par ex <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Accept:application/notre.content.type.custom+json</code>), et de renvoyer la version courte, complète, ou même enrichie en propriétés en fonction de ce qui est demandé par le client.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Agréger des données</strong> venant de ressources différentes dans une même réponse d&#x27;API. Il s&#x27;agit de dénormalisation de données dans l&#x27;API.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ça peut permettre d&#x27;économiser des appels d&#x27;API.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple en obtenant dans un même appel le profil d&#x27;une personne, et la liste de ses adresses qui sont d&#x27;habitude dans une ressource séparée.</li>
</ul>
</li>
<li class="nx-my-2">Mais c&#x27;est à manipuler avec précaution :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">D&#x27;abord c&#x27;est pas sûr que ça nous fasse économiser du temps dans tous les cas : parfois une énorme requête peut prendre plus de temps que plusieurs en parallèle, ou même être plus fragile sur des réseaux lents (type 3G), et donc plus souvent sujette à être retentée de zéro.</li>
<li class="nx-my-2">Ensuite ça peut être plus difficile à mettre en cache, sachant que le temps de cache sera alors celui de la ressource contenue dans l&#x27;agrégation qui a le temps de vie le plus court.
Donc mauvaise idée de grouper une ressource qui change peu souvent et une ressource qui change très souvent dans un même endpoint.</li>
</ul>
</li>
<li class="nx-my-2">On peut aussi le faire de l&#x27;<strong>expansion</strong> à la demande avec un paramètre : dénormaliser les données des propriétés indiquées par le client, si c&#x27;est possible.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Même exemple que le profil avec ses adresses, sauf que le client ajoute un paramètre <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">/profile?expand=addresses</code></li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Permettre le <strong>querying côté client</strong> avec des API du type <strong>GraphQL</strong>. Les clients indiquent alors chaque propriété qu&#x27;ils veulent parmi celles disponibles pour une même ressource.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">C&#x27;est utile quand le réseau est vraiment important pour nous, et que chaque milliseconde compte.</li>
<li class="nx-my-2">Par contre GraphQL utilise uniquement la méthode POST sur un unique endpoint HTTP, donc les mécanismes de cache usuels qu&#x27;on peut mettre en place avec les API REST et les headers HTTP (<code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Cache-Control</code> etc.) ne marchent pas.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;éventuelle mise en cache doit être gérée par le client plutôt qu&#x27;un niveau du protocole, mais c&#x27;est de toute façon assez compliqué étant donné qu&#x27;on fait en fait de l&#x27;agrégation dans tous les sens.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">De manière générale, revenir aux bases et <strong>envoyer aux utilisateurs ce dont ils ont besoin</strong> peut probablement permettre de réduire les appels réseau. Que ce soit avec de l&#x27;agrégation, l&#x27;ajout d&#x27;une propriété ici ou là, l&#x27;ajout de nouveaux endpoints spécifiques pour pour des besoins précis etc.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Mais comme toujours il faut trouver le bon compromis. En créant trop d&#x27;endpoints personnalisés on risque aussi d&#x27;obtenir une API compliquée et pas très réutilisable. Une solution peut être alors de créer des <strong>couches d&#x27;API intermédiaires</strong> consommant l&#x27;API initiale, et fournissant des endpoints spécifiques à un contexte donné.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, les <strong>BFF (Backend For Frontend)</strong> sont des API qui vont consommer des API de données plus génériques, et fournir des endpoints personnalisés pour répondre exactement aux besoins du frontend qu&#x27;ils ont en charge.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">11 - Designing an API in context<a href="#11---designing-an-api-in-context" id="11---designing-an-api-in-context" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La nature des informations et de la relation provider / consumer peut lourdement influencer le design d&#x27;API. On peut avoir parfois besoin d&#x27;une <strong>communication initiée par le provider</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Exemple : une transaction initiée par le client est acceptée tout de suite (donc réponse <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">202 Accepted</code>), mais doit ensuite être validée puis exécutée, et ça peut prendre des minutes, heures voire jours.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le client peut faire des appels réguliers pour voir où ça en est, et le header <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">Cache-Control</code> peut donner au client une idée de la fréquence à laquelle faire ces appels.</li>
<li class="nx-my-2">Pour autant, il est hors de question que le client patiente pendant des heures ou des jours en faisant des appels réguliers, c&#x27;est trop inefficace.</li>
</ul>
</li>
<li class="nx-my-2">La solution peut être la mise en place d&#x27;un <strong>webhook</strong> côté client.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il s&#x27;agit d&#x27;une API HTTP, standardisée par le provider (pour que ce ne soit pas l&#x27;anarchie) et mise en place par le client, et dont le client a donné l&#x27;URL au provider au moment de souscrire pour avoir un token et pouvoir consommer l&#x27;API du provider.</li>
<li class="nx-my-2">Une fois que la transaction a été exécutée, le provider va alors faire un appel POST sur ce webhook, en donnant les infos de l&#x27;événement qui s&#x27;est produit. Ce backend maintenu par le client peut alors utiliser les moyens nécessaires pour envoyer l&#x27;info au téléphone, ou au navigateur (par des mécanismes push, des websockets, du simple polling HTTP de la part du navigateur etc.).</li>
<li class="nx-my-2">Attention à penser à la sécurité du webhook. Une des possibilités c&#x27;est d&#x27;en faire un event assez générique qui va pousser le client à faire une autre requête pour obtenir les infos détaillées de l&#x27;event.</li>
<li class="nx-my-2">Ce système de webhooks est standardisé par le W3C sous le nom <strong>WebSub</strong>.</li>
</ul>
</li>
<li class="nx-my-2">Dans le cas où c&#x27;est le client qui veut obtenir des <strong>updates très fréquents</strong> pendant un certain temps, et pour éviter qu&#x27;il fasse des calls permanents, il peut faire un appel qui initie une communication <strong>SSE (Server-Sent Events)</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les SSE se basent sur HTTP, et ont été standardisés par le W3C pour HTML5, donc fonctionnent très bien avec les navigateurs.</li>
<li class="nx-my-2">La connexion HTTP reste ouverte, et le serveur peut simplement envoyer des données dès qu&#x27;il les a, jusqu&#x27;à ce que l&#x27;un des deux demande à fermer la connexion.</li>
<li class="nx-my-2">Par contre c&#x27;est unidirectionnel : c&#x27;est le serveur qui envoie les données.</li>
</ul>
</li>
<li class="nx-my-2">Si on veut une <strong>connexion bidirectionnelle</strong> (par exemple pour les chats), on peut recourir aux <strong>WebSockets</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les WebSockets ne se basent pas sur HTTP mais directement sur TCP, donc la mise en place peut être plus compliquée vis-à-vis des proxies et autres.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Parfois, pour économiser des requêtes on peut vouloir faire des <strong>PATCH, PUT, POST ou DELETE sur une liste d&#x27;éléments</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il suffit d&#x27;envoyer en body une liste d&#x27;objets avec la même information qu&#x27;on aurait donné pour faire l&#x27;opération sur un seul élément.</li>
<li class="nx-my-2">Côté réponse, dans un cas comme ça on peut valider les éléments qui réussissent même si certains ont échoué.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut retourner une liste avec là aussi la réponse qu&#x27;on aurait renvoyé pour chaque élément seul : le statut, la ou les erreurs éventuelles ou le contenu pour chaque élément.</li>
<li class="nx-my-2">Le statut de la réponse HTTP peut être alors <strong><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">207 Multi-Status</code></strong>.</li>
<li class="nx-my-2">Attention à bien vérifier que dans notre cas valider certains éléments et avoir des éléments sur d&#x27;autres ne crée pas d&#x27;incohérence.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Le type d&#x27;API qu&#x27;on utilise doit être choisi en fonction du contexte, à la fois celui du consumer parce que l&#x27;API est pour lui, et celui du provider parce qu&#x27;il a aussi des contraintes. Il faut éviter de céder au <strong>biais de choisir l&#x27;outil ou le format qu&#x27;on connaît le mieux</strong> à chaque fois.</li>
<li class="nx-my-2">Actuellement il y a 3 types d&#x27;API connues : <strong>REST</strong>, <strong>GraphQL</strong> et <strong>gRPC</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">REST étant de loin le plus connu, et répondant à la plupart des besoins, il est considéré comme celui à prendre par défaut si on n&#x27;a pas de contraintes particulières. Les autres peuvent aussi être très bien en fonction du contexte.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">REST est basé sur les <strong>ressources</strong> et suit le protocole HTTP de très près. Il est le plus standardisé, et permet de profiter nativement des fonctionnalités de HTTP (content-negotiation, caching, requêtes conditionnelles etc.).</li>
<li class="nx-my-2">La gestion d&#x27;erreur est standardisée : 4XX, 5XX.</li>
</ul>
</li>
<li class="nx-my-2">gRPC (g pour Google, et RPC pour Remote Procedure Call) consiste à <strong>appeler des fonctions</strong> dans son code en leur donnant des paramètres. Ces fonctions sont complètement custom de la part du provider, et ne se basent pas sur un modèle comme les ressources pour REST.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il est en général utilisé avec des données formatées en <strong>protobuf</strong> (à la place de JSON), qui est un format binaire et ne répétant pas le nom de chaque propriété contrairement à JSON (donc peut diviser par presque 2 la taille des données transférées). Par contre c&#x27;est moins connu que JSON, et moins facile à afficher / débugger parce que binaire.</li>
<li class="nx-my-2">Il est construit par dessus HTTP mais n&#x27;utilise pas la plupart de ses fonctionnalités comme REST. Par contre, il permet les communications bidirectionnelles grâce à HTTP2.</li>
<li class="nx-my-2">Il a un format standard d&#x27;erreurs inspiré de REST, et pas de mécanisme standard de caching.</li>
<li class="nx-my-2">Il faut l&#x27;utiliser plutôt que REST quand on a une API <strong>privée vers client privé</strong> (communication entre services d&#x27;un même backend), quand les millisecondes gagnées importent vraiment.</li>
</ul>
</li>
<li class="nx-my-2">GraphQL adopte le même <strong>modèle basé sur les fonctions</strong> que gRPC pour la création/modification, par contre pour le querying il a un <strong>modèle basé sur les données</strong> : c&#x27;est l&#x27;utilisateur qui spécifie non seulement les propriétés qu&#x27;il veut, mais aussi avec quel autre donnée il veut faire un lien etc.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour le query l&#x27;utilisateur a une grande flexibilité, mais il est aussi en capacité de demander <strong>des requêtes extrêmement complexes et coûteuses</strong>. Le rate-limiting peut ne pas suffire pour se protéger parce qu&#x27;on ne peut pas prévoir ce que le client va faire.</li>
<li class="nx-my-2">Il est agnostique niveau protocole, et est utilisé la plupart du temps par dessus HTTP avec des POST sur un endpoint unique.</li>
<li class="nx-my-2">Il a un format standard d&#x27;erreurs qui consiste à donner un texte d&#x27;erreur, et la ligne qui a causé l&#x27;erreur dans la requête GraphQL et la propriété problématique dans la donnée en réponse (si une réponse partielle a pu être faite).</li>
<li class="nx-my-2">Il n&#x27;a pas de mécanisme standard pour le caching, et celui-ci est difficile étant donné la flexibilité des données.</li>
<li class="nx-my-2">Il faut aller vers GraphQL plutôt que REST quand on est dans un contexte d&#x27;<strong>API privée</strong> et alimentant des <strong>périphériques mobiles</strong> qui ont besoin d&#x27;économiser la quantité de données échangée.</li>
</ul>
</li>
<li class="nx-my-2">A noter qu&#x27;on peut tout à fait avoir par ex une API BFF spécialisée qui expose du GraphQL pour les mobiles, et qui consomme une API REST ou gRPC plus générique dans notre backend.</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">12 - Documenting an API<a href="#12---documenting-an-api" id="12---documenting-an-api" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Créer une documentation est une manière de tester le design : si on est incapable de l&#x27;expliquer c&#x27;est qu&#x27;il y a peut être des incohérences.</li>
<li class="nx-my-2">Dans la documentation d&#x27;une API, il faut bien évidemment <strong>une référence des endpoints possibles</strong>. Typiquement le genre de documentation qu&#x27;on peut générer à partir d&#x27;une spécification OpenAPI.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour fournir plusieurs exemples dans OpenAPI :<!-- -->
<div class="nextra-code-block nx-relative nx-mt-6 first:nx-mt-0"><pre class="nx-bg-primary-700/5 nx-mb-4 nx-overflow-x-auto nx-rounded-xl nx-subpixel-antialiased dark:nx-bg-primary-300/10 nx-text-[.9em] contrast-more:nx-border contrast-more:nx-border-primary-900/20 contrast-more:nx-contrast-150 contrast-more:dark:nx-border-primary-100/40 nx-py-4" data-language="yaml" data-theme="default"><code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr" data-language="yaml" data-theme="default"><span class="line"><span style="color:var(--shiki-token-keyword)">requestBody</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword)">content</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-string-expression)">&quot;application/json&quot;</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-comment)">#...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">  </span><span style="color:var(--shiki-token-keyword)">examples</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">premierExemple</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-comment)"># ...</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">deuxiemeExemple</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">summary</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">Résumé du 2ème exemple</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">description</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">Description du 2ème exemple</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">    </span><span style="color:var(--shiki-token-keyword)">value</span><span style="color:var(--shiki-token-keyword)">:</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">prop1</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;blablabla&quot;</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">prop2</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-constant)">3</span></span>
<span class="line"><span style="color:var(--shiki-color-text)">      </span><span style="color:var(--shiki-token-keyword)">prop3</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-color-text)"> </span><span style="color:var(--shiki-token-string-expression)">&quot;bliblibli&quot;</span></span></code></pre><div class="nx-opacity-0 nx-transition [div:hover&gt;&amp;]:nx-opacity-100 focus-within:nx-opacity-100 nx-flex nx-gap-1 nx-absolute nx-m-[11px] nx-right-0 nx-top-0"><button class="nextra-button nx-transition-all active:nx-opacity-50 nx-bg-primary-700/5 nx-border nx-border-black/5 nx-text-gray-600 hover:nx-text-gray-900 nx-rounded-md nx-p-1.5 dark:nx-bg-primary-300/10 dark:nx-border-white/10 dark:nx-text-gray-400 dark:hover:nx-text-gray-50 md:nx-hidden" title="Toggle word wrap"><svg viewBox="0 0 24 24" width="24" height="24" class="nx-pointer-events-none nx-h-4 nx-w-4"><path fill="currentColor" d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button></div></div>
</li>
<li class="nx-my-2">Les outils comme ReDoc sont même capables de générer des exemples de données JSON complets à partir des types et formats déclarés dans la spécification OpenAPI.</li>
<li class="nx-my-2">Il faut décrire ce que fait chaque endpoint, les données qu&#x27;il prend et renvoie, mais aussi chaque cas possible de réponse de réussite ou d&#x27;erreur. Et ne pas oublier la sécurité (scopes, autorisations). Tout ça se fait dans OpenAPI.</li>
<li class="nx-my-2">A propos de l&#x27;idée de générer la documentation à partir du code (avec éventuellement un format OpenAPI automatique intermédiaire) versus maintenir le fichier OpenAPI à la main :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;avantage c&#x27;est la synchronisation plus facile entre le code et la doc.</li>
<li class="nx-my-2">Les inconvénients sont surtout le manque de flexibilité : la documentation finale contiendra moins de choses si tout vient du code. Et le risque que l&#x27;API ait plus tendance à exposer le point de vue du provider, ce qu&#x27;on souhaite éviter.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Il faut aussi un <strong>guide utilisateur</strong> qui va expliquer l&#x27;API d&#x27;un point de vue global, les principes généraux, comment éventuellement s&#x27;inscrire pour avoir un token etc.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour le coup cette partie doit être écrite à la main, par exemple en markdown.</li>
<li class="nx-my-2">On y ajoute des cas d&#x27;usage détaillés, qui seront le reflet de l&#x27;API goal canvas qu&#x27;on a utilisé pour designer notre API : telle personne a besoin de telle et telle info pour pour faire telle chose + le détail des infos qu&#x27;elle donne, les API calls, les réponses qu&#x27;elle reçoit.</li>
<li class="nx-my-2">On peut aussi y ajouter les choses communes à l&#x27;API comme le type de pagination utilisée, les formats de données et plus généralement les headers HTTP supportés etc.</li>
</ul>
</li>
<li class="nx-my-2">Il peut être utile d&#x27;avoir une <strong>documentation spécifique pour les développeurs de l&#x27;implémentation</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Elle peut contenir des choses que les consommateurs n&#x27;ont pas besoin de savoir, et qui sont liées à la manière dont l&#x27;API s&#x27;intègre avec l&#x27;implémentation. Par exemple des infos sur d&#x27;où vient telle ou telle propriété dans le système, des liens vers des formats pour aider à implémenter etc.</li>
</ul>
</li>
<li class="nx-my-2">Et enfin il faut un <strong>changelog</strong> listant pour chaque version ce qui est ajouté/modifié, et surtout les breaking changes.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">OpenAPI ne permet pas de faire de changelog, mais il permet d&#x27;ajouter une propriété <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10" dir="ltr">deprecated: true</code> sur les paramètres, les endpoints, les propriétés.</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">13 - Growing APIs<a href="#13---growing-apis" id="13---growing-apis" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">A partir du moment où plusieurs personnes travaillent sur l&#x27;API, ou qu&#x27;il y a plusieurs APIs dans l&#x27;organisation, il y a de fortes chances pour que de l&#x27;incohérence s&#x27;installe entre APIs et au sein d&#x27;une API. Il faut pour ça rédiger des <strong>API guidelines</strong> à destination des designers d&#x27;API.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il y a 3 parties :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il y a d&#x27;abord les <strong>reference guidelines</strong> qui sont le minimum : le document décrit quelles méthodes, codes de statut, headers sont utilisés couramment dans l&#x27;API, le format des ressources (la structure de leur path), la structure habituelle des données, la manière dont la pagination est gérée etc.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On y définit aussi les termes utilisés dans l&#x27;API (ressource, version etc.) à l&#x27;image du langage ubiquitaire du DDD.</li>
</ul>
</li>
<li class="nx-my-2">Ensuite il faut les <strong>use case guidelines</strong> qui sont une version plus digeste et prête à l&#x27;emploi pour étendre l&#x27;API. Par exemple comment créer un nouvel élément dans l&#x27;API, et on montre pas à pas, comme un tuto.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On fait bien attention à utiliser le même vocabulaire partagé que celui défini dans les reference guidelines.</li>
</ul>
</li>
<li class="nx-my-2">Enfin, on peut ajouter des <strong>design process guidelines</strong> où on va donner des référence vers des ressources utiles pour creuser tel ou tel aspect utile pour le design de l&#x27;API. Par exemple des liens vers des spécifications, tutoriels, livres etc.</li>
</ul>
</li>
<li class="nx-my-2">Le site <a href="https://webconcepts.info/" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">webconcepts.info<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> rassemble des informations fiables sur HTTP, OAuth et d&#x27;autres concepts liés avec des liens vers les spécifications, intéressant quand on cherche la bonne spécification à suivre.</li>
<li class="nx-my-2">Le site <a href="http://apistylebook.com/" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">apistylebook.com<span class="nx-sr-only nx-select-none"> (opens in a new tab)</span></a> rassemble des API guidelines célèbres dont on peut s&#x27;inspirer.</li>
<li class="nx-my-2">Il faut écrire les guidelines <strong>petit à petit</strong> de manière <strong>itérative</strong>, en n&#x27;y mettant que ce dont on est sûr à chaque fois, et en étant prêt à revoir le contenu.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut aussi que ce soit un travail collectif et permanent de tous ceux qui sont en charge du design de l&#x27;API, sinon les guidelines ne seront pas respectées.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Une API étant potentiellement difficile à changer, et pouvant poser des problèmes importants de sécurité, il est important qu&#x27;il y ait une procédure de <strong>review</strong> sérieuse à chaque changement.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut avant tout identifier les <strong>besoins</strong> derrière un changement d&#x27;API.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La méthode des 5 “Pourquoi ?” (Pourquoi vouloir faire ceci ? Parce que cela. Et pourquoi cela ? etc.) permet en général de remonter au besoin racine.</li>
<li class="nx-my-2">Il faut aussi bien comprendre le contexte des utilisateurs, du provider de l&#x27;API, les aspects sécurité concernés (données sensibles ?) etc.</li>
</ul>
</li>
<li class="nx-my-2">Ensuite il faut <strong>linter</strong> l&#x27;API :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Examiner si le design proposé suit bien les guidelines.</li>
<li class="nx-my-2">S&#x27;il est cohérent avec le reste de l&#x27;API (même si c&#x27;est pas encore écrit dans les guidelines).</li>
<li class="nx-my-2">Si des erreurs de forme ne sont pas glissées dedans. Par exemple des propriétés abrégées ou manifestement pas user friendly.</li>
<li class="nx-my-2">Une partie peut être faite avec des outils automatiques pour gagner du temps.</li>
</ul>
</li>
<li class="nx-my-2">Il faut reviewer le design du <strong>point de vue du provider</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut vérifier que l&#x27;API est extensible, sécurisée et ne devrait à priori pas poser de problèmes de performance ou d&#x27;implémentation.</li>
</ul>
</li>
<li class="nx-my-2">Le reviewer du <strong>point de vue du consommateur</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Se demander si on n&#x27;expose pas la structure interne du provider au lieu de répondre au besoin de l&#x27;utilisateur. Vérifier que l&#x27;API est facile à utiliser, que le flow est suffisamment simple etc.</li>
<li class="nx-my-2">Obtenir du feedback des clients peut aussi avoir de la valeur pour obtenir une bonne API.</li>
</ul>
</li>
<li class="nx-my-2">Et enfin une fois que l&#x27;implémentation est faite (ou en cours), vérifier qu&#x27;elle correspond bien avec la spécification de l&#x27;API.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ça se fait avec des tests unitaires, et des tests au niveau de l&#x27;API.</li>
<li class="nx-my-2">Il faut toujours réaliser les tests de sécurité (vérifier le contrôle d&#x27;accès, vérifier que les données sensibles ne fuitent pas).</li>
<li class="nx-my-2">Il faut tester que l&#x27;API fonctionne comme prévu au runtime, pas seulement avec des techniques statiques sans faire tourner l&#x27;API.</li>
<li class="nx-my-2">Il ne faut pas oublier de tester le caractère obligatoire des propriétés ou encore le fait qu&#x27;une valeur doive être entre un min et un max.</li>
<li class="nx-my-2">Il faut tester l&#x27;API aussi dans toute la chaîne réseau pour vérifier que des proxis, pare-feux, routeurs ne nous causent pas de problèmes.</li>
</ul>
</li>
</ul>
</li>
</ul><div class="nx-mt-16"></div><div class="nx-mb-8 nx-flex nx-items-center nx-border-t nx-pt-8 dark:nx-border-neutral-800 contrast-more:nx-border-neutral-400 dark:contrast-more:nx-border-neutral-400 print:nx-hidden"><a title="Test-Driven Development: By Example" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-pr-4 rtl:nx-pl-4" href="/reading-notes/books/test-driven-development-by-example/"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 ltr:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>Test-Driven Development: By Example</a><a title="The Five Dysfunctions of a Team" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-ml-auto ltr:nx-pl-4 ltr:nx-text-right rtl:nx-mr-auto rtl:nx-pr-4 rtl:nx-text-left" href="/reading-notes/books/the-five-dysfunctions-of-a-team/">The Five Dysfunctions of a Team<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 rtl:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></a></div></main></article></div><footer class="nx-bg-gray-100 nx-pb-[env(safe-area-inset-bottom)] dark:nx-bg-neutral-900 print:nx-bg-transparent"><div class="nx-mx-auto nx-flex nx-max-w-[90rem] nx-gap-2 nx-py-2 nx-px-4 nx-hidden"><button title="Change theme" class="nx-h-7 nx-rounded-md nx-px-2 nx-text-left nx-text-xs nx-font-medium nx-text-gray-600 nx-transition-colors dark:nx-text-gray-400 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50" id="headlessui-listbox-button-:Rkt6:" type="button" aria-haspopup="listbox" aria-expanded="false" data-headlessui-state=""><div class="nx-flex nx-items-center nx-gap-2 nx-capitalize"><svg fill="none" viewBox="3 3 18 18" width="12" height="12" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="currentColor" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><span class="">Light</span></div></button></div><hr class="dark:nx-border-neutral-800"/><div class="nx-mx-auto nx-flex nx-max-w-[90rem] nx-justify-center nx-py-12 nx-text-gray-600 dark:nx-text-gray-400 md:nx-justify-start nx-pl-[max(env(safe-area-inset-left),1.5rem)] nx-pr-[max(env(safe-area-inset-right),1.5rem)]">Made by Roman Mkrtchian</div></footer></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{}},"page":"/books/the-design-of-web-apis","query":{},"buildId":"VVUuQo8BOBEVRgyHJwtVI","assetPrefix":"/reading-notes","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>