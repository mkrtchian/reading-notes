<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Monolith to Microservices: : Evolutionary Patterns to Transform Your Monolith – Reading notes</title><meta name="robots" content="index,follow"/><meta name="description" content="My detailed reading notes from computer science books"/><meta property="og:title" content="Monolith to Microservices: : Evolutionary Patterns to Transform Your Monolith – Reading notes"/><meta property="og:description" content="My detailed reading notes from computer science books"/><meta name="theme-color" content="#111" media="(prefers-color-scheme: dark)"/><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/><style>
        :root {
          --nextra-primary-hue: 212deg;
          --nextra-navbar-height: 4rem;
          --nextra-menu-height: 3.75rem;
          --nextra-banner-height: 2.5rem;
        }
        
        .dark {
          --nextra-primary-hue: 204deg;
        }
      </style><meta name="msapplication-TileColor" content="#fff"/><meta http-equiv="Content-Language" content="en"/><meta name="description" content="My detailed reading notes from computer science books"/><meta property="og:title" content="Reading notes"/><meta property="og:description" content="My detailed reading notes from computer science books"/><meta name="apple-mobile-web-app-title" content="Reading notes"/><link rel="icon" type="image/x-icon" href="/reading-notes/favicon.ico"/><meta name="next-head-count" content="16"/><link rel="preload" href="/reading-notes/_next/static/css/e73ec87daa5345b3.css" as="style"/><link rel="stylesheet" href="/reading-notes/_next/static/css/e73ec87daa5345b3.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/reading-notes/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/reading-notes/_next/static/chunks/webpack-94b934e1f7075309.js" defer=""></script><script src="/reading-notes/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/reading-notes/_next/static/chunks/main-292f1bb1f20c0588.js" defer=""></script><script src="/reading-notes/_next/static/chunks/pages/_app-aea6920bd27938ca.js" defer=""></script><script src="/reading-notes/_next/static/chunks/105-7a4c97f6fce03efd.js" defer=""></script><script src="/reading-notes/_next/static/chunks/pages/books/monolith-to-microservices-bca7270da292f6e8.js" defer=""></script><script src="/reading-notes/_next/static/F6f_7M_ER8Wqj_ggOiWGC/_buildManifest.js" defer=""></script><script src="/reading-notes/_next/static/F6f_7M_ER8Wqj_ggOiWGC/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div dir="ltr"><script>document.documentElement.setAttribute('dir','ltr')</script><div class="nextra-nav-container nx-sticky nx-top-0 nx-z-20 nx-w-full nx-bg-transparent print:nx-hidden"><div class="nextra-nav-container-blur nx-pointer-events-none nx-absolute nx-z-[-1] nx-h-full nx-w-full nx-bg-white dark:nx-bg-dark nx-shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] dark:nx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:nx-shadow-[0_0_0_1px_#000] contrast-more:dark:nx-shadow-[0_0_0_1px_#fff]"></div><nav class="nx-mx-auto nx-flex nx-h-[var(--nextra-navbar-height)] nx-max-w-[90rem] nx-items-center nx-justify-end nx-gap-2 nx-pl-[max(env(safe-area-inset-left),1.5rem)] nx-pr-[max(env(safe-area-inset-right),1.5rem)]"><a class="nx-flex nx-items-center hover:nx-opacity-75 ltr:nx-mr-auto rtl:nx-ml-auto" href="/reading-notes/"><img alt="Reading notes homepage" loading="lazy" width="30" height="30" decoding="async" data-nimg="1" style="color:transparent" src="/reading-notes/logo.png"/></a><div class="nextra-search nx-relative md:nx-w-64 nx-hidden md:nx-inline-block mx-min-w-[200px]"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div><a href="https://github.com/mkrtchian/reading-notes" target="_blank" rel="noreferrer" class="nx-p-2 nx-text-current"><svg width="24" height="24" fill="currentColor" viewBox="3 3 18 18"><title>GitHub</title><path d="M12 3C7.0275 3 3 7.12937 3 12.2276C3 16.3109 5.57625 19.7597 9.15374 20.9824C9.60374 21.0631 9.77249 20.7863 9.77249 20.5441C9.77249 20.3249 9.76125 19.5982 9.76125 18.8254C7.5 19.2522 6.915 18.2602 6.735 17.7412C6.63375 17.4759 6.19499 16.6569 5.8125 16.4378C5.4975 16.2647 5.0475 15.838 5.80124 15.8264C6.51 15.8149 7.01625 16.4954 7.18499 16.7723C7.99499 18.1679 9.28875 17.7758 9.80625 17.5335C9.885 16.9337 10.1212 16.53 10.38 16.2993C8.3775 16.0687 6.285 15.2728 6.285 11.7432C6.285 10.7397 6.63375 9.9092 7.20749 9.26326C7.1175 9.03257 6.8025 8.08674 7.2975 6.81794C7.2975 6.81794 8.05125 6.57571 9.77249 7.76377C10.4925 7.55615 11.2575 7.45234 12.0225 7.45234C12.7875 7.45234 13.5525 7.55615 14.2725 7.76377C15.9937 6.56418 16.7475 6.81794 16.7475 6.81794C17.2424 8.08674 16.9275 9.03257 16.8375 9.26326C17.4113 9.9092 17.76 10.7281 17.76 11.7432C17.76 15.2843 15.6563 16.0687 13.6537 16.2993C13.98 16.5877 14.2613 17.1414 14.2613 18.0065C14.2613 19.2407 14.25 20.2326 14.25 20.5441C14.25 20.7863 14.4188 21.0746 14.8688 20.9824C16.6554 20.364 18.2079 19.1866 19.3078 17.6162C20.4077 16.0457 20.9995 14.1611 21 12.2276C21 7.12937 16.9725 3 12 3Z"></path></svg><span class="nx-sr-only">GitHub</span><span class="nx-sr-only"> (opens in a new tab)</span></a><button type="button" aria-label="Menu" class="nextra-hamburger -nx-mr-2 nx-rounded nx-p-2 active:nx-bg-gray-400/20 md:nx-hidden"><svg fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" class=""><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16"></path></g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12h16"></path><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 18h16"></path></g></svg></button></nav></div><div class="nx-mx-auto nx-flex nx-max-w-[90rem]"><div class="motion-reduce:nx-transition-none [transition:background-color_1.5s_ease] nx-bg-transparent"></div><aside class="nextra-sidebar-container nx-flex nx-flex-col md:nx-top-16 md:nx-shrink-0 motion-reduce:nx-transform-none nx-transform-gpu nx-transition-all nx-ease-in-out print:nx-hidden md:nx-w-64 md:nx-sticky md:nx-self-start max-md:[transform:translate3d(0,-100%,0)]"><div class="nx-px-4 nx-pt-4 md:nx-hidden"><div class="nextra-search nx-relative md:nx-w-64"><div class="nx-relative nx-flex nx-items-center nx-text-gray-900 contrast-more:nx-text-gray-800 dark:nx-text-gray-300 contrast-more:dark:nx-text-gray-300"><input spellcheck="false" class="nx-block nx-w-full nx-appearance-none nx-rounded-lg nx-px-3 nx-py-2 nx-transition-colors nx-text-base nx-leading-tight md:nx-text-sm nx-bg-black/[.05] dark:nx-bg-gray-50/10 focus:nx-bg-white dark:focus:nx-bg-dark placeholder:nx-text-gray-500 dark:placeholder:nx-text-gray-400 contrast-more:nx-border contrast-more:nx-border-current" type="search" placeholder="Search documentation…" value=""/></div></div></div><div class="nx-overflow-y-auto nx-overflow-x-hidden nx-p-4 nx-grow md:nx-h-[calc(100vh-var(--nextra-navbar-height)-var(--nextra-menu-height))] nextra-scrollbar"><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100"><ul class="nx-flex nx-flex-col nx-gap-1 max-md:nx-hidden"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/">Introduction</a></li><li class="open"><button class="nx-items-center nx-justify-between nx-gap-2 nx-text-left nx-w-full nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">Reading notes<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-h-[18px] nx-min-w-[18px] nx-rounded-sm nx-p-0.5 hover:nx-bg-gray-800/5 dark:hover:nx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="nx-origin-center nx-transition-transform rtl:-nx-rotate-180 ltr:nx-rotate-90 rtl:nx-rotate-[-270deg]"></path></svg></button><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100 ltr:nx-pr-0 rtl:nx-pl-0 nx-pt-1"><ul class="nx-flex nx-flex-col nx-gap-1 nx-relative before:nx-absolute before:nx-inset-y-1 before:nx-w-px before:nx-bg-gray-200 before:nx-content-[&quot;&quot;] dark:before:nx-bg-neutral-800 ltr:nx-pl-3 ltr:before:nx-left-0 rtl:nx-pr-3 rtl:before:nx-right-0 ltr:nx-ml-3 rtl:nx-mr-3"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/continuous-discovery-habits/">Continuous Discovery Habits</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/designing-data-intensive-applications/">Designing Data-Intensive Applications</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/effective-kafka/">Effective Kafka</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/get-your-hands-dirty-on-clean-architecture/">Get Your Hands Dirty on Clean Architecture</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/learning-domain-driven-design/">Learning Domain-Driven Design</a></li><li class="nx-flex nx-flex-col nx-gap-1 active"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-bg-primary-100 nx-font-semibold nx-text-primary-800 dark:nx-bg-primary-400/10 dark:nx-text-primary-600 contrast-more:nx-border-primary-500 contrast-more:dark:nx-border-primary-500" href="/reading-notes/books/monolith-to-microservices/">Monolith to Microservices</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/refactoring/">Refactoring: Improving the Design of Existing Code</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/reinventing-organizations/">Reinventing Organizations</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/team-topologies/">Team Topologies</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/the-design-of-web-apis/">The Design of Web APIs</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/unit-testing/">Unit Testing: Principles, Practices, and Patterns</a></li></ul></div></div></li></ul></div></div><ul class="nx-flex nx-flex-col nx-gap-1 md:nx-hidden"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/">Introduction</a></li><li class="open"><button class="nx-items-center nx-justify-between nx-gap-2 nx-text-left nx-w-full nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">Reading notes<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-h-[18px] nx-min-w-[18px] nx-rounded-sm nx-p-0.5 hover:nx-bg-gray-800/5 dark:hover:nx-bg-gray-100/5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" class="nx-origin-center nx-transition-transform rtl:-nx-rotate-180 ltr:nx-rotate-90 rtl:nx-rotate-[-270deg]"></path></svg></button><div class="nx-transform-gpu nx-overflow-hidden nx-transition-all nx-ease-in-out motion-reduce:nx-transition-none"><div class="nx-transition-opacity nx-duration-500 nx-ease-in-out motion-reduce:nx-transition-none nx-opacity-100 ltr:nx-pr-0 rtl:nx-pl-0 nx-pt-1"><ul class="nx-flex nx-flex-col nx-gap-1 nx-relative before:nx-absolute before:nx-inset-y-1 before:nx-w-px before:nx-bg-gray-200 before:nx-content-[&quot;&quot;] dark:before:nx-bg-neutral-800 ltr:nx-pl-3 ltr:before:nx-left-0 rtl:nx-pr-3 rtl:before:nx-right-0 ltr:nx-ml-3 rtl:nx-mr-3"><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/continuous-discovery-habits/">Continuous Discovery Habits</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/designing-data-intensive-applications/">Designing Data-Intensive Applications</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/effective-kafka/">Effective Kafka</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/get-your-hands-dirty-on-clean-architecture/">Get Your Hands Dirty on Clean Architecture</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/learning-domain-driven-design/">Learning Domain-Driven Design</a></li><li class="nx-flex nx-flex-col nx-gap-1 active"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-bg-primary-100 nx-font-semibold nx-text-primary-800 dark:nx-bg-primary-400/10 dark:nx-text-primary-600 contrast-more:nx-border-primary-500 contrast-more:dark:nx-border-primary-500" href="/reading-notes/books/monolith-to-microservices/">Monolith to Microservices</a><ul class="nx-flex nx-flex-col nx-gap-1 nx-relative before:nx-absolute before:nx-inset-y-1 before:nx-w-px before:nx-bg-gray-200 before:nx-content-[&quot;&quot;] dark:before:nx-bg-neutral-800 ltr:nx-pl-3 ltr:before:nx-left-0 rtl:nx-pr-3 rtl:before:nx-right-0 ltr:nx-ml-3 rtl:nx-mr-3"><li><a href="#1---just-enough-microservices" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">1 - Just Enough Microservices</a></li><li><a href="#2---planning-a-migration" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">2 - Planning a Migration</a></li><li><a href="#3---splitting-the-monolith" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">3 - Splitting the Monolith</a></li><li><a href="#4---decomposing-the-database" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">4 - Decomposing the Database</a></li><li><a href="#chapter-5---growing-pains" class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-flex nx-gap-2 before:nx-opacity-25 before:nx-content-[&quot;#&quot;] nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50">Chapter 5 - Growing Pains</a></li></ul></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/refactoring/">Refactoring: Improving the Design of Existing Code</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/reinventing-organizations/">Reinventing Organizations</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/team-topologies/">Team Topologies</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/the-design-of-web-apis/">The Design of Web APIs</a></li><li class="nx-flex nx-flex-col nx-gap-1"><a class="nx-flex nx-rounded nx-px-2 nx-py-1.5 nx-text-sm nx-transition-colors [word-break:break-word] nx-cursor-pointer [-webkit-tap-highlight-color:transparent] [-webkit-touch-callout:none] contrast-more:nx-border nx-text-gray-500 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:nx-text-neutral-500 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50 contrast-more:nx-text-gray-900 contrast-more:dark:nx-text-gray-50 contrast-more:nx-border-transparent contrast-more:hover:nx-border-gray-900 contrast-more:dark:hover:nx-border-gray-50" href="/reading-notes/books/unit-testing/">Unit Testing: Principles, Practices, and Patterns</a></li></ul></div></div></li></ul></div><div class="nx-sticky nx-bottom-0 nx-bg-white dark:nx-bg-dark nx-mx-4 nx-py-4 nx-shadow-[0_-12px_16px_#fff] nx-flex nx-items-center nx-gap-2 dark:nx-border-neutral-800 dark:nx-shadow-[0_-12px_16px_#111] contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-shadow-none nx-border-t" data-toggle-animation="off"><div class="nx-grow nx-flex nx-flex-col"><button title="Change theme" class="nx-h-7 nx-rounded-md nx-px-2 nx-text-left nx-text-xs nx-font-medium nx-text-gray-600 nx-transition-colors dark:nx-text-gray-400 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50" id="headlessui-listbox-button-:Rlsr6:" type="button" aria-haspopup="listbox" aria-expanded="false" data-headlessui-state=""><div class="nx-flex nx-items-center nx-gap-2 nx-capitalize"><svg fill="none" viewBox="3 3 18 18" width="12" height="12" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="currentColor" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><span class="">Light</span></div></button></div></div></aside><nav class="nextra-toc nx-order-last nx-hidden nx-w-64 nx-shrink-0 xl:nx-block print:nx-hidden nx-px-4" aria-label="table of contents"><div class="nextra-scrollbar nx-sticky nx-top-16 nx-overflow-y-auto nx-pr-4 nx-pt-6 nx-text-sm [hyphens:auto] nx-max-h-[calc(100vh-var(--nextra-navbar-height)-env(safe-area-inset-bottom))] ltr:-nx-mr-4 rtl:-nx-ml-4"><p class="nx-mb-4 nx-font-semibold nx-tracking-tight">On This Page</p><ul><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#1---just-enough-microservices" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">1 - Just Enough Microservices</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#2---planning-a-migration" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">2 - Planning a Migration</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#3---splitting-the-monolith" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">3 - Splitting the Monolith</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-strangler-fig-application" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Strangler Fig Application</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-ui-composition" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: UI Composition</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-branch-by-abstraction" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Branch by Abstraction</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-parallel-run" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Parallel Run</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-decorating-collaborator" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Decorating Collaborator</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-change-data-capture" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Change Data Capture</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#4---decomposing-the-database" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">4 - Decomposing the Database</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-the-shared-database" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: The Shared Database</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-database-view" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Database View</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-database-wrapping-service" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Database Wrapping Service</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-database-as-a-service-interface" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Database-as-a-Service Interface</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#transferring-ownership" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Transferring Ownership</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-aggregate-exposing-monolith" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Aggregate Exposing Monolith</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-change-data-ownership" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Change Data Ownership</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#data-synchronization" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Data Synchronization</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-synchronize-data-in-application" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Synchronize Data in Application</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-tracer-write" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Tracer Write</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#splitting-apart-the-database" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Splitting Apart the Database</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#schema-separation-examples" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Schema Separation Examples</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-split-table" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Split Table</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#pattern-move-foreign-key-relationship-to-code" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Pattern: Move Foreign-Key Relationship to Code</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#exemple--shared-static-data" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Exemple : Shared Static Data</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#transactions" class="ltr:nx-pl-4 rtl:nx-pr-4 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Transactions</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#sagas" class="ltr:nx-pl-8 rtl:nx-pr-8 nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Sagas</a></li><li class="nx-my-2 nx-scroll-my-6 nx-scroll-py-6"><a href="#chapter-5---growing-pains" class="nx-font-semibold nx-inline-block nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-300 contrast-more:nx-text-gray-900 contrast-more:nx-underline contrast-more:dark:nx-text-gray-50 nx-w-full nx-break-words">Chapter 5 - Growing Pains</a></li></ul><div class="nx-mt-8 nx-border-t nx-bg-white nx-pt-8 nx-shadow-[0_-12px_16px_white] dark:nx-bg-dark dark:nx-shadow-[0_-12px_16px_#111] nx-sticky nx-bottom-0 nx-flex nx-flex-col nx-items-start nx-gap-2 nx-pb-8 dark:nx-border-neutral-800 contrast-more:nx-border-t contrast-more:nx-border-neutral-400 contrast-more:nx-shadow-none contrast-more:dark:nx-border-neutral-400"><a href="https://github.com/mkrtchian/reading-notes/issues/new?title=Feedback%20for%20%E2%80%9CMonolith%20to%20Microservices%3A%20%3A%20Evolutionary%20Patterns%20to%20Transform%20Your%20Monolith%E2%80%9D&amp;labels=feedback" target="_blank" rel="noreferrer" class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50">Question? Give me feedback →<span class="nx-sr-only"> (opens in a new tab)</span></a><a class="nx-text-xs nx-font-medium nx-text-gray-500 hover:nx-text-gray-900 dark:nx-text-gray-400 dark:hover:nx-text-gray-100 contrast-more:nx-text-gray-800 contrast-more:dark:nx-text-gray-50" href="https://github.com/mkrtchian/reading-notes/blob/main/pages/books/monolith-to-microservices.md">Edit this page</a></div></div></nav><div id="reach-skip-nav"></div><article class="nx-w-full nx-break-words nextra-content nx-flex nx-min-h-[calc(100vh-var(--nextra-navbar-height))] nx-min-w-0 nx-justify-center nx-pb-8 nx-pr-[calc(env(safe-area-inset-right)-1.5rem)]"><main class="nx-w-full nx-min-w-0 nx-max-w-6xl nx-px-6 nx-pt-4 md:nx-px-12"><div class="nextra-breadcrumb nx-mt-1.5 nx-flex nx-items-center nx-gap-1 nx-overflow-hidden nx-text-sm nx-text-gray-500 contrast-more:nx-text-current"><div class="nx-whitespace-nowrap nx-transition-colors nx-min-w-[24px] nx-overflow-hidden nx-text-ellipsis" title="Reading notes">Reading notes</div><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-w-3.5 nx-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg><div class="nx-whitespace-nowrap nx-transition-colors nx-font-medium nx-text-gray-700 contrast-more:nx-font-bold contrast-more:nx-text-current dark:nx-text-gray-400 contrast-more:dark:nx-text-current" title="Monolith to Microservices">Monolith to Microservices</div></div><h1 class="nx-mt-2 nx-text-4xl nx-font-bold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100">Monolith to Microservices: : Evolutionary Patterns to Transform Your Monolith</h1>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">1 - Just Enough Microservices<span class="nx-absolute -nx-mt-20" id="1---just-enough-microservices"></span><a href="#1---just-enough-microservices" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les microservices sont un type particulier de service-oriented architecture (SOA).<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ils exposent une API via le réseau, donc forment une architecture distribuée.</li>
<li class="nx-my-2">Il sont <strong>déployables indépendamment</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il s&#x27;agit d&#x27;être en mesure de modifier et déployer un seul service sans toucher aux autres.</li>
<li class="nx-my-2">Le conseil de l&#x27;auteur est d&#x27;<em>effectivement</em> déployer les services indépendamment, plutôt que le tout ensemble en espérant une indépendance théorique.</li>
</ul>
</li>
<li class="nx-my-2">Ils sont organisés autour d&#x27;un <strong>business domain</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le but est de rendre les changements affectant plusieurs microservices le plus rare possible, et favoriser les changement à l&#x27;intérieur du microservice.</li>
</ul>
</li>
<li class="nx-my-2">Ils gardent la <strong>base de données privée</strong>, et ne l&#x27;exposent que via une API.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Partager la DB est une des pires choses à faire pour avoir une déployabilité indépendante.</li>
<li class="nx-my-2">Ne pas la partager telle quelle permet de décider ce qu&#x27;on partage et ce qu&#x27;on ne partage pas, et aussi de garder une API publique stable tout en étant libre de faire des changements en interne.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;exemple utilisé dans ce livre est une entreprise de vente de CD de musique.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Elle a une application organisée en 3 couches techniques : UI, backend, DB.</li>
<li class="nx-my-2">Chaque couche est sous la responsabilité d&#x27;une équipe : équipe front, équipe back, équipe DB.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Et d&#x27;ailleurs cette l&#x27;architecture découle probablement de l&#x27;organisation des équipes cf. loi de Conway.</li>
</ul>
</li>
<li class="nx-my-2">On a donc une forte cohésion au niveau technique : s&#x27;il faut faire un travail sur un aspect technique (par exemple moderniser la UI), une seule équipe sera impactée.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Mais on a une faible cohésion par domaine business, puisque l&#x27;ajout d&#x27;une fonctionnalité nécessite l&#x27;intervention et la coordination de 3 équipes.</li>
</ul>
</li>
<li class="nx-my-2">A l&#x27;inverse on peut imaginer une architecture organisée autour des domaines, avec un bout de UI, un bout de backend et un bout de DB chacun, et sous la responsabilité d&#x27;équipes pluridisciplinaires : c&#x27;est comme ça qu&#x27;on va organiser nos microservices.</li>
</ul>
</li>
<li class="nx-my-2">Les <strong>microservices</strong> ont de nombreux <strong>avantages</strong>, et il s&#x27;agit de comprendre lesquels on cherche à obtenir en priorité pour orienter notre décomposition de monolithe.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La possibilité de scaler différemment des parties du système, et d&#x27;obtenir de la robustesse (le système peut continuer à opérer même si une partie est down).</li>
<li class="nx-my-2">La possibilité d&#x27;utiliser différentes stacks technologiques et de les faire communiquer ensemble.</li>
<li class="nx-my-2">La possibilité pour plusieurs équipes de travailler sur le système sans se marcher dessus.</li>
</ul>
</li>
<li class="nx-my-2">Parmi les <strong>désavantages</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les problématiques des systèmes distribués : la communication réseau étant significativement plus lente que la communication in-process, et les paquets pouvant se perdre, on doit faire attention à beaucoup plus de choses.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les transactions deviennent problématiques.</li>
</ul>
</li>
<li class="nx-my-2">Les microservices arrivent avec leurs technologies spécifiques à maîtriser, qui peuvent causer bien plus de problèmes que les systèmes classiques si elles sont mal utilisées.</li>
</ul>
</li>
<li class="nx-my-2">La <strong>UI</strong> ne doit pas être mise de côté dans la décomposition : si on veut pouvoir déployer rapidement des features complètes, il faut la décomposer elle-aussi pour qu&#x27;elle corresponde avec les services côté backend.</li>
<li class="nx-my-2">L&#x27;auteur conseille de ne pas adopter une nouvelle stack technologique pour faire la migration vers les microservices. La migration en elle-même est déjà assez difficile, il vaut mieux garder les outils qu&#x27;on connaît dans un premier temps.</li>
<li class="nx-my-2">A propos de la <strong>taille</strong> des microservices :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">C&#x27;est un des critères les <strong>moins importants</strong>, surtout quand on débute avec.</li>
<li class="nx-my-2">Il vaut mieux s&#x27;intéresser d&#x27;abord à la question de savoir combien de microservices on sera capable de gérer dans l&#x27;organisation, et comment faire en sorte de ne pas trop les coupler.</li>
<li class="nx-my-2">Il cite Chris Richardson qui parle d&#x27;avoir des microservices avec de petites interfaces.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">NDLR : c&#x27;est par cette idée que Vlad Khononov caractérise principalement les microservices dans <em>Learning Domain Driven Design</em>.</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;idée initiale des microservices était de les avoir si petits qu&#x27;on pourrait facilement les recoder pour les remplacer (par exemple dans une techno qui permette plus de performance/scalabilité), mais l&#x27;auteur sous-entend que ce n&#x27;est plus vraiment un critère essentiel, en tout cas qui fait consensus.</li>
</ul>
</li>
<li class="nx-my-2">Côté ownership, l&#x27;architecture en microservices favorise le modèle où les équipes tech/produit sont au contact du client, et sont supportées par d&#x27;éventuelles équipes transverses.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ca s&#x27;oppose au modèle plus traditionnel où le &quot;business&quot; gère la relation avec les clients, et où les développeurs sont dans un silo à part, sans ownership réel sur un business domain de bout en bout.</li>
</ul>
</li>
<li class="nx-my-2">Le terme <strong>monolith</strong> désigne ici l&#x27;unité de <strong>déploiement</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le <strong>single process monolith</strong> : il s&#x27;agit d&#x27;une app single-process, qu&#x27;on peut éventuellement dupliquer pour des raisons d&#x27;availability.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">En général le monolithe va au moins communiquer avec une DB, formant un système distribué très simple.</li>
<li class="nx-my-2">Ça représente l&#x27;essentiel des projets qui cherchent à migrer vers du microservice, donc l&#x27;auteur va se concentrer sur ça.</li>
<li class="nx-my-2">Il est possible de réaliser un <strong>modular monolith</strong> en gardant le single-process, mais en créant des modules de code bien séparés.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><a href="https://www.youtube.com/watch?v=ISYKx8sa53g" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">Shopify<span class="nx-sr-only"> (opens in a new tab)</span></a> est un bon exemple de modular monolith.</li>
<li class="nx-my-2">On se retrouve ceci dit souvent dans une configuration où le split de DB est négligé par les équipes.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Le <strong>distributed monolith</strong> : on a plusieurs services communiquant à travers le réseau, mais le système a besoin d&#x27;être déployé en un bloc.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">C&#x27;est un système qui a tous les désavantages : absence de modularisation, et système distribué.</li>
</ul>
</li>
<li class="nx-my-2">Les <strong>third-party black-box systems</strong> : les services externes SASS qu&#x27;on utilise, ou open source qu&#x27;on installe.</li>
</ul>
</li>
<li class="nx-my-2">Les <strong>monoliths</strong> ont un certain nombre de <strong>désavantages</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les diverses parties du code ont tendance à être plus facilement couplées.</li>
<li class="nx-my-2">Le travail à plusieurs équipes est plus compliqué en terme de conflit de modification, en terme de confusion d&#x27;ownership, et aussi pour savoir quand déployer.</li>
</ul>
</li>
<li class="nx-my-2">Concernant les <strong>avantages</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On n&#x27;a pas tous les problèmes associés aux systèmes distribués.</li>
<li class="nx-my-2">Le workflow de développement, le monitoring et le débug est plus simple.</li>
<li class="nx-my-2">On peut réutiliser du code très facilement.</li>
</ul>
</li>
<li class="nx-my-2">A propos du <strong>couplage</strong> et de la <strong>cohésion</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le couplage c&#x27;est l&#x27;idée que changer une chose implique d&#x27;en changer aussi une autre. La cohésion c&#x27;est le fait de garder ensemble des choses qui ont un rapport entre-elles (et qui d&#x27;habitude changent ensemble).<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour avoir un système facile à transformer, on a envie que le couplage soit faible, et la cohésion élevée.</li>
<li class="nx-my-2">Par exemple, si la logique d&#x27;une fonctionnalité est présente à travers plusieurs modules, on va devoir les changer tous pour la modifier (couplage élevé), et les éléments de cette fonctionnalité ne sont pas rassemblés (cohésion faible).</li>
</ul>
</li>
<li class="nx-my-2">Dans le cas spécifique des microservices, les modules en question qu&#x27;il faut considérer en priorité sont les microservices eux-mêmes, puisque modifier leurs limites coûte très cher.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On veut donc faire en sorte que chaque changement impacte, et donc oblige le redéploiement, du moins possible de microservices.</li>
<li class="nx-my-2">Si dans les microservices on peut se tromper dans les limites de chaque service, dans le monolithe ces limites n&#x27;existent pas naturellement, et donc on a tendance à avoir un couplage généralisé où tout dépend de tout.</li>
</ul>
</li>
<li class="nx-my-2">Il y a différents types de couplage :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>Implementation coupling</strong> : il s&#x27;agit d&#x27;un service qui doit changer quand on modifie l&#x27;implémentation d&#x27;un autre service.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;exemple typique c&#x27;est le couplage à la DB d&#x27;un autre service.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La solution c&#x27;est soit d&#x27;avoir une API pour accéder à la donnée, soit d&#x27;avoir une DB publique spécifique pour les consommateurs externes, distincte de la DB interne du microservice.</li>
</ul>
</li>
<li class="nx-my-2">Avoir une interface publique distincte permet aussi de concevoir cette interface pour répondre aux besoins des consommateurs, en mode <strong>outside-in</strong>, plutôt qu&#x27;imaginer ce qu&#x27;on veut exposer parmi ce qu&#x27;on a déjà.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur conseille de toujours faire ça : <strong>impliquer les consommateurs dans le design de l&#x27;API publique</strong>, pour que le service les serve au mieux.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Temporal coupling</strong> : il s&#x27;agit de communication synchrone dépendante d&#x27;autres communications.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, si un service envoie un message à un autre service, qui doit d&#x27;abord interroger un 3ème avant de répondre. Si le 3ème est down le 2ème ne pourra pas répondre.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La solution peut être pour le 2ème service d&#x27;avoir les données du 3ème en cache.</li>
<li class="nx-my-2">Une autre solution pourrait être d&#x27;utiliser des communications asynchrones : le 3ème service reçoit le message asynchrone et recontacte le 2ème quand il est dispo.</li>
</ul>
</li>
<li class="nx-my-2">Pour plus d&#x27;infos sur le type de communications, voir le chapitre 4 de <strong><em>Building Microservices</em></strong>.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Deployment coupling</strong> : à chaque fois qu&#x27;on doit redéployer des services quand on en déploie un.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Idéalement on veut pouvoir déployer le plus petit set de choses pour avoir peu de risques et un feedback rapide (et aller vers une continuous delivery).</li>
<li class="nx-my-2">Les <em>release trains</em> sont une mauvaise idée.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Domain coupling</strong> : il s&#x27;agit des interactions indispensables liées aux fonctionnalités elles-mêmes.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On ne peut pas les éliminer, mais on peut les agencer de telle sorte qu&#x27;elles aient un impact limité en termes de couplage.</li>
<li class="nx-my-2">Par exemple, dans le cas de l&#x27;entreprise de vente de CD, le microservice de la commande doit communiquer au microservice de l&#x27;entrepôt quels CD ont été achetés et où ils doivent être acheminés.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut réduire au maximum les informations communiquées entre services, par exemple l&#x27;entrepôt recevrait seulement les données de packaging et pas l&#x27;ensemble des détails de la commande.</li>
<li class="nx-my-2">On peut faire en sorte que la commande inclut les infos nécessaires sur l&#x27;utilisateur (dont elle aura de toute façon besoin pour d&#x27;autres raisons) dans le message envoyé à l&#x27;entrepôt, plutôt qu&#x27;avoir l&#x27;entrepôt faisant un autre appel pour obtenir les infos de l&#x27;utilisateur.</li>
<li class="nx-my-2">Une autre possibilité pourrait être que la commande émette un event, et que l&#x27;entrepôt le consomme.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Le <strong>Domain Driven Design</strong> permet d&#x27;organiser les microservices efficacement autour de business domains.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les <strong>aggregates</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut les voir comme des représentations de choses réelles, avec un cycle de vie qu&#x27;on peut traiter avec une machine à état.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple une commande, une facture, un objet en stock.</li>
</ul>
</li>
<li class="nx-my-2">Un microservice peut contenir un ou plusieurs aggregates.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si un autre microservice veut changer le contenu d&#x27;un aggregate, il doit soit envoyer un message au microservice qui en a la responsabilité, soit faire en sorte que ce microservice écoute des events que lui émet.</li>
</ul>
</li>
<li class="nx-my-2">Il y a de nombreux moyens d&#x27;organiser le système en aggregates, mais il vaut mieux commencer par celui qui colle le mieux au modèle mental des utilisateurs.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;event storming est un bon moyen pour ça.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Les <strong>bounded contexts</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ils permettent de cacher l&#x27;implémentation aux bounded contexts extérieurs.</li>
<li class="nx-my-2">Ils contiennent un ou plusieurs aggregates, dont certains peuvent être privés pour l&#x27;extérieur.</li>
</ul>
</li>
<li class="nx-my-2">Concernant la relation avec les microservices :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Au début on cherche de gros microservices, donc les bounded contexts sont de bons candidats.</li>
<li class="nx-my-2">A mesure qu&#x27;on avance, on va affiner nos microservices, et opter pour un aggregate par service.</li>
<li class="nx-my-2">A noter que le groupe de microservices autour d&#x27;un bounded context peut cacher qu&#x27;il y a en fait plusieurs microservices (ce détail relevant de l&#x27;ordre de l&#x27;implémentation).</li>
<li class="nx-my-2">NDLR : selon Vlad Khononov le microservice est de fait un bounded context, et va bien avec la taille d&#x27;un subdomain. Il ne peut pas être plus grand que le plus grand bounded context possible, ni plus petit qu&#x27;un aggregate. Mais la taille de l&#x27;aggregate marche rarement.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">2 - Planning a Migration<span class="nx-absolute -nx-mt-20" id="2---planning-a-migration"></span><a href="#2---planning-a-migration" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut vouloir adopter les microservices pour diverses raisons, et ces raisons peuvent fortement influencer ce sur quoi on va concentrer nos efforts.</li>
<li class="nx-my-2">L&#x27;auteur pose en général 3 questions pour aider les entreprises à <strong>savoir si elles ont besoin des microservices</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Qu&#x27;est-ce que vous espérez accomplir ?<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On devrait pouvoir trouver des choses qui sont alignées avec les besoins business et des utilisateurs finaux.</li>
</ul>
</li>
<li class="nx-my-2">Est-ce que vous avez considéré des alternatives ?</li>
<li class="nx-my-2">Comment saurez-vous si la transition fonctionne ?</li>
</ul>
</li>
<li class="nx-my-2">Parmi les <strong>raisons de choisir les microservices</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>Améliorer l&#x27;autonomie des équipes / Scaler le nombre de développeurs</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il est notoire que les unités business autonomes sont plus efficaces. Et cette règle s&#x27;applique aussi à l&#x27;échelle de l&#x27;équipe, comme le modèle d&#x27;Amazon avec les équipes à deux pizzas.</li>
<li class="nx-my-2">Avoir le contrôle exclusif sur des microservices permet aux équipes d&#x27;acquérir de l&#x27;autonomie, et de travailler en parallèle.</li>
<li class="nx-my-2">Autres moyens d&#x27;obtenir ça :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le <strong>monolith modulaire</strong> peut répondre à ce point, avec une certaine coordination nécessaire quand même pour le déploiement commun.</li>
<li class="nx-my-2">On peut aussi penser de manière générale à des approches self-service où on provisionne des machines automatiquement au lieu d&#x27;avoir à passer par un ticket manuel auprès d&#x27;une autre équipe.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Réduire le time to market</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le fait que les microservices permettent de déployer sans besoin de coordination fait qu&#x27;on peut amener des changements en production plus vite.</li>
<li class="nx-my-2">Autres moyens d&#x27;obtenir ça :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur recommande de faire l&#x27;<strong>analyse</strong> concrète du chemin et du <strong>temps réel de chaque étape</strong> entre l&#x27;idée obtenue en discovery, et la feature en production.</li>
<li class="nx-my-2">On trouve souvent des bottlenecks qui permettent de gagner un temps conséquent.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Scaler efficacement la charge</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Comme les microservices tournent dans des processus différents, on peut les scaler indépendamment, et donc maîtriser les coûts de notre infrastructure.</li>
<li class="nx-my-2">Autres moyens d&#x27;obtenir ça :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut essayer de passer sur une plus grosse machine (scaling vertical).</li>
<li class="nx-my-2">Faire tourner <strong>plusieurs copies du monolithe</strong>, derrière un load balancer (scaling horizontal). Le bottleneck risque d&#x27;être la DB, mais ça ne coûte pas très cher d&#x27;essayer.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Améliorer la robustesse</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Comme on a plusieurs unités indépendantes et tournant sur des machines séparées, on peut concevoir le système de sorte qu&#x27;il continue à fonctionner même si certaines parties sont en échec.</li>
<li class="nx-my-2">Attention quand même : il y a tout un effort à faire pour obtenir cette robustesse, le fait de distribuer le système ne suffit pas à le rendre robuste.</li>
<li class="nx-my-2">Autres moyens d&#x27;obtenir ça :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Faire tourner <strong>plusieurs copies du monolithe</strong> permet de répondre à cette problématique. Y compris par exemple dans des racks ou datacenters différents.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Adopter de nouvelles technologies.</strong>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les microservices étant isolés et communiquant par réseau, on peut très bien tester un nouveau langage, une nouvelle techno etc. sur un seul microservice.</li>
<li class="nx-my-2">Autres moyens d&#x27;obtenir ça :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut parfois switcher de langage, par exemple si on utilise la JVM, on peut basculer entre les langages supportés.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour les nouvelles DB c&#x27;est plus compliqué.</li>
</ul>
</li>
<li class="nx-my-2">On peut toujours remplacer le monolithe par un nouveau avec une approche incrémentale type <em>strangler fig</em>.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Réutiliser des composants</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">C&#x27;est une <strong>mauvaise raison</strong>.</li>
<li class="nx-my-2">En général on cherche à optimiser autre chose derrière la réutilisation, il vaut mieux se concentrer sur cette vraie raison.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, la réduction du time to market. Or le coût de coordination entre équipes peut impliquer que réécrire le composant serait plus rapide.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Quand ne pas adopter les microservices</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>Un domaine pas très clair</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans le cas où on a un domaine encore jeune et pas très bien compris, la décomposition en microservices peut impliquer de se tromper de limites, et les changer coûte cher.</li>
<li class="nx-my-2">Et donc typiquement il faut éviter les microservices dès le début.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Quand on est une startup</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les microservices sont utiles pour les scale-ups ou les entreprises établies qui ont trouvé leur product market fit. Les startups le cherchent et donc seront amenées à beaucoup changer leur produit.</li>
<li class="nx-my-2">On peut éventuellement séparer ce qui est clairement à part dans un service, et laisser le reste dans le monolithe pour nous donner plus de temps pour le faire maturer.</li>
<li class="nx-my-2">Il y a aussi la question de la capacité à gérer les microservices avec les effectifs de la boite : si on a du mal à en gérer 2, en gérer 10 va être vraiment difficile.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Quand le logiciel est déployé chez le client</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le déploiement de microservices implique une grande complexité au niveau de l&#x27;infrastructure. On ne peut pas attendre des clients qu&#x27;ils puissent la gérer.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Quand on n&#x27;a pas de bonne raison</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Mine de rien c&#x27;est un des cas les plus courants où les gens adoptent les microservices alors qu&#x27;ils ne devraient pas.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">On a souvent plusieurs raisons d&#x27;adopter les microservices dans notre organisation. Il faut les <strong>prioriser</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, on décide qu&#x27;il nous faut des microservices pour gérer une augmentation de trafic. Puis on se dit que ce serait pas mal d&#x27;augmenter aussi l&#x27;autonomie des équipes, et d&#x27;adopter un nouveau langage.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut bien garder en tête que c&#x27;était l&#x27;augmentation du trafic qui était la plus importante. Et donc si on trouve un autre moyen plus simple de régler le problème, peut-être que les autres raisons devront attendre.</li>
</ul>
</li>
<li class="nx-my-2">Un bon moyen pour aider aux décisions est de représenter l&#x27;ensemble des raisons d&#x27;adopter les microservices avec des curseurs de 1 à 5 : si on augmente le curseur pour une raison, on doit le baisser pour une autre.</li>
</ul>
</li>
<li class="nx-my-2">Pour réussir à créer un <strong>changement organisationnel</strong> (pour mettre en place des microservices ou autre chose), l&#x27;auteur propose la méthode en 8 étapes de John Kotter, décrite plus en détail dans son livre <strong><em>Leading Change</em></strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>Étape 1 : Establishing a sense of urgency</strong>. Le meilleur moment pour initier le changement c&#x27;est juste après une crise dont l&#x27;idée qu&#x27;on veut mettre en place règlerait le problème sous-jacent, avec l&#x27;idée &quot;Il faut le mettre en place <em>maintenant</em>&quot;.</li>
<li class="nx-my-2"><strong>Étape 2 : Creating the guiding coalition</strong>. On a besoin de convaincre des personnes autour de nous. En fonction de l&#x27;impact de notre idée, il faudra avoir des personnes plus ou moins haut placées, et typiquement des personnes du business dans le cas où on introduit des systèmes distribuées qui vont impacter les utilisateurs.</li>
<li class="nx-my-2"><strong>Étape 3 : Developing a vision and strategy</strong>. La vision définit le &quot;quoi&quot;, elle doit donner envie mais être réaliste. La stratégie définit le &quot;comment&quot;.</li>
<li class="nx-my-2"><strong>Étape 4 : Communicating the change vision</strong>. Il vaut mieux privilégier la communication en face à face (plutôt que slack ou ce genre de chose) pour pouvoir ajuster le discours en fonction des réactions.</li>
<li class="nx-my-2"><strong>Étape 5 : Empowering employees for broad-based action</strong>. Souvent les organisations amènent de nouvelles personnes dans l&#x27;équipe pour aider au changement en donnant de la bande passante.</li>
<li class="nx-my-2"><strong>Étape 6 : Generating short-term wins</strong>. Pour éviter que l&#x27;engouement retombe, il faut obtenir des quick wins. Ça peut être par l&#x27;extraction de microservices &quot;faciles&quot; (à condition qu&#x27;ils aient un intérêt quand même).</li>
<li class="nx-my-2"><strong>Étape 7 : Consolidating gains and producing more change</strong>. On continue avec des changements plus profonds en fonction des succès ou échecs. Ça peut être la décomposition de la DB qu&#x27;on ne peut pas mettre de côté éternellement.</li>
<li class="nx-my-2"><strong>Étape 8 : Anchoring new approaches in the culture</strong>. A force de pratiquer la nouvelle manière de faire, la question de savoir si c&#x27;est la bonne approche ou non disparaît. Elle devient habituelle.</li>
</ul>
</li>
<li class="nx-my-2">La décomposition d&#x27;un monolithe étant une chose difficile, il faut qu&#x27;elle soit faite de manière <strong>incrémentale</strong>. On sort un service à la fois, et on obtient du feedback pour s&#x27;améliorer sur la suite.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le feedback en question est aussi précieux parce que la plupart des problèmes complexes liés aux microservices sont remarqués une fois que c&#x27;est <strong>déployé en production</strong>.</li>
</ul>
</li>
<li class="nx-my-2">Une des raisons de la méthode incrémentale est de <strong>rendre les erreurs réversibles</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Mais il y a des décisions qui sont plus impactantes que d&#x27;autres, et donc il faut <strong>adapter le temps passé à analyser à la facilité à annuler la décision</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Exemple : changer de fournisseur cloud ou changer l&#x27;API qu&#x27;on fournit publiquement est très impactant, alors d&#x27;expérimenter une librairie open source ou un nouveau langage beaucoup moins.</li>
</ul>
</li>
<li class="nx-my-2">Certaines décisions liées aux microservices peuvent être difficiles à défaire, par exemple annuler une migration de DB ou défaire la réécriture d&#x27;une API utilisée par de nombreux consumers.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans ces cas, l&#x27;auteur recommande d&#x27;utiliser un tableau blanc pour simuler les divers use-cases et leurs conséquences en terme de communication entre services, pour voir s&#x27;il y a des problèmes apparents.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Pour ce qui est de savoir où on commence, il nous faut une décomposition en composants business. Et pour ça on utilise le <strong>Domain Driven Design</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La notion de <strong>bounded context</strong> et les relations entre les BCs nous permet de représenter un découpage possible en microservices.</li>
<li class="nx-my-2">On n&#x27;a pas besoin d&#x27;un modèle super détaillé des BCs, mais d&#x27;avoir <strong>juste assez d&#x27;information</strong> pour pouvoir commencer à faire des choix. Et comme on procède de manière incrémentale, une erreur est vite rattrapée.</li>
<li class="nx-my-2">L&#x27;<strong>event storming</strong> est un outil recommandé par l&#x27;auteur pour obtenir une connaissance partagée du modèle, et pouvoir faire des choix pertinents à partir de là.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour approfondir il y a <strong><em>Introducing EventStorming</em></strong>, le livre pas encore terminé d&#x27;Alberto Brandolini.</li>
</ul>
</li>
<li class="nx-my-2">Pour prioriser, on peut se servir du <strong>context mapping</strong> (le nom n&#x27;est pas mentionné par l&#x27;auteur).<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Un BC qui a beaucoup de liens avec d&#x27;autres BCs ne sera peut être pas le bon premier candidat pour être extrait en microservice parce qu&#x27;il impliquera beaucoup de communications réseau.</li>
<li class="nx-my-2">A noter que le context map qu&#x27;on a à ce stade ne représente pas forcément le vrai découpage. Il va falloir regarder dans le code et vérifier ce que le BC fait dans base de données.</li>
<li class="nx-my-2">Il faudra aussi mettre la facilité d&#x27;extraction en balance avec l&#x27;utilité d&#x27;extraire ce BC là.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, si notre objectif c&#x27;est d&#x27;améliorer le time to market, mais qu&#x27;on commence par extraire un BC en microservice alors qu&#x27;il n&#x27;est presque jamais modifié, on n&#x27;aura pas beaucoup d&#x27;impact sur ce qu&#x27;on voulait faire.</li>
<li class="nx-my-2">On peut placer les BCs sur un graphique à deux axes : en abscisses l&#x27;intérêt de la décomposition, et en ordonnée la facilité de la décomposition.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On va choisir en priorité les BCs qui se retrouvent en haut à droite.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">A propos de l&#x27;<strong>organisation des équipes</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Historiquement les équipes étaient organisées par compétences techniques : devs Java ensemble, DBA ensemble, testeurs ensemble etc.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour intervenir sur une fonctionnalité il fallait passer par plusieurs équipes.</li>
</ul>
</li>
<li class="nx-my-2">De nos jours, avec des mouvements comme DevOps, les spécialités sont poussées vers les équipes de delivery, qui sont organisées autour de domaines fonctionnels, en <em>vertical slices</em>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le rôle des équipes centrales qui restent s&#x27;est transformé : au lieu de faire eux-mêmes, ils aident les équipes delivery, en y envoyant des spécialistes, organisant des formations, et en créant des <strong>outils self-service</strong>.</li>
</ul>
</li>
<li class="nx-my-2">Pour aller plus loin, l&#x27;auteur recommande <strong><em>Team Topologies</em></strong> et <strong><em>The Devops Handbook</em></strong>.</li>
<li class="nx-my-2">Il faut faire attention à ne pas chercher à copier tel quel les autres organisations, sans prendre en compte le contexte, la culture d&#x27;entreprise etc. On peut en revanche s&#x27;en inspirer.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le changement <strong>prend du temps</strong>. Par exemple, on peut intégrer des ops dans des équipes de dev pour former petit à petit chacun aux problématiques de l&#x27;autre.</li>
<li class="nx-my-2">Pour commencer le changement, on peut réunir des personnes de chaque équipe, et faire un mapping des responsabilités liées à la delivery, en fonction de chaque équipe.</li>
<li class="nx-my-2">Et ensuite on peut planifier un changement de responsabilités liées aux équipes, et de la structure des équipes, sur 6 mois à un an par exemple.</li>
</ul>
</li>
<li class="nx-my-2">Concernant la montée en compétence nécessaire pour la nouvelle organisation, l&#x27;auteur préconise de laisser les développeurs s&#x27;auto-évaluer avec une note sur chaque compétence nécessaire, et de les aider ensuite sur celles où ils se sont mis un faible score.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ces auto-évaluations devraient être privées pour ne pas être faussées.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Pour savoir si on va <strong>dans la bonne direction</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut avoir quelques <strong>métriques</strong> quantitatives et qualitatives liées aux outcomes qu&#x27;on recherche avec la transition qu&#x27;on a entamé.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les métriques quantitatives dépendent des objectifs.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, si c&#x27;est le time to market, on peut mesurer le cycle time, le nombre de déploiements et le failure rate.</li>
<li class="nx-my-2">Si on cherche la scalabilité, on peut se reporter au dernier test de performance réalisé.</li>
<li class="nx-my-2">Attention aux métriques : elles peuvent pousser à des comportements non souhaités pour satisfaire la métrique.</li>
</ul>
</li>
<li class="nx-my-2">Pour ce qui est des métriques qualitatives, il s&#x27;agit de vérifier si l&#x27;équipe est contente ou pas, s&#x27;ils sont débordés etc.</li>
</ul>
</li>
<li class="nx-my-2">Il faut organiser des <strong>checkpoints réguliers</strong> pour voir où on en est.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On vérifie que les raisons pour lesquelles on a commencé la transition sont toujours là.</li>
<li class="nx-my-2">On jette un œil aux métriques quantitatives pour voir l&#x27;avancée.</li>
<li class="nx-my-2">On demande du feedback qualitatif.</li>
<li class="nx-my-2">On décide d&#x27;éventuelles actions.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">3 - Splitting the Monolith<span class="nx-absolute -nx-mt-20" id="3---splitting-the-monolith"></span><a href="#3---splitting-the-monolith" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ce chapitre décrit des patterns pour migrer le code dans des microservices de manière incrémentale.</li>
<li class="nx-my-2">Un des critères à prendre en compte pour le choix des patterns c&#x27;est le fait qu&#x27;on ait ou non <strong>la possibilité de changer le code du monolithe</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut avoir de nombreuses raisons pour ne pas le pouvoir :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si on n&#x27;a plus le code source du monolithe.</li>
<li class="nx-my-2">Si le monolithe est écrit dans une technologie pour laquelle on n&#x27;a pas les compétences.</li>
<li class="nx-my-2">Si on a peur de trop impacter les autres développeurs du monolithe.</li>
</ul>
</li>
<li class="nx-my-2">Dans le cas où on peut modifier le code du monolithe, si le code est en trop mauvais état, ça peut aussi parfois être plus rapide de le réécrire dans le microservice plutôt que de l&#x27;extraire.</li>
</ul>
</li>
<li class="nx-my-2">Une des grandes difficultés c&#x27;est d&#x27;<strong>isoler le code qu&#x27;on veut extraire dans notre microservice</strong>, c&#x27;est-à-dire modulariser le monolithe.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">En général le code dans les monolithes est organisé autour de considérations techniques et pas de domaines métier, c&#x27;est pourtant ça qu&#x27;on veut extraire.</li>
<li class="nx-my-2">Pour aider à faire ça, l&#x27;auteur recommande le concept de <em>seam</em>, qu&#x27;on trouve dans <strong><em>Working Effectively with Legacy Code</em></strong> de Michael Feathers.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Un <em>seam</em> est une délimitation autour d&#x27;une zone qu&#x27;on veut changer. On travaille ensuite à une nouvelle implémentation de la fonctionnalité, et à la fin on remplace l&#x27;ancienne par la nouvelle.</li>
<li class="nx-my-2">Ça peut être plus ou moins grand, ici ce qui nous intéresse c&#x27;est un bounded context.</li>
</ul>
</li>
<li class="nx-my-2">Réorganiser le code pour obtenir un <strong>modular monolith</strong> peut être suffisant pour ce qu&#x27;on recherche, en fonction de nos objectifs (cf. chapitre précédent).<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Et ça peut aussi être une première étape pour aller vers l&#x27;extraction d&#x27;éventuels microservices ensuite. C&#x27;est en tout cas le conseil de l&#x27;auteur.</li>
<li class="nx-my-2">Pour autant, de nombreuses équipes préfèrent identifier une fonctionnalité, et la recoder dans un microservice sans refactorer le monolithe.</li>
<li class="nx-my-2">Dans tous les cas, l&#x27;auteur recommande une <strong>approche incrémentale</strong> : si la réécriture du service se compte en jours ou semaines ça peut être OK, si ça se compte en mois, il vaut mieux adopter une approche plus incrémentale.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Dans la suite du chapitre, on voit des patterns de migration, qui permettent d&#x27;extraire du code sous forme d&#x27;un microservice cohabitant avec le monolithe.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Chaque pattern a des avantages et des inconvénients, il faut les comprendre pour pouvoir prendre à chaque fois le plus adapté.</li>
<li class="nx-my-2"><strong>On extrait toujours les microservices un par un</strong>, en apprenant des erreurs pour le prochain.</li>
</ul>
</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Pattern: Strangler Fig Application<span class="nx-absolute -nx-mt-20" id="pattern-strangler-fig-application"></span><a href="#pattern-strangler-fig-application" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">C&#x27;est un des patterns les plus utilisés, et ça se base sur l&#x27;image d&#x27;un figuier qui s&#x27;implante sur un arbre existant, plante ses racines, et petit à petit &quot;étrangle&quot; l&#x27;arbre qui finira par mourir sans ressources, laissant le figuier à sa place.</li>
<li class="nx-my-2">Cette technique permet d&#x27;avoir la nouvelle version en parallèle de l&#x27;ancienne. On fait grossir petit à petit les fonctionnalités de la nouvelle, puis on fait le switch quand le microservice est prêt à remplacer la fonctionnalité dans le monolithe.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut faire la différence entre <strong>deployment</strong> et <strong>release</strong> : on intègre et déploie régulièrement ce qu&#x27;on fait en production, pour éviter les problèmes de merge et dérisquer le plus possible de choses en production, mais on n&#x27;active la fonctionnalité que quand elle est prête.</li>
<li class="nx-my-2">Concrètement, vu qu&#x27;on est en train de sortir un microservice qui va tourner sur un processus à part, le switch se passe <strong>au niveau réseau</strong> : tant que le microservice n&#x27;est pas prêt, les requêtes concernant sa fonctionnalité vont vers le monolithe, et quand on veut le release, on les redirige vers lui.</li>
<li class="nx-my-2">Si attendre que le microservice soit fini n&#x27;est pas assez incrémental pour nous, on peut aussi commencer à rediriger une partie des requêtes du monolithe vers le microservice, en fonction de ce qui a déjà été implémenté.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ça va par contre nous obliger à partager temporairement la même DB entre la fonctionnalité dans le monolithe, et celle dans le microservice.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Cette technique a l&#x27;avantage de <strong>ne pas avoir à toucher au monolithe</strong> dans le cas où la portion de fonctionnalité qu&#x27;on sort est <strong>autonome</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour ça il faut qu&#x27;elle n&#x27;ait pas besoin de faire d&#x27;appel vers le monolithe, et que le monolithe n&#x27;ait pas besoin de faire d&#x27;appel vers elle non plus.</li>
<li class="nx-my-2">Dans le cas où la fonctionnalité doit faire des appels vers le monolithe, il faudra que le monolithe expose des endpoints, et donc on devra le modifier.</li>
<li class="nx-my-2">Si c&#x27;est le monolithe qui doit faire des appels vers le microservice, alors on ne peut pas vraiment utiliser cette technique : on ne pourra pas faire le switch de la fonctionnalité au niveau réseau.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On pourra à la place utiliser le pattern <em>Branch by Abstraction</em> par exemple.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Exemple : HTTP Reverse Proxy</strong> : HTTP permet très facilement de faire de la redirection.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si notre monolithe reçoit des requêtes HTTP, on va pouvoir mettre en place un proxy pour router les requêtes entre le monolithe et le microservice.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Étape 1 : On met en place le proxy, et on le configure pour laisser passer les requêtes comme avant vers le monolithe.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ça nous permet de nous assurer que la latence additionnelle d&#x27;une étape réseau de plus ne pose pas problème.</li>
<li class="nx-my-2">On peut aussi dès cette étape tester le mécanisme de redirection pour vérifier qu&#x27;il n&#x27;y aura pas de problème à le faire.</li>
</ul>
</li>
<li class="nx-my-2">Étape 2 : on implémente progressivement la fonctionnalité dans le microservice, vers lequel il n&#x27;y a aucun trafic.</li>
<li class="nx-my-2">Étape 3 : Quand le microservice est prêt, on redirige le trafic vers lui.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut remettre le trafic vers le monolithe s&#x27;il y a un problème.</li>
<li class="nx-my-2">Pour plus de facilité, la redirection peut être activée avec un <strong>feature toggle</strong>.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Pour ce qui est du proxy lui-même, ça va dépendre du protocole. Si on a du HTTP, on peut partir sur un serveur connu comme NGINX.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ca peut être par exemple sur le path : rediriger <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">/invoice/</code> vers le monolithe, et <code class="nx-border-black nx-border-opacity-[0.04] nx-bg-opacity-[0.03] nx-bg-black nx-break-words nx-rounded-md nx-border nx-py-0.5 nx-px-[.25em] nx-text-[.9em] dark:nx-border-white/10 dark:nx-bg-white/10  " dir="ltr">/payroll/</code> vers le microservice.</li>
<li class="nx-my-2">Si on route sur un contenu se trouvant dans le body d&#x27;une requête POST (NDLR : comme GraphQL), ça risque d&#x27;être un peu plus compliqué.</li>
<li class="nx-my-2">En tout cas, l&#x27;auteur <strong>déconseille de coder soi-même son proxy</strong> si on a besoin de quelque chose de custom.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les quelques fois où il a essayé, il a obtenu de très mauvaises performances.</li>
<li class="nx-my-2">Il conseille de plutôt partir d&#x27;un proxy existant comme NGINX, et de le personnaliser avec du code (du lua pour NGINX).</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Dans le cas où on voudrait que notre microservice supporte un autre protocole que celui du monolithe (par exemple gRPC au lieu de SOAP), on pourrait envisager faire la traduction dans le proxy.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour l&#x27;auteur c&#x27;est une mauvaise idée : si on le fait pour plusieurs microservices, on va finir par complexifier ce proxy partagé, alors qu&#x27;on voulait que les microservices soient indépendants.</li>
<li class="nx-my-2">L&#x27;auteur conseille plutôt de faire ce mapping de protocole dans chacun des microservices qui en ont besoin, et éventuellement de faire en sorte qu&#x27;ils supportent les deux protocoles.</li>
<li class="nx-my-2">On peut aussi aller vers le <strong>service mesh</strong> où chaque microservice a son proxy local, qui peut faire les redirections et mapping qu&#x27;il veut.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les outils les plus connus pour ça sont <strong>Linkerd</strong> et <strong>Istio</strong>.</li>
<li class="nx-my-2">Square a mis en place le service mesh et en a fait <a href="https://squ.re/2nts1Gc" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">un article<span class="nx-sr-only"> (opens in a new tab)</span></a>.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Exemple : FTP</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;entreprise suisse Homegate a utilisé le strangler fig pattern pour extraire des microservices, et en profiter pour changer le protocole utilisé pour uploader des fichiers : de FTP vers HTTP.</li>
<li class="nx-my-2">Mais ils voulaient qu&#x27;il n&#x27;y ait pas de changement pour les utilisateurs.</li>
<li class="nx-my-2">Donc ils ont mis en place une interception des appels FTP, et le remapping vers du HTTP pour taper dans le microservice responsable de ça.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Exemple : Message Interception</strong> : dans le cas de messages <strong>asynchrones</strong> à router vers le nouveau microservice.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Une première possibilité est le <strong>content-based routing</strong>, où un router va consommer tous les messages du message broker, et les queuer sur deux autres queues : une pour le monolithe, et une pour le microservice extrait.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ce pattern vient d&#x27;<strong><em>Enterprise Integration Patterns</em></strong>. Et de manière générale l&#x27;auteur recommande ce livre pour des patterns de communication asynchrone.</li>
<li class="nx-my-2">L&#x27;avantage c&#x27;est qu&#x27;on n&#x27;a pas à toucher au monolithe.</li>
<li class="nx-my-2">L&#x27;inconvénient c&#x27;est qu&#x27;on complexifie là encore le système de communication plutôt que les programmes. Donc l&#x27;auteur est plutôt réticent.</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;autre possibilité c&#x27;est la <strong>selective consumption</strong>, où le monolithe et le microservice consomment sur la même queue, mais sélectionnent les messages qui leur sont destinés.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;avantage c&#x27;est qu&#x27;il n&#x27;y a pas de complexité dans le mécanisme de communication.</li>
<li class="nx-my-2">Parmi les désavantages :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le message broker pourrait ne pas supporter la consommation sélective.</li>
<li class="nx-my-2">Il faut déployer les changements dans le monolithe et dans le microservice en même temps pour que la consommation se passe bien.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Dans le cas où on veut <strong>ajouter des fonctionnalités</strong> ou fixer des bugs en même temps qu&#x27;on implémente le microservice, il faut bien garder en tête que <strong>le rollback sera alors plus difficile</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il n&#x27;y a pas de solution facile : soit on accepte que le rollback sera plus compliqué à faire, soit on freeze les features sur la partie extraite en microservice tant que l&#x27;extraction est en cours.</li>
</ul>
</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Pattern: UI Composition<span class="nx-absolute -nx-mt-20" id="pattern-ui-composition"></span><a href="#pattern-ui-composition" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;interface utilisateur doit aussi être découpée par considérations business, pour obtenir des slices verticaux avec les microservices.</li>
<li class="nx-my-2"><strong>Exemple : Page Composition</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur a travaillé chez The Guardian, où la migration a été réalisée à plusieurs reprises page par page.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La 2ème fois en utilisant un CDN pour le routing redirigé progressivement vers les nouvelles pages.</li>
</ul>
</li>
<li class="nx-my-2">REA Group, une entreprise immobilière australienne, avait plusieurs équipes responsables de parties différentes du site, et donc la séparation par pages avait dans ce cas encore plus de sens.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Exemple : Widget Composition.</strong>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">De nombreuses entreprises utilisent la séparation en widgets pour suivre les microservices.</li>
<li class="nx-my-2">C&#x27;est le cas par exemple d&#x27;Orbits qui avait une UI décomposée en widgets majeurs sous la responsabilité d&#x27;équipes différentes.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Quand ils ont voulu migrer vers des microservices, ils ont pu le faire incrémentalement, en suivant le découpage des widgets côté front.</li>
</ul>
</li>
<li class="nx-my-2">Un des avantages de cette séparation c&#x27;est que même quand un des widgets ne fonctionne pas, le reste peut être affiché.</li>
</ul>
</li>
<li class="nx-my-2">Côté <strong>applications mobiles</strong> (Android / iOS), on est face à des monolithes de fait, puisqu&#x27;il faut tout redéployer et faire retélécharger à l&#x27;utilisateur à chaque changement.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">De nombreuses entreprises (comme Spotify cf. <a href="https://www.youtube.com/watch?v=vuCfKjOwZdU" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">video<span class="nx-sr-only"> (opens in a new tab)</span></a>) utilisent des composants affichés qui viennent du backend, pour ne pas avoir à redéployer l&#x27;app mobile quand ils y font un changement.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Exemple : Micro Frontends</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il s&#x27;agit de faire des composants indépendants dans un frontend de type SPA, avec des bouts de React, Vue, etc. cohabitant et partageant de l&#x27;information, mais sans se gêner.</li>
</ul>
</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Pattern: Branch by Abstraction<span class="nx-absolute -nx-mt-20" id="pattern-branch-by-abstraction"></span><a href="#pattern-branch-by-abstraction" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans le cas où le Strangler fig pattern n&#x27;est pas possible parce que le composant qu&#x27;on veut extraire est profondément ancré dans le monolithe (il reçoit des appels des autres composants du monolithe par exemple), on peut utiliser cette technique.</li>
<li class="nx-my-2">On va travailler sur une version alternative du composant <strong>à l&#x27;intérieur même du monolithe</strong>, et l&#x27;activer à la fin.</li>
<li class="nx-my-2">Il s&#x27;agit du même principe qu&#x27;une branche du gestionnaire de versions, à la différence que là on travaille en intégration continue, et déploiement continu (bien qu&#x27;on ne <em>release</em> qu&#x27;au moment où le microservice est prêt).<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur n&#x27;insiste pas trop sur les nombreux problèmes d&#x27;une branche de gestionnaire de version qui dure longtemps, mais nous conseille de jeter un œil au <em>State of DevOps Report</em> pour nous en convaincre.</li>
</ul>
</li>
<li class="nx-my-2">Concrètement :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">1 - On crée une abstraction devant la fonctionnalité qu&#x27;on va remplacer.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Cette étape peut être plus ou moins complexe, en fonction de la taille de l&#x27;API qu&#x27;on expose aux autres modules.</li>
<li class="nx-my-2">Il peut être nécessaire de définir un <em>seam</em> à extraire.</li>
</ul>
</li>
<li class="nx-my-2">2 - On fait en sorte que les clients de notre fonctionnalité utilisent cette abstraction pour y accéder.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La migration doit être incrémentale.</li>
</ul>
</li>
<li class="nx-my-2">3 - On crée une nouvelle implémentation de la fonctionnalité.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La nouvelle implémentation dans le monolithe va juste faire des appels vers le microservice qu&#x27;on développe à l&#x27;extérieur du monolithe.</li>
<li class="nx-my-2">On migre les fonctionnalités de manière incrémentale.</li>
</ul>
</li>
<li class="nx-my-2">4 - On pointe l&#x27;abstraction sur la nouvelle fonctionnalité développée.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Comme avec le strangler fig pattern, on aimerait bien avoir un feature toggle pour pouvoir activer et désactiver la nouvelle fonctionnalité sans changer le code.</li>
</ul>
</li>
<li class="nx-my-2">5 - On enlève l&#x27;abstraction et l&#x27;ancienne implémentation.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il se peut que l&#x27;abstraction ait un intérêt en elle-même, dans cas on peut éventuellement la laisser.</li>
<li class="nx-my-2">Il faut bien penser à enlever les éventuels feature toggles.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Il existe une variante qui s&#x27;appelle <strong>Verify branch by abstraction</strong> : on appelle la nouvelle implémentation d&#x27;abord, et si elle échoue, on fallback sur l&#x27;ancienne.</li>
<li class="nx-my-2">Quand l&#x27;utiliser :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Cette technique est à utiliser <strong>à chaque fois qu&#x27;un changement va prendre du temps</strong>, et qu&#x27;on veut ne pas empêcher les autres d&#x27;avancer sur ce qu&#x27;ils font, tout en restant sur de l&#x27;intégration continue.</li>
<li class="nx-my-2">Pour les microservices, l&#x27;auteur conseille d&#x27;utiliser en priorité le strangler fig pattern, parce qu&#x27;il est plus simple.</li>
<li class="nx-my-2">Si on ne peut pas toucher au code du monolithe, alors il faut choisir une autre technique que celle-là.</li>
</ul>
</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Pattern: Parallel Run<span class="nx-absolute -nx-mt-20" id="pattern-parallel-run"></span><a href="#pattern-parallel-run" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Quand on a besoin d&#x27;un <strong>grand degré de fiabilité</strong>, on peut jouer les deux implémentations en parallèle, pour vérifier que le résultat est bien le même.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il n&#x27;y a qu&#x27;une des implémentations qui sera la source de vérité : en général l&#x27;ancienne jusqu&#x27;à ce qu&#x27;on décide que la nouvelle a fait ses preuves et qu&#x27;on n&#x27;a plus besoin de l&#x27;ancienne.</li>
<li class="nx-my-2">On peut <strong>vérifier le résultat, mais aussi des éléments non-fonctionnels</strong> comme le temps de réponse et le nombre de timeouts.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Exemple : calcul de produits financiers dérivés</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur a travaillé sur le système d&#x27;une banque, où il s&#x27;agissait de refaire le calcul de produits dérivés.</li>
<li class="nx-my-2">L&#x27;enjeu financier étant important, ils ont décidé de jouer les deux systèmes en parallèle, et de recueillir la différence entre les deux par des batchs journaliers.</li>
<li class="nx-my-2">Ils ont fini par changer la source de vérité vers le nouveau système après un mois, et ont enlevé l&#x27;ancien après quelques mois de plus.</li>
</ul>
</li>
<li class="nx-my-2">Pour vérifier des side-effects qu&#x27;on n&#x27;a envie de faire qu&#x27;une fois (comme le fait d&#x27;envoyer un email), on peut utiliser des <strong>spies</strong>, comme dans les unit tests mais en production.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il vaut mieux faire les vérifications à partir du microservice plutôt qu&#x27;à partir de la partie de la nouvelle fonctionnalité qui est dans le monolithe, pour tester le plus possible de choses.</li>
<li class="nx-my-2">Les vérifications peuvent être faites en asynchrone, en enregistrant les appels quelque part, et en vérifiant plus tard qu&#x27;on a bien eu la même chose que pour l&#x27;autre implémentation.</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;auteur conseille <a href="https://github.com/github/scientist" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">Github Scientist<span class="nx-sr-only"> (opens in a new tab)</span></a> (existant en plusieurs langages) pour aider à implémenter ce pattern.</li>
<li class="nx-my-2">Le <strong>canary release</strong> consiste à releaser d&#x27;abord auprès d&#x27;un nombre réduit de clients.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le <strong>dark launching</strong> consiste à déployer pour tester, mais à ne pas releaser auprès des clients.</li>
<li class="nx-my-2">Le parallel run est une forme de dark launching.</li>
<li class="nx-my-2">L&#x27;ensemble de ces techniques font partie de la <strong>progressive delivery</strong>.</li>
</ul>
</li>
<li class="nx-my-2">Ce pattern est très utile dans certains cas, mais a un coût de mise en place.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur ne l&#x27;a utilisé qu&#x27;une ou deux fois dans sa carrière.</li>
</ul>
</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Pattern: Decorating Collaborator<span class="nx-absolute -nx-mt-20" id="pattern-decorating-collaborator"></span><a href="#pattern-decorating-collaborator" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Cette technique permet de <strong>ne pas avoir à modifier le monolithe</strong>, tout en permettant de <strong>déclencher quelque chose à partir de ce que fait le monolithe</strong>.</li>
<li class="nx-my-2">On laisse l&#x27;appel aller dans le monolithe et en sortir, et on l&#x27;intercepte à la sortie, pour éventuellement faire un appel vers notre microservice.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">De la logique va donc se retrouver dans le proxy qui décide de faire l&#x27;appel au microservice. Attention à ce que cette logique ne devienne pas trop complexe.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Exemple : Loyalty Program</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On a un monolithe qui traite un ordre d&#x27;achat. On veut y ajouter une fonctionnalité de points de fidélité, mais le monolithe est compliqué et on ne veut pas le modifier maintenant.</li>
<li class="nx-my-2">Le proxy va récupérer la réponse du monolithe avant qu&#x27;elle n&#x27;aille au client, et faire un appel au microservice qui s&#x27;occupe d&#x27;allouer les points de fidélité.</li>
</ul>
</li>
<li class="nx-my-2">Si on n&#x27;a pas suffisamment d&#x27;infos suite à l&#x27;appel intercepté, on <strong>risque d&#x27;avoir besoin de refaire un appel au monolithe</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur conseille d&#x27;y réfléchir à deux fois avant d&#x27;utiliser ce pattern dans le cas où l&#x27;information ne se trouve pas dans l&#x27;appel intercepté.</li>
</ul>
</li>
<li class="nx-my-2">Une alternative à ce pattern peut être le pattern <strong>change data capture</strong>.</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Pattern: Change Data Capture<span class="nx-absolute -nx-mt-20" id="pattern-change-data-capture"></span><a href="#pattern-change-data-capture" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Cette technique est plus invasive que decorating collaborator : on va <strong>écouter les changements issus de la DB</strong>, et y faire réagir notre microservice.</li>
<li class="nx-my-2"><strong>Exemple : Issuing Loyalty Cards</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On a un monolithe qui permet de créer des comptes de fidélité, et renvoie simplement que la création a fonctionné. Et on aimerait imprimer des cartes de fidélité à chaque fois.</li>
<li class="nx-my-2">Si on voulait utiliser le decorating collaborator pattern, il faudrait faire un appel supplémentaire au monolithe pour obtenir les informations manquantes, et que le monolithe expose une API pour ça.</li>
<li class="nx-my-2">On va donc plutôt écouter ce que dit la DB quand le monolithe insert le compte de fidélité, et alimenter notre microservice d&#x27;impression avec ça.</li>
</ul>
</li>
<li class="nx-my-2">Pour ce qui est de la <strong>manière de l&#x27;implémenter</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>Database triggers</strong> : c&#x27;est un mécanisme de stored procedures, fournis par la plupart des bases de données.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Attention à ne pas trop en utiliser, leur maintenance est difficile.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Transaction log pollers</strong> : la plupart des DB écrivent leurs données dans un fichier de log qui précède l&#x27;écriture dans la base. On peut simplement lire ce fichier.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">C&#x27;est une des solutions les plus intéressantes selon l&#x27;auteur, avec la contrainte qu&#x27;on a besoin de s&#x27;adapter à la structure spécifique du log de cette DB.</li>
<li class="nx-my-2">On a de nombreux outils qui lisent les logs, y compris certains qui les mettent dans un message broker.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Batch delta copier</strong> : il s&#x27;agirait d&#x27;écrire un programme qui compare régulièrement le contenu de la DB, et qui réagit s&#x27;il y a un changement.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le problème c&#x27;est de réussir à savoir s&#x27;il y a un changement. Certaines DB le permettent, mais pas forcément au niveau du row, auquel cas il faudrait ajouter nous-mêmes des timestamps pour savoir qu&#x27;est-ce qui a changé quand.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Ce pattern est utile quand on a besoin de réagir au monolithe, mais quand on ne peut pas vraiment mettre en place le strangler fig ou le decorating collaborator, et qu&#x27;on ne peut pas non plus changer le monolithe.</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">4 - Decomposing the Database<span class="nx-absolute -nx-mt-20" id="4---decomposing-the-database"></span><a href="#4---decomposing-the-database" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Pattern: The Shared Database<span class="nx-absolute -nx-mt-20" id="pattern-the-shared-database"></span><a href="#pattern-the-shared-database" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Partager la DB veut dire ne pas avoir la possibilité de <strong>choisir ce qu&#x27;on cache</strong> et ce qu&#x27;on montre, et même ne pas savoir ce qui est utilisé par d&#x27;autres.</li>
<li class="nx-my-2">Dans le cas où plusieurs services peuvent modifier la DB partagée, on ne sait plus qui la contrôle. Et la logique de modification est dupliquée et peut diverger.</li>
<li class="nx-my-2">La DB doit être privée à chaque microservice. Le partage publique d&#x27;une DB n&#x27;est approprié que dans deux cas :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">1 - Une DB avec des <strong>données de référence</strong> read-only très stables (par exemple la liste des pays existants ou des codes postaux).</li>
<li class="nx-my-2">2 - Dans le cas du pattern <strong>Database-as-a-Service Interface</strong>, où on partage une DB read-only, distincte de notre DB interne.</li>
</ul>
</li>
<li class="nx-my-2">Même si la bonne solution dans la plupart des cas c&#x27;est de splitter la DB du monolithe dans les nouveaux microservices, on a des techniques qui permettent d&#x27;aller dans la bonne direction à peu de frais et d&#x27;arrêter l&#x27;hémorragie, en ajoutant des abstractions par dessus la DB du monolithe.</li>
</ul>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Pattern: Database View<span class="nx-absolute -nx-mt-20" id="pattern-database-view"></span><a href="#pattern-database-view" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On crée une view par dessus la DB, et on demande aux clients d&#x27;utiliser la view. De cette manière on peut modifier la DB source comme si elle était privée, en adaptant la view pour qu&#x27;elle soit stable pour les clients.</li>
<li class="nx-my-2"><strong>Exemple : Database as a public contract</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur travaillait dans une banque, et ils ont remarqué qu&#x27;un problème de performance majeur pouvait être corrigé en restructurant le schéma de leur DB.</li>
<li class="nx-my-2">Malheureusement la DB était utilisée par plus de 20 applications (sans même savoir lesquelles) partageant les mêmes credentials.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour la question des credentials, l&#x27;auteur conseille <em>HashiCorp Vault</em> qui permet de gérer un grand nombre de credentials facilement.</li>
</ul>
</li>
<li class="nx-my-2">Ils ont mis en place des views comme solution temporaire pour pouvoir restructurer la DB sans impacter les clients.</li>
</ul>
</li>
<li class="nx-my-2">Une view peut aussi simplement cacher des champs ou des tables, et permettre de décider ce qu&#x27;on veut montrer ou non publiquement.</li>
<li class="nx-my-2">Les views ont quelques limitations :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Elles peuvent poser des problèmes de performance, et la version materialized de la view est plus efficace, mais contiendra des données anciennes, datant de la dernière fois qu&#x27;on a fait un update.</li>
<li class="nx-my-2">Elles sont <strong>read-only</strong>.</li>
<li class="nx-my-2">Toutes les DB n&#x27;ont pas la fonctionnalité. Les DB relationnelles l&#x27;ont, et certaines DB NoSQL aussi (c&#x27;est le cas de <strong>Cassandra</strong> et <strong>Mongo</strong> par exemple).</li>
<li class="nx-my-2">Il est probable que le schéma de la view doive se trouver sur la même database engine que le schéma initial.</li>
</ul>
</li>
<li class="nx-my-2">En termes d&#x27;ownership, l&#x27;auteur conseille de le donner à l&#x27;équipe qui a la charge de la DB source.</li>
<li class="nx-my-2">Cette étape va dans la bonne direction, mais l&#x27;auteur déconseille de faire ça à la place d&#x27;une décomposition de la DB sans avoir de bonnes raisons.</li>
</ul>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Pattern: Database Wrapping Service<span class="nx-absolute -nx-mt-20" id="pattern-database-wrapping-service"></span><a href="#pattern-database-wrapping-service" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Une autre manière de cacher la DB pour arrêter l&#x27;hémorragie c&#x27;est de la mettre derrière un service, et demander aux clients d&#x27;y accéder via ce service.</li>
<li class="nx-my-2"><strong>Exemple : banque australienne</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur a travaillé pour une banque qui avait un problème de scalabilité de sa DB.</li>
<li class="nx-my-2">Malheureusement les autorisations étaient implémentées sous forme de stored procedures, et les toucher était trop dangereux.</li>
<li class="nx-my-2">Alors ils ont décidé de créer un service pour cacher la DB, et faire en sorte que la nouvelle logique autour des d&#x27;autorisations ne soit plus dans la DB elle-même, mais implémentée chez les clients.</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;avantage de ce pattern par rapport à la database view c&#x27;est qu&#x27;on peut mettre de la <strong>logique dans le service</strong>, et qu&#x27;on peut aussi proposer à nos clients d&#x27;<strong>écrire</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par contre, il faudra que nos clients <strong>utilisent l&#x27;API</strong> pour y accéder, et pas du SQL.</li>
</ul>
</li>
<li class="nx-my-2">Comme avec la database view, il s&#x27;agit plutôt d&#x27;une solution temporaire avant de faire des changements plus profonds pour séparer la DB dans les bons services.</li>
</ul>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Pattern: Database-as-a-Service Interface<span class="nx-absolute -nx-mt-20" id="pattern-database-as-a-service-interface"></span><a href="#pattern-database-as-a-service-interface" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Un des cas où on peut exposer une DB de manière publique c&#x27;est si les clients ont besoin de jouer des requêtes SQL directement sur les données qu&#x27;on propose.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple pour obtenir des insights business avec des outils comme Tableau. Martin Fowler parle du <a href="https://martinfowler.com/bliki/ReportingDatabase.html" target="_blank" rel="noreferrer" class="nx-text-primary-600 nx-underline nx-decoration-from-font [text-underline-position:from-font]">reporting database pattern<span class="nx-sr-only"> (opens in a new tab)</span></a>, mais l&#x27;auteur préfère généraliser le nom du pattern.</li>
<li class="nx-my-2">Par contre, il faut bien qu&#x27;on <strong>sépare cette DB publique de notre DB privée</strong>.</li>
<li class="nx-my-2">La DB exposée ne peut être que <strong>read-only</strong>.</li>
</ul>
</li>
<li class="nx-my-2">Pour implémenter, il propose que la DB publique soit synchronisée avec la DB privée au travers d&#x27;un <strong>mapping engine</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le mapping engine permet de garantir que les deux DB publique et privée peuvent diverger et fonctionner ensemble quand même.</li>
<li class="nx-my-2">Les écritures doivent se faire via API.</li>
<li class="nx-my-2">Il y aura donc une latence entre ce qu&#x27;on écrit, et ce qu&#x27;on lit de la DB publique qui pourrait être en retard dans la synchronisation.</li>
</ul>
</li>
<li class="nx-my-2">Pour ce qui est de la manière d&#x27;implémenter le mapping engine :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Une première solution robuste peut être d&#x27;utiliser le <strong>change data capture</strong> de la DB. Pour l&#x27;exploiter, il y a des outils comme <strong>Debezium</strong>.</li>
<li class="nx-my-2">Une autre solution serait d&#x27;avoir un batch process qui met à jour régulièrement la DB publique.</li>
<li class="nx-my-2">Et une 3ème option peut être d&#x27;émettre des <strong>events</strong>, et de reconstruire la DB à l&#x27;extérieur à partir de ceux-ci.</li>
</ul>
</li>
<li class="nx-my-2">Cette solution est plus avancée que le database view pattern, et aussi plus difficile à mettre en place d&#x27;un point de vue technique.</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Transferring Ownership<span class="nx-absolute -nx-mt-20" id="transferring-ownership"></span><a href="#transferring-ownership" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les précédents patterns permettaient juste de mettre en pansement sur une grosse DB, mais il faut que les bonnes données aillent au bon endroit.</li>
</ul>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Pattern: Aggregate Exposing Monolith<span class="nx-absolute -nx-mt-20" id="pattern-aggregate-exposing-monolith"></span><a href="#pattern-aggregate-exposing-monolith" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Quand on extrait un microservice, il y a parfois besoin d&#x27;accéder aux données qui sont encore dans le monolithe, ou de les modifier.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">S&#x27;il est légitime d&#x27;un point de vue domaine que ces données soient possédées par le monolithe, alors il peut <strong>exposer des endpoints</strong>.</li>
<li class="nx-my-2">Les données sont regroupées en aggregates, et sont associées à des machines à état sous forme de code. Quand le monolithe ou un microservice fournit des endpoints, il donne en fait la possibilité d&#x27;accéder à la machine à état pour savoir ce qu&#x27;on va pouvoir ou non faire avec les données.</li>
</ul>
</li>
<li class="nx-my-2">Le fait pour le monolithe de fournir des endpoints pour travailler avec certaines données, peut être une étape vers l&#x27;extraction d&#x27;un microservice organisé autour de ces données.</li>
<li class="nx-my-2"><strong>Faire des appels représente plus de travail</strong> que de faire des queries directement en DB, <strong>mais c&#x27;est bien mieux sur le long terme</strong>. Il ne faut recourir aux autres techniques (database view pattern etc.) que si on ne peut pas changer le monolithe.</li>
</ul>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Pattern: Change Data Ownership<span class="nx-absolute -nx-mt-20" id="pattern-change-data-ownership"></span><a href="#pattern-change-data-ownership" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans le cas où la donnée dont le microservice a besoin se trouve encore dans la DB du monolithe, mais que c&#x27;est le microservice qui devrait la posséder, il faut la <strong>déplacer dans le microservice</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le monolithe devra alors appeler le microservice pour obtenir la donnée, ou demander des changements.</li>
<li class="nx-my-2">La question de savoir si les données doivent appartenir au micorservice se résout en se demandant si la logique qui contrôle la donnée (automate à état de l’aggragate, contrôle des règles de consistance etc.) se trouve dans le microservice.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Déplacer de la donnée est difficile</strong>. Ça peut impliquer de devoir casser des foreign keys, des transactions etc. ce sujet est traité plus tard dans le chapitre.</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Data Synchronization<span class="nx-absolute -nx-mt-20" id="data-synchronization"></span><a href="#data-synchronization" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut avoir besoin de synchronisation entre la DB extraite dans le microservice et celle restée dans le monolithe.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, si on utilise le strangler fig pattern et qu&#x27;on switch vers le nouveau microservice, puis qu&#x27;on veut revenir en arrière, il faut que la DB qui est restée dans le monolithe soit synchronisée avec ce qui a pu être fait par le microservice et sa DB.</li>
</ul>
</li>
</ul>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Pattern: Synchronize Data in Application<span class="nx-absolute -nx-mt-20" id="pattern-synchronize-data-in-application"></span><a href="#pattern-synchronize-data-in-application" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Cette technique a été utilisée par l&#x27;auteur pour la migration des données des données médicales danoises, d&#x27;une DB MySQL à une DB Riak, pour des raisons de performance.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le système ne pouvait pas être arrêté pour suffisamment de temps, donc le changement a dû se faire de manière incrémentale.</li>
</ul>
</li>
<li class="nx-my-2">Ca se passe en 3 étapes :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>Étape 1 : Bulk Synchronize Data</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On migre les données vers la nouvelle DB, par exemple avec un batch job.</li>
<li class="nx-my-2">Quand le job est terminé, il peut y avoir encore les nouvelles données manquantes : on va tout de suite mettre en place un processus de <strong>change data capture</strong> pour alimenter la nouvelle DB depuis l&#x27;ancienne à chaque changement.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Étape 2 : Synchronize on Write, Read from Old Schema</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les fonctionnalités de production ne changent pas et utilisent toujours l&#x27;ancienne DB.</li>
<li class="nx-my-2">La nouvelle DB est mise à jour régulièrement, et on peut faire des vérifications dessus pour s&#x27;assurer qu&#x27;elle est mise à jour correctement.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Étape 3 : Synchronize on Write, Read from New Schema</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On continue d&#x27;écrire dans les deux DB, mais on lit depuis la nouvelle pour alimenter la production.</li>
<li class="nx-my-2">Une fois qu&#x27;on a suffisamment confiance dans la nouvelle DB, on peut éliminer l&#x27;ancienne.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Ce pattern peut être pertinent quand on <strong>migre la DB avant de migrer le code</strong>, pendant une extraction de microservice.</li>
<li class="nx-my-2">Ce pattern nous donne l&#x27;avantage de facilement pouvoir faire le switch du microservice vers le monolithe, avec une DB déjà séparée.</li>
<li class="nx-my-2">Attention à ne pas utiliser ce pattern si à un moment donné, à la fois le monolithe et le microservice doivent écrire dans leurs DBs.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">C&#x27;est par exemple une mauvaise idée si on utilise un système de canary release.</li>
</ul>
</li>
</ul>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Pattern: Tracer Write<span class="nx-absolute -nx-mt-20" id="pattern-tracer-write"></span><a href="#pattern-tracer-write" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ce pattern consiste à déplacer les données <strong>progressivement</strong> vers le microservice.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les données sont initialement lues et écrites dans le monolithe.</li>
<li class="nx-my-2">Dès qu&#x27;un bloc de données est déplacé, le microservice devient la source de vérité pour ce bloc, et le monolithe comme les autres microservices devront le lire depuis là.</li>
<li class="nx-my-2">On continue jusqu&#x27;à ce que l&#x27;ensemble des données à déplacer soient lues depuis le microservice (tout en restant synchronisées dans le monolithe en cas de besoin de switch).</li>
</ul>
</li>
<li class="nx-my-2">Pour ce qui est de la synchronisation elle-même :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur conseille d&#x27;envoyer les commandes d&#x27;écriture à la bonne source de vérité, et d&#x27;<strong>éviter les mécanisme de synchronisation à deux sens</strong> (écrire dans n&#x27;importe quelle source et avoir une synchronisation en arrière-plan), parce que c&#x27;est difficile à implémenter.</li>
<li class="nx-my-2">Il faut s&#x27;attendre à avoir une certaine latence entre les deux sources, et donc prévoir une <strong>eventual consistency</strong>, étant donné que pour certaines données la première sera la source de vérité, et pour d&#x27;autres données ce sera la 2ème.</li>
<li class="nx-my-2">Si on a un système event driven, ou un mécanisme de change data capture, on aura des facilités à implémenter le pattern.</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;auteur conseille de prévoir un mécanisme de vérification de l&#x27;intégrité des données entre les deux sources (par exemple des scripts SQL), pour s&#x27;assurer que tout va bien.</li>
<li class="nx-my-2">Ce pattern a notamment été utilisé chez Square, pour extraire de manière incrémentale un microservice pour découpler leur système de commande de nourriture.</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Splitting Apart the Database<span class="nx-absolute -nx-mt-20" id="splitting-apart-the-database"></span><a href="#splitting-apart-the-database" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On parle ici de séparation de <strong>schémas logiques</strong>, qui peuvent être sur une même database engine, ou sur différentes database engines.</li>
<li class="nx-my-2">L&#x27;auteur conseille d&#x27;utiliser un outil pour gérer les migrations sur chaque DB. Il conseille en particulier <strong>FlywayDB</strong>.</li>
<li class="nx-my-2">Pour extraire un microservice, on doit extraire le code, et la donnée qui lui appartient. On peut faire :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>D&#x27;abord le split de la DB</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On se donne alors la possibilité de switcher vers le nouveau microservice ou vers le monolithe sans perte de données.</li>
<li class="nx-my-2">Le problème c&#x27;est qu&#x27;on n&#x27;aura pas de gain court terme quand on aura extrait la donnée.</li>
<li class="nx-my-2"><strong>Pattern: Repository per bounded context</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On a en général une couche de repository qui permet de mapper le code à la DB. Il s&#x27;agit ici de <strong>découper ce repository</strong> en suivant les lignes de nos bounded contexts.</li>
<li class="nx-my-2">Ça va nous aider à y voir plus clair sur quel bounded context utilise quelle donnée extérieure à lui.</li>
<li class="nx-my-2">On peut ajouter à ça un outil pour visualiser la structure de la DB, comme <strong>SchemaSpy</strong>.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Pattern: Database per bounded context</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Avant de séparer le code de chaque bounded context en microservice, on va ici séparer les données.</li>
<li class="nx-my-2">Chez ThoughtWorks, un mécanisme de calcul a été modularisé, avec chaque module ayant sa DB, ce qui a fait un excellent exemple de modular monolith. L&#x27;extraction de microservices n&#x27;a jamais été faite.</li>
<li class="nx-my-2">L&#x27;auteur <strong>recommande ce pattern aux startups</strong> qui ne devraient pas encore extraire de microservices, mais qui peuvent comme ça réduire la complexité de leur système.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>D&#x27;abord le split du code</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;avantage c&#x27;est qu&#x27;on va avoir des résultats rapides en ayant un code plus modulaire, et un artefact déployable indépendamment.</li>
<li class="nx-my-2">L&#x27;inconvénient c&#x27;est que parfois les équipes migrent le code, et ne migrent pas la donnée ensuite, ce qui amène de la douleur à long terme.</li>
<li class="nx-my-2"><strong>Pattern: Monolith as data access layer</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Au lieu de laisser notre microservice accéder à de la donnée qui devrait lui appartenir dans la DB du monolithe, on expose une API dans le monolithe, et le microservice l&#x27;utilise.</li>
<li class="nx-my-2">Il faut le faire seulement si du code gérant cette donnée est encore dans le monolithe.</li>
<li class="nx-my-2">Ça permet de <strong>cacher l&#x27;information</strong>, le temps de migrer la donnée et son code vers le microservice (ou dans le cas où on aurait décidé de ne pas déplacer la donnée).</li>
</ul>
</li>
<li class="nx-my-2"><strong>Pattern: Multischema storage</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La migration des données prend du temps, mais on peut profiter des nouvelles features pour aller dans le bon sens et placer la donnée dans le microservice.</li>
<li class="nx-my-2">On se retrouve alors temporairement avec de la donnée dans le microservice, et de la donnée pas encore migrée dans le monolithe.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Split les deux en même temps</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur le déconseille : c&#x27;est une trop grosse étape qui ne permet pas d&#x27;avoir du feedback suffisamment rapidement sur ce qu&#x27;on fait.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Schema Separation Examples<span class="nx-absolute -nx-mt-20" id="schema-separation-examples"></span><a href="#schema-separation-examples" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Pattern: Split Table<span class="nx-absolute -nx-mt-20" id="pattern-split-table"></span><a href="#pattern-split-table" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut avoir des cas où <strong>une table contient des données qui doivent aller dans deux microservices différents</strong>. Dans ce cas, il faut les <strong>séparer dans deux tables</strong> avant de les extraire aux bons endroits.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Un exemple peut être une table qui contient une colonne <em>item</em> et une colonne <em>stock level</em>, avec les données de ces colonnes devant respectivement aller vers le service <em>Catalog</em> et <em>Warehouse</em>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On va dans ce cas simplement extraire les deux colonnes dans deux tables différentes.</li>
</ul>
</li>
<li class="nx-my-2">Un exemple plus complexe peut être d&#x27;avoir une colonne <em>status</em>, qui est écrite par du code appartenant à deux bounded contexts à extraire : <em>Customer Management</em> le met à jour pour indiquer si l&#x27;utilisateur est vérifié ou non, et <em>Finance</em> peut le mettre à jour pour indiquer que l&#x27;utilisateur est suspendu parce qu&#x27;il n&#x27;a pas payé.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans ce cas précis, on pourrait décider que cette colonne doit appartenir à <em>Customer Management _parce qu&#x27;il s&#x27;agit de gérer les utilisateurs, auquel cas _Finance</em> devra faire un appel vers <em>Customer Management</em> à chaque fois qu&#x27;il faudra suspendre un utilisateur.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Il faut bien un seul bounded context qui &quot;possède&quot; chaque donnée.</li>
</ul>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Pattern: Move Foreign-Key Relationship to Code<span class="nx-absolute -nx-mt-20" id="pattern-move-foreign-key-relationship-to-code"></span><a href="#pattern-move-foreign-key-relationship-to-code" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On a régulièrement besoin de faire des <strong>foreign keys</strong> d&#x27;une table à une autre, à la fois pour que la DB garantisse la consistance des données, et aussi pour des raisons de performance quand on fait des jointures.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans le cas où l&#x27;association doit être faite vers une table possédée par un autre bounded context, on ne peut pas faire de foreign key DB, puisque <strong>les deux tables sont dans des DB différentes</strong>.</li>
</ul>
</li>
<li class="nx-my-2">La solution est de casser la relation de foreign key dans la DB, et de faire le lien dans le code.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Côté <strong>performance</strong> ce sera beaucoup moins bien. En fonction du besoin, on peut être amené à faire des recherches groupées, ou à créer un cache local de la donnée de l&#x27;autre microservice, contre laquelle on veut faire une jointure.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Des outils comme <strong>Jaeger</strong> permettent de mesurer la latence, pour voir si même plus lente, elle n&#x27;est pas acceptable quand même.</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;autre problème c&#x27;est la <strong>consistance</strong> qui n&#x27;est plus garantie par la DB : la donnée qui est liée à notre donnée peut être supprimée sans qu&#x27;on ne le sache.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On pourrait vérifier qu&#x27;aucun microservice n&#x27;a de lien vers nos données avant d&#x27;en supprimer. Mais il faudrait alors un mécanisme de lock, et il faudrait le faire avec de nombreux services. L&#x27;auteur le déconseille fortement.</li>
<li class="nx-my-2">Une meilleure solution peut être que le service ayant besoin du lien prenne en compte que l&#x27;autre peut à tout moment répondre que l&#x27;objet n&#x27;existe plus.</li>
<li class="nx-my-2">On pourrait aussi consommer des events de surpression dans les services qui ont besoin du lien, pour pouvoir mettre à jour leur cache local de la DB du service visé par le lien.</li>
<li class="nx-my-2">Et une dernière solution acceptable peut aussi être de ne pas permettre la suppression de rows qui pourraient être liées dans d&#x27;autres microservices.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La solution peut être dans ce cas de faire un soft delete avec un champ.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Attention à ne pas casser une relation entre des choses qui devraient faire partie du même aggregate.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, si on a une table <em>Order</em>, et une table <em>OrderLines</em> qui contient le détail des articles commandés, ils devraient clairement faire partie du même aggregate et rester ensemble. Les séparer mènerait à des problèmes d&#x27;intégrité.</li>
</ul>
</li>
</ul>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Exemple : Shared Static Data<span class="nx-absolute -nx-mt-20" id="exemple--shared-static-data"></span><a href="#exemple--shared-static-data" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On parle ici de <strong>reference data</strong>, par exemple des codes de pays qu&#x27;on finit par mettre en base.</li>
<li class="nx-my-2"><strong>Pattern: duplicate static reference data</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Chaque microservice va dupliquer la donnée dans sa DB.</li>
<li class="nx-my-2">En fonction du contexte, une inconsistance de ces données entre microservices peut ou non être un problème important.</li>
<li class="nx-my-2">Dans le cas où ça l&#x27;est, on peut avoir un système de synchronisation qui fonctionne en arrière-plan.</li>
<li class="nx-my-2">Ce pattern est à utiliser rarement, si on a de grands sets de données, ou si on doit faire des jointures contre ces données.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Pattern: Dedicated reference data schema</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On met en place une DB publique, partagée entre plusieurs microservies.</li>
<li class="nx-my-2">Le fait qu&#x27;elle soit stable fait que la rendre publique n&#x27;est pas très dangereux.</li>
<li class="nx-my-2">Attention par contre aux potentiels changements de structure qui seraient très difficiles à gérer.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Pattern: Static reference data library</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans le cas où notre jeu de données est petit (comme les codes de pays), on peut les mettre sous forme de code dans une librairie installée par les microservices qui en ont besoin.</li>
<li class="nx-my-2">Par contre, un point négatif c&#x27;est que la librairie peut créer un besoin de déploiement de plusieurs microservices en même temps dans le cas où son contenu change : on crée de la dépendance entre microservices.</li>
<li class="nx-my-2">Ce pattern est particulièrement utile quand il est acceptable d&#x27;avoir plusieurs versions de la donnée dans divers microservices.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Pattern: Static reference data service</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut créer un microservice à consulter pour connaître les reference data.</li>
<li class="nx-my-2">Si la création et le déploiement d&#x27;un microservice simple prend des jours ou plus dans notre organisation, alors ce pattern ne vaut pas le coup, sinon on peut le faire.</li>
<li class="nx-my-2">Typiquement ce serait un bon candidat pour du <em>Function-as-a-Service</em> dans des plateformes cloud.</li>
<li class="nx-my-2">Côté performance, ce pattern peut être plus rapide que de mettre les données en base puisque le microservice pourra les avoir sous forme de code.</li>
</ul>
</li>
<li class="nx-my-2">Pour résumer :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si on n&#x27;a pas besoin que les données soient consistantes entre les services, on peut utiliser une librairie partagée.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si la donnée est plus grosse on peut la mettre en DB, localement dans chaque service.</li>
</ul>
</li>
<li class="nx-my-2">Si la donnée a besoin d&#x27;être consistante, on peut créer un service dédié.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si la création d&#x27;un service coûte trop cher, on peut créer une DB partagée pour ces données.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-2xl">Transactions<span class="nx-absolute -nx-mt-20" id="transactions"></span><a href="#transactions" class="subheading-anchor" aria-label="Permalink for this section"></a></h3>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">En général les DB garantissent les transactions ACID :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>Atomicity</strong> : soit l&#x27;ensemble de la transaction réussit, soit rien ne réussit.</li>
<li class="nx-my-2"><strong>Consistency</strong> : l&#x27;état de la DB reste consistant avec toutes les contraintes respectées avant et après la transaction.</li>
<li class="nx-my-2"><strong>Isolation</strong> : plusieurs transactions peuvent avoir lieu en même temps sans se gêner.</li>
<li class="nx-my-2"><strong>Durability</strong> : une transaction validée reste en base, même en cas de panne.</li>
</ul>
</li>
<li class="nx-my-2">En séparant les données en plusieurs schémas de DB, on perd la possibilité d&#x27;utiliser les transactions pour garantir la consistance de nos données entre bounded contexts.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les transactions sont quand même utilisées pour les données au sein des bounded contexts.</li>
<li class="nx-my-2">L&#x27;atomicity notamment peut poser problème d&#x27;un point de vue consistance des données.</li>
</ul>
</li>
<li class="nx-my-2">Pour répondre à ce problème on a plusieurs solutions, parmi elles il y a les <strong>transactions distribuées</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le <strong>Two-Phase Commit</strong> (2PC) est la technique la plus connue de transaction distribuée.</li>
<li class="nx-my-2">La transaction est séparée en deux phases :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">1 - Une phase de <strong>vote</strong> où le coordinateur central contacte toutes les parties prenantes de la transaction, pour leur demander si la transaction est possible pour eux.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Elles mettent un lock sur les données à modifier puis répondent OK.</li>
<li class="nx-my-2">Si toutes les parties prenantes sont OK, on peut aller à la phase 2, sinon on arrête la transaction.</li>
<li class="nx-my-2">Si on arrête la transaction, un message d&#x27;annulation sera envoyé à ceux qui avaient dit OK pour les débloquer.</li>
</ul>
</li>
<li class="nx-my-2">2 - Une phase de <strong>commit</strong> où le coordinateur demande à toutes les parties prenantes (qui ont déjà préparé le changement à faire et ont bloqué les données) d&#x27;appliquer les modifications.</li>
</ul>
</li>
<li class="nx-my-2">Ce système 2PC a des problèmes :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La latence peut conduire à avoir des incohérences temporaires sur les données de chaque système.</li>
<li class="nx-my-2">On a un gros risque de problèmes type deadlock où un des serveurs ne répond pas alors qu&#x27;il était censé avoir bloqué les données etc.</li>
<li class="nx-my-2">On lock des tables pour des durées potentiellement importantes, qui impactent la capacité à traiter d&#x27;autres opérations.</li>
</ul>
</li>
<li class="nx-my-2">Pour l&#x27;auteur, les transactions distribuées ont trop de problèmes pour valloir le coup : il vaut mieux ne pas les utiliser.</li>
</ul>
</li>
<li class="nx-my-2">Une autre alternative simple peut être tout simplement de <strong>laisser les données fortement liées ensemble dans la même DB</strong>, temporairement ou de manière permanente.</li>
</ul>
<h4 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-8 nx-text-xl">Sagas<span class="nx-absolute -nx-mt-20" id="sagas"></span><a href="#sagas" class="subheading-anchor" aria-label="Permalink for this section"></a></h4>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Une dernière solution pour répondre au problème des transactions distribuées est l&#x27;utilisation de <strong>sagas</strong>.</li>
<li class="nx-my-2">Il s&#x27;agit de <strong>découper la transaction en plus petites tâches</strong>, réalisables chacune au sein de transactions ACID garanties par des DBs.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;ensemble n&#x27;est pas atomique, et c&#x27;est à nous de choisir quelle action de compensation il faut faire dans le cas où la saga échoue à une des étapes de la saga.</li>
<li class="nx-my-2">Il faut penser à sauvegarder les informations d&#x27;une saga qui n&#x27;a pas pu aller jusqu&#x27;au bout.</li>
<li class="nx-my-2">Il existe deux manières de gérer l&#x27;échec à une des étapes de la saga :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La <strong>backward recovery</strong> consiste à exécuter des actions qui vont annuler ce qui a été fait.</li>
<li class="nx-my-2">La <strong>forward recovery</strong> consiste à continuer la transaction, en réessayant des étapes par exemple.</li>
</ul>
</li>
<li class="nx-my-2">Il n&#x27;est pas toujours possible de défaire entièrement une saga.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple, si un email a été envoyé pour confirmer une commande qui a ensuite échoué, l&#x27;<strong>action de compensation</strong> qu&#x27;on peut faire c&#x27;est renvoyer un email pour dire qu&#x27;on est désolé et qu&#x27;on s&#x27;est trompé.</li>
</ul>
</li>
<li class="nx-my-2">On peut mixer les manières, par exemple en considérant qu&#x27;on rollback une commande jusqu&#x27;au moment où on arrive à l&#x27;étape où il ne reste que l&#x27;étape d&#x27;envoi, qu&#x27;on va plutôt réessayer si elle échoue.</li>
<li class="nx-my-2">On peut essayer de <strong>placer les étapes</strong> qui nécessiteraient les actions de compensation <strong>les plus coûteuses vers la fin de la saga</strong>, pour faciliter le rollback dans la majorité des cas.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Exemple : mettre l&#x27;attribution de points de fidélité après les étapes les plus critiques du processus de validation d&#x27;une commande.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Côté implémentation, on a deux types de sagas :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les <strong>orchestrated sagas</strong> : on a un coordinateur (ou orchestrateur) qui va contenir l&#x27;ensemble de la logique de la saga, et qui va s&#x27;occuper d&#x27;appeller les divers services dans l&#x27;ordre, à la fois pour faire les actions nécessaires, mais aussi pour faire les actions de compensation.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">NDLR : Vlad Khononov appelle ça des <em>process managers</em>.</li>
<li class="nx-my-2">L&#x27;avantage d&#x27;avoir la logique de la saga dans un même endroit c&#x27;est qu&#x27;on peut plus facilement comprendre ce qui est fait.</li>
<li class="nx-my-2">Le désavantage c&#x27;est d&#x27;avoir une forme de <strong>couplage</strong> entre microservices, et d&#x27;avoir une tendance à ce que la logique aille dans l&#x27;orchestrateur, rendant les <strong>microservices anémiques</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Pour mitiger un peu le problème, on peut s&#x27;assurer d&#x27;avoir des orchestrateurs bien séparés pour chaque saga, aidant à pousser à garder la logique (du coup réutilisée par chaque orchestrateur) dans les microservices.</li>
</ul>
</li>
<li class="nx-my-2">Il existe des outils appelés BPM (business process modeling), utilisés par les non développeurs pour définir des process business par drag-and-drop.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur les déconseille parce qu&#x27;ils sont en général utilisés par les développeurs, et sont difficiles à versionner ou à tester de manière automatisée.</li>
<li class="nx-my-2">Il est plus facile de projeter des représentation des process business à partir du code (si c&#x27;est ce qu&#x27;on veut faire).</li>
<li class="nx-my-2">Si vraiment on veut explorer des solutions BPM qui essayent d&#x27;être developer-friendly, il y a <strong>Camunda</strong> et <strong>Zeebe</strong>.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">Les <strong>choreographed sagas</strong> : on a un ensemble de services qui <strong>émettent des events, et réagissent eux-mêmes à des events</strong>, et l&#x27;ensemble de ces noeuds forme la saga.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les services ne savent pas qui écoute leur event, elles émettent simplement le bon event au bon moment, et il peut être géré par qui est intéressé.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Exemple : le service <em>Warehouse</em> réagit à l&#x27;event de commande initiée, et émet un event pour dire que son étape est faite, ou alors qu&#x27;il n&#x27;a pas pu le faire. Et d&#x27;autres services gèreront les conséquences en écoutant les bons events.</li>
</ul>
</li>
<li class="nx-my-2">Comme on n&#x27;a pas d&#x27;entité centrale qui coordonne les choses, la logique ne peut pas se centraliser non plus, et on obtient naturellement une forme de <strong>découplage</strong> entre microservices.</li>
<li class="nx-my-2">Le désavantage c&#x27;est qu&#x27;il est plus difficile d&#x27;appréhender le process de la saga dans son ensemble. On a aussi du mal à savoir dans quel état se trouve la saga.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">La solution est d&#x27;ajouter une <strong>correlation ID</strong> dans l&#x27;ensemble des events de la saga, puis de les consommer pour en projeter une vue compréhensible. On peut avoir des services dont c&#x27;est justement le rôle.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2">On peut utiliser l&#x27;un ou l&#x27;autre des types de sagas en fonction des cas, mais aussi mixer les types au sein d&#x27;une même saga.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple une choreographed saga plus large, dont une des étapes est gérée sous forme d&#x27;orchestrated saga.</li>
</ul>
</li>
<li class="nx-my-2">Selon l&#x27;auteur, même si les choreographed sagas ont la difficulté d&#x27;utiliser l&#x27;event driven architecture, les avantages en termes de découplage qu&#x27;elles apportent valent le coup.</li>
<li class="nx-my-2">L&#x27;autre conseil c&#x27;est que <strong>l&#x27;orchestrated saga est acceptable si une même équipe est en charge de l&#x27;ensemble de la saga</strong>. Si plusieurs équipes sont impliquées, il vaut mieux une version choreographed.</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;utilisation des sagas a l&#x27;avantage de <strong>modéliser explicitement</strong> les process business importants.</li>
<li class="nx-my-2">Pour aller plus en profondeur sur ce sujet, l&#x27;auteur recommande la chapitre 4 de <strong><em>Building Microservices</em></strong>, et <strong><em>Enterprise Integration Patterns</em></strong>.</li>
</ul>
<h2 class="nx-font-semibold nx-tracking-tight nx-text-slate-900 dark:nx-text-slate-100 nx-mt-10 nx-border-b nx-pb-1 nx-text-3xl nx-border-neutral-200/70 contrast-more:nx-border-neutral-400 dark:nx-border-primary-100/10 contrast-more:dark:nx-border-neutral-400">Chapter 5 - Growing Pains<span class="nx-absolute -nx-mt-20" id="chapter-5---growing-pains"></span><a href="#chapter-5---growing-pains" class="subheading-anchor" aria-label="Permalink for this section"></a></h2>
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ce chapitre présente les principaux problèmes qu&#x27;on rencontre habituellement avec les microservices, avec le moment (nombre de microservices) où on les rencontre en général.</li>
<li class="nx-my-2"><strong>Ownership at Scale</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur reprend le modèle de types d&#x27;ownerships de Martin Fowler :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><em>Strong code ownership</em> : chaque service a une équipe owner qui peut y apporter des modifications. Les autres doivent faire des PRs.</li>
<li class="nx-my-2"><em>Weak code ownership</em> : chaque service a une équipe owner, mais les autres équipes peuvent aussi y faire des changements sans demander.</li>
<li class="nx-my-2"><em>Collective code ownership</em> : il n&#x27;y a pas d&#x27;équipes assignées aux services.</li>
</ul>
</li>
<li class="nx-my-2">On a souvent un collective ownership au début, et jusqu&#x27;à environ 20 personnes c&#x27;est OK pour l&#x27;auteur. Mais avec l&#x27;effectif de développeurs qui grandit, si on garde ce type d&#x27;ownership on obtiendra un distributed big ball of mud.</li>
<li class="nx-my-2">La solution c&#x27;est d&#x27;utiliser le <strong>strong code ownership</strong>, ce qui permettra aussi d&#x27;avoir des équipes centrées autour de domaines business.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Breaking changes</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les microservices communiquent entre eux, mais doivent être modifiables sans impacter les autres microservices.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si la donnée qu&#x27;ils envoient ou leur comportement changent, ils impacteront les autres microservices, cassant des fonctionnalités.</li>
</ul>
</li>
<li class="nx-my-2">Ce problème survient en général assez tôt, dès que plusieurs équipes gèrent des microservices qui communiquent entre eux.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Un des signes peut être aussi le fait de chercher à déployer plusieurs services en même temps pour plusieurs équipes.</li>
</ul>
</li>
<li class="nx-my-2">Les solutions sont :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">De faire du <strong>contract testing</strong>, ou au moins rendre le schéma de l&#x27;API publique du microservice explicite, et difficile à changer.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Des outils comme <strong>protolock</strong> permettent d&#x27;empêcher les changements dans les schémas de communication.</li>
</ul>
</li>
<li class="nx-my-2">D&#x27;<strong>éviter de casser les contrats</strong> le plus possible.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Par exemple ajouter une nouvelle fonction exposée en laissant l&#x27;ancienne aussi.</li>
</ul>
</li>
<li class="nx-my-2">De donner le temps aux autres services de migrer si on casse le contrat.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut faire tourner deux versions du microservice en même temps, mais il faudra que ça dure peu de temps.</li>
<li class="nx-my-2">L&#x27;autre solution, privilégiée par l&#x27;auteur, est d&#x27;implémenter les deux versions de l&#x27;API dans le même microservice.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Reporting</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les cas d&#x27;usage de reporting, de type OLAP, deviennent plus difficiles à faire quand la DB est séparée en plusieurs morceaux.</li>
<li class="nx-my-2">Ce problème survient assez tôt, quand on commence à décomposer le schéma de DB de notre monolithe.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Parfois on oublie les personnes qui font de l&#x27;analyse par dessus la DB du monolithe, et on s&#x27;en rend compte quand le travail de migration est déjà avancé.</li>
</ul>
</li>
<li class="nx-my-2">Si on veut garder la possibilité pour les personnes qui font l&#x27;analyse de continuer à le faire avec des requêtes SQL dans une DB, on peut <strong>créer une DB publique</strong> juste pour eux.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Cette DB publique serait alors alimentée par les microservices qui sont maintenant les owners des bouts de la DB qui doit être utilisée pour l&#x27;analyse.</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;auteur renvoie vers le chapitre 5 de <strong><em>Building Microservices</em></strong> pour plus de détails sur ce sujet.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Monitoring and Troubleshooting</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Plus le nombre de microservices augmente, plus on a du mal à savoir si le système va bien ou pas, et quel est l&#x27;origine exacte des problèmes.</li>
<li class="nx-my-2">Parmi les solutions :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ajouter un <strong>log aggregation system</strong> : collecter les logs de l&#x27;ensemble des microservices en un même endroit.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Parmi les outils il y a la <strong>ELT stack</strong> (Elastic search, Logstash/Fluent D, Kibana) et <strong>Humio</strong>.</li>
<li class="nx-my-2">NDLR : l&#x27;auteur ne le mentionne pas, mais il y a aussi Datadog comme log aggregation system en SaaS.</li>
<li class="nx-my-2">L&#x27;auteur conseille de commencer par le mettre en place avant de sortir des microservices : c&#x27;est utile dès le début, et en plus si on n&#x27;en est pas capable, c&#x27;est peut être qu&#x27;on n&#x27;est pas encore mature pour commencer à sortir des microservices.</li>
</ul>
</li>
<li class="nx-my-2">Ajouter du <strong>tracing</strong> :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ajouter un <strong>correlation ID</strong> à nos messages qui vont de microservice en microservice, pour repérer les flows internes liés à une même demande initiale.</li>
<li class="nx-my-2">Utiliser un outil qui permet de tracer le temps mis pour les appels. Exemple d&#x27;outil : <strong>Jaeger</strong>.</li>
</ul>
</li>
<li class="nx-my-2">Faire des <strong>tests en production</strong> : il s&#x27;agit des <em>synthetic transactions</em>, où on va faire des tests end to end contre la production, pour se rendre compte des problèmes.</li>
<li class="nx-my-2">Ajouter de l&#x27;<strong>observability</strong> : comme on ne sait pas quels problèmes on aura réellement, il faut collecter beaucoup de données, et utiliser des outils qui nous permettront de faire des requêtes pour investiguer ce qu&#x27;on n&#x27;avait pas prévu.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">L&#x27;auteur conseille <strong><em>Distributed Systems Observability</em></strong> pour creuser la question.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Local Developer Experience</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Quand les devs ont besoin de faire des tests en local avec une dizaine de microservices ou plus, ils risquent de ne plus pouvoir le faire à cause de la performance de leur machine.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Ce problème arrive surtout dans les organisations où il n&#x27;y a pas de strong ownership, et donc où on a besoin de toucher au code de plusieurs microservices.</li>
</ul>
</li>
<li class="nx-my-2">Parmi les solutions :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Stubber les microservices avec lesquels le microservice modifié interagit.</li>
<li class="nx-my-2">Avoir un environnement distant auquel le développeur peut se connecter, pour que son microservice local puisse communiquer avec des microservices tournant dans un environnement de développement distant.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Cette solution amène à consommer plus de ressources.</li>
<li class="nx-my-2"><strong>Telepresence</strong> est un exemple d&#x27;outil qui permet de faire un workflow de dev local/remote avec Kubernetes.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Running Too Many Things</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Plus on a de microservices, et plus on va avoir de process à gérer en production.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Avec des dizaines ou des centaines de microservices, la configuration et le choix du nombre d&#x27;instances de chaque microservice vont devenir compliqués.</li>
<li class="nx-my-2">On va avoir besoin de plus en plus de personnes pour gérer l&#x27;aspect infrastructure.</li>
</ul>
</li>
<li class="nx-my-2">La solution peut être l&#x27;utilisation de <strong>Kubernetes</strong> pour gérer les instances de microservice.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Dans le cas où on héberge notre solution dans un cloud public, l&#x27;auteur conseille de partir d&#x27;abord sur du FaaS (Function as a Service), et de ne partir sur des options plus complexes comme Kubernetes que si les limitations du serverless nous posent problème.</li>
<li class="nx-my-2">Kubernetes lui-même n&#x27;est pas très developer-friendly, on peut opter pour une solution plus abstraite comme <strong>OpenShift</strong> de RedHat.</li>
<li class="nx-my-2">L&#x27;utilisation de Kubernetes n&#x27;est pas obligatoire pour faire du microservice. Si on extrait par exemple 5 microservices en tout, et qu&#x27;on est OK comme ça, on n&#x27;en aura pas besoin.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>End-to-End Testing</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Les tests end to end prennent beaucoup de temps, et sont sujets aux faux positifs. Ils le sont encore plus quand il s&#x27;agit de tester des cas d&#x27;usage impliquant plusieurs microservices.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Le risque c&#x27;est qu&#x27;on se mette à passer de plus en plus de temps sur ces tests.</li>
</ul>
</li>
<li class="nx-my-2">Un chapitre entier de <strong><em>Building Microservices</em></strong> détaille la manière de tester avec les microservices.</li>
<li class="nx-my-2">Parmi les solutions :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2"><strong>Limiter le scope des tests</strong> : les tests peuvent couvrir plusieurs microservices, à condition qu&#x27;ils soient gérés par la même équipe.</li>
<li class="nx-my-2"><strong>Utiliser des consumer-driven contracts</strong> (CDC) : au lieu d&#x27;avoir des tests end to end, chaque service consommateur crée des tests pour spécifier ce qu&#x27;il attend du microservice qu&#x27;il va utiliser.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Vu que c&#x27;est le consommateur qui définit le contrat, il y a moins de chances de casser un contrat implicite sans faire exprès.</li>
<li class="nx-my-2">Parmi les outils pour faire du CDC il y a <strong>Pact</strong>.</li>
</ul>
</li>
<li class="nx-my-2">Mettre en place une <strong>progressive delivery</strong>, et une <strong>automated release remediation</strong> : on peut faire une canary release auprès de peu de clients, puis avoir un système automatique qui rollback si jamais des mesures clés (par exemple le 95ème percentile de latence et de taux d&#x27;erreur) ne sont pas bonnes.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Même sans avoir la partie automatique, une simple canary release manuelle est déjà une avancée.</li>
</ul>
</li>
<li class="nx-my-2">Garder un œil sur ce qui n&#x27;est pas assez testé et où il y a beaucoup de problèmes, et ce qui est éventuellement trop testé pour en enlever.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Global Versus Local Optimization</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Si on adopte un strong code ownership, avec des équipes autonomes, on risque de se retrouver au bout d&#x27;un certain temps à avoir certaines duplications qui d&#x27;un point de vue global ne sont pas optimales pour l&#x27;entreprise.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Exemple : on a 3 équipes qui utilisent chacune une DB différentes (Oracle, PostgreSQL etc.), toutes pour une bonne raison dans leur contexte. Mais si on regarde les choses d&#x27;un point de vue global, il est possible que ça n&#x27;en vaille pas le coup.</li>
<li class="nx-my-2">Autre exemple : avoir des manières différentes de déployer les microservices dans chaque équipe fait qu&#x27;à chaque changement d&#x27;équipe, les développeurs doivent réapprendre comment faire ça.</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;autonomie des équipes apporte beaucoup d&#x27;avantages, notamment le fait d&#x27;avancer vite, alors que la centralisation permet d&#x27;optimiser au niveau global, au détriment d&#x27;une nécessité de consensus avec plus de monde.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Il faut trouver un équilibre, et réajuster régulièrement.</li>
</ul>
</li>
<li class="nx-my-2">Parmi les solutions :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Faire comprendre aux équipes qu&#x27;en fonction du type réversible / irréversible des décisions qu&#x27;elles prennent, il faut impliquer plus ou moins de personnes, y compris si nécessaire en dehors de l&#x27;équipe.</li>
<li class="nx-my-2">Avoir une manière de synchroniser les équipes entre-elles, par exemple un membre de l&#x27;équipe qui pourrait participer à des groupes cross-team pour traiter de problématiques globales.</li>
<li class="nx-my-2">Par exemple, chez Monzo, les équipes peuvent soumettre des propositions sur des sujets importants, qui peuvent être ensuite discutés publiquement par les autres équipes jusqu&#x27;à arriver à une solution.</li>
</ul>
</li>
</ul>
</li>
<li class="nx-my-2"><strong>Robustness and Resiliency</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Quand on est dans un système distribué, on a un risque d&#x27;instabilité de notre système. Et ce risque augmente en fonction du nombre de services qu&#x27;on a et de leur interconnection.</li>
<li class="nx-my-2">Parmi les solutions :<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On peut se demander <strong>à chaque appel</strong> si on a pris en compte le fait qu&#x27;il <strong>pouvait échouer</strong>, et toutes les manières dont il pouvait le faire.</li>
<li class="nx-my-2">Utiliser des techniques pour isoler les services les uns des autres, par exemple par des communications asynchrones.</li>
<li class="nx-my-2">Utiliser des timeouts raisonnables pour éviter les blocages trop longs.</li>
<li class="nx-my-2">Lancer plusieurs instances de chaque microservice pour le cas où une instance est en échec.</li>
<li class="nx-my-2">Plus généralement, il faut avoir un état d&#x27;esprit qui permet la résilience, par exemple en documentant les problèmes survenus, et les solutions appliquées. Et en tirer les conséquences sur notre organisation.</li>
</ul>
</li>
<li class="nx-my-2">L&#x27;auteur recommande de lire le chapitre 11 de <strong><em>Building Microservices</em></strong> ou le livre <strong><em>Release It!</em></strong> de Michael Nygard pour plus de détails.</li>
</ul>
</li>
<li class="nx-my-2"><strong>Orphaned Services</strong>.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">On se retrouve parfois (au bout d&#x27;une très longue période d&#x27;utilisation de microservices) à avoir des services qui tournent, mais dont personne ne se rappelle ce qu&#x27;ils sont censés faire, et qu&#x27;on a peur d&#x27;éteindre.<!-- -->
<ul class="nx-mt-6 nx-list-disc first:nx-mt-0 ltr:nx-ml-6 rtl:nx-mr-6">
<li class="nx-my-2">Parfois on a perdu le code source.</li>
</ul>
</li>
<li class="nx-my-2">La solution peut être d&#x27;avoir une forme ou une autre de <strong>registry</strong> alimentée par les équipes, ou par un outil automatique qui crawl les repositories.</li>
</ul>
</li>
</ul><div class="nx-mt-16"></div><div class="nx-mb-8 nx-flex nx-items-center nx-border-t nx-pt-8 dark:nx-border-neutral-800 contrast-more:nx-border-neutral-400 dark:contrast-more:nx-border-neutral-400 print:nx-hidden"><a title="Learning Domain-Driven Design" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-pr-4 rtl:nx-pl-4" href="/reading-notes/books/learning-domain-driven-design/"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 ltr:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>Learning Domain-Driven Design</a><a title="Refactoring: Improving the Design of Existing Code" class="nx-flex nx-max-w-[50%] nx-items-center nx-gap-1 nx-py-4 nx-text-base nx-font-medium nx-text-gray-600 nx-transition-colors [word-break:break-word] hover:nx-text-primary-600 dark:nx-text-gray-300 md:nx-text-lg ltr:nx-ml-auto ltr:nx-pl-4 ltr:nx-text-right rtl:nx-mr-auto rtl:nx-pr-4 rtl:nx-text-left" href="/reading-notes/books/refactoring/">Refactoring: Improving the Design of Existing Code<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="nx-inline nx-h-5 nx-shrink-0 rtl:nx-rotate-180"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></a></div></main></article></div><footer class="nx-bg-gray-100 nx-pb-[env(safe-area-inset-bottom)] dark:nx-bg-neutral-900 print:nx-bg-transparent"><div class="nx-mx-auto nx-flex nx-max-w-[90rem] nx-gap-2 nx-py-2 nx-px-4 nx-hidden"><button title="Change theme" class="nx-h-7 nx-rounded-md nx-px-2 nx-text-left nx-text-xs nx-font-medium nx-text-gray-600 nx-transition-colors dark:nx-text-gray-400 hover:nx-bg-gray-100 hover:nx-text-gray-900 dark:hover:nx-bg-primary-100/5 dark:hover:nx-text-gray-50" id="headlessui-listbox-button-:Rkt6:" type="button" aria-haspopup="listbox" aria-expanded="false" data-headlessui-state=""><div class="nx-flex nx-items-center nx-gap-2 nx-capitalize"><svg fill="none" viewBox="3 3 18 18" width="12" height="12" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" fill="currentColor" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><span class="">Light</span></div></button></div><hr class="dark:nx-border-neutral-800"/><div class="nx-mx-auto nx-flex nx-max-w-[90rem] nx-justify-center nx-py-12 nx-text-gray-600 dark:nx-text-gray-400 md:nx-justify-start nx-pl-[max(env(safe-area-inset-left),1.5rem)] nx-pr-[max(env(safe-area-inset-right),1.5rem)]">Made by Roman Mkrtchian</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/books/monolith-to-microservices","query":{},"buildId":"F6f_7M_ER8Wqj_ggOiWGC","assetPrefix":"/reading-notes","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>