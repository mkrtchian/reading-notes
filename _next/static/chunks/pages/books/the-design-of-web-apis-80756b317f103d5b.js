(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[294],{2700:(e,s,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/books/the-design-of-web-apis",function(){return n(5363)}])},5363:(e,s,n)=>{"use strict";n.r(s),n.d(s,{__toc:()=>t,default:()=>a});var i=n(7876),r=n(301),l=n(7586);let t=[{depth:2,value:"1 - What is API design",id:"1---what-is-api-design"},{depth:2,value:"2 - Designing an API for users",id:"2---designing-an-api-for-users"},{depth:2,value:"3 - Designing a programming interface",id:"3---designing-a-programming-interface"},{depth:2,value:"4 - Describing an API with an API description format",id:"4---describing-an-api-with-an-api-description-format"},{depth:2,value:"5 - Designing a straightforward API",id:"5---designing-a-straightforward-api"},{depth:2,value:"6 - Designing a predictable API",id:"6---designing-a-predictable-api"},{depth:2,value:"7 - Designing a concise and well-organized API",id:"7---designing-a-concise-and-well-organized-api"},{depth:2,value:"8 - Designing a secure API",id:"8---designing-a-secure-api"},{depth:2,value:"9 - Evolving an API design",id:"9---evolving-an-api-design"},{depth:2,value:"10 - Designing a network-efficient API",id:"10---designing-a-network-efficient-api"},{depth:2,value:"11 - Designing an API in context",id:"11---designing-an-api-in-context"},{depth:2,value:"12 - Documenting an API",id:"12---documenting-an-api"},{depth:2,value:"13 - Growing APIs",id:"13---growing-apis"}];function o(e){let s=Object.assign({h1:"h1",h2:"h2",ul:"ul",li:"li",strong:"strong",code:"code",pre:"pre",span:"span",em:"em",ol:"ol",a:"a"},(0,l.R)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{children:"The Design of Web APIs"}),"\n",(0,i.jsx)(s.h2,{id:"1---what-is-api-design",children:"1 - What is API design"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Ici nous parlons des ",(0,i.jsx)(s.strong,{children:"API web"}),", c'est-\xe0-dire utilisant le protocole ",(0,i.jsx)(s.strong,{children:"HTTP"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Une API est dite ",(0,i.jsx)(s.strong,{children:"publique"})," quand elle est fournie comme service \xe0 une autre entreprise, et ",(0,i.jsx)(s.strong,{children:"priv\xe9e"})," quand elle est fournie \xe0 des services internes."]}),"\n",(0,i.jsx)(s.li,{children:"Le design d'une API web doit \xeatre fait pour rendre la vie simple aux d\xe9veloppeurs qui vont la consommer."}),"\n",(0,i.jsxs)(s.li,{children:["L'API doit ",(0,i.jsx)(s.strong,{children:"cacher l'impl\xe9mentation"}),", et n'exposer que ce dont l'utilisateur a besoin."]}),"\n",(0,i.jsxs)(s.li,{children:["L'API doit \xeatre ",(0,i.jsx)(s.strong,{children:"intuitive"}),", ressembler \xe0 ce \xe0 quoi on s'attendrait."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"2---designing-an-api-for-users",children:"2 - Designing an API for users"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Il faut comprendre les ",(0,i.jsx)(s.strong,{children:"besoins de l'utilisateur"})," de l'API pour designer une API qui y r\xe9ponde, et non pas utiliser le point de vue du backend.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\xc9viter d'adopter le point de vue du cr\xe9ateur de l'API passe par :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"\xc9viter l'influence des structures de donn\xe9es"})," c\xf4t\xe9 backend. Si on expose exactement ce qui est en BDD c'est un signe qu'on n'adopte probablement pas le point de vue du consommateur.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Il faut correctement nommer les choses, mais aussi introduire de l'abstraction pour masquer les d\xe9tails qui n'int\xe9ressent pas le consommateur."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"\xc9viter l'influence du code business"})," c\xf4t\xe9 backend. Si le consommateur n'a pas besoin de savoir ce qui se passe finement, on peut lui exposer une API grossi\xe8re et faire ce qu'il faut dans l'impl\xe9mentation, ce sera plus simple et plus s\xfbr."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"\xc9viter l'influence de l'architecture"})," du backend. Par exemple, si le backend utilise une architecture s\xe9par\xe9e en services, le fait de faire appara\xeetre cette m\xeame s\xe9paration interne sur l'API expos\xe9e n'est probablement pas une bonne id\xe9e. Il faut se concentrer sur le besoin du consommateur."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"\xc9viter l'influence de l'organisation humaine"})," du provider de l'API. Le fait que le provider soit structur\xe9 avec tels ou tels d\xe9partements par exemple ne doit pas influencer l'API."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["En fait, il faut traiter les consommateurs de l'API vis-\xe0-vis de celle-ci comme des utilisateurs finaux vis-\xe0-vis du produit : on doit se demander ",(0,i.jsx)(s.strong,{children:"ce que le consommateur veut, et de quelle mani\xe8re il le veut"}),". \xc7a revient \xe0 cr\xe9er des User Stories du consommateur d'API.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Les deux autres choses dont on a besoin sur les utilisateurs c'est ",(0,i.jsx)(s.strong,{children:"les inputs et outputs"})," : ce que l'utilisateur doit apporter, et ce dont il a besoin en retour lors de l'action."]}),"\n",(0,i.jsxs)(s.li,{children:["Enfin, pour trouver des \xe9l\xe9ments manquants et compl\xe9ter l'API, on va analyser ",(0,i.jsx)(s.strong,{children:"d'o\xf9 vont venir les inputs requis"}),", et ",(0,i.jsx)(s.strong,{children:"ce qui sera fait des outputs"}),"."]}),"\n",(0,i.jsx)(s.li,{children:"Autre question importante qui nous permettra d'\xeatre plus efficace : trouver qui sont nos utilisateurs."}),"\n",(0,i.jsxs)(s.li,{children:["L'",(0,i.jsx)(s.strong,{children:"API goals canvas"})," est donc un tableau avec les cases suivantes :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Whos : les utilisateurs de l'API"}),"\n",(0,i.jsx)(s.li,{children:"Whats : Ce que les utilisateurs font"}),"\n",(0,i.jsx)(s.li,{children:"Hows : les \xe9tapes de ce qu'ils font"}),"\n",(0,i.jsx)(s.li,{children:"Inputs : ce dont ils ont besoin \xe0 chaque \xe9tape, et d'o\xf9 ils l'ont"}),"\n",(0,i.jsx)(s.li,{children:"Outputs : ce qu'ils r\xe9cup\xe8rent \xe0 chaque \xe9tape, et ce qu'ils en feront"}),"\n",(0,i.jsx)(s.li,{children:"Goals : Reformulation concise du besoin"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Ce tableau ne peut pas \xeatre rempli \xe0 l'avance pour toute l'application. Il s'agit d'un processus it\xe9ratif o\xf9 on traite les fonctionnalit\xe9s par petits bouts."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"3---designing-a-programming-interface",children:"3 - Designing a programming interface"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["REST est une m\xe9thode de design d'API qui se calque sur HTTP. Il s'agit d'utiliser \xe0 chaque fois une ",(0,i.jsx)(s.strong,{children:"action HTTP"})," (par exemple GET), et ",(0,i.jsx)(s.strong,{children:"un chemin identifiant une ressource"})," (par exemple /product/123), et un ",(0,i.jsx)(s.strong,{children:"contenu optionnel"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["La r\xe9ponse est un ",(0,i.jsx)(s.strong,{children:"statut"})," qui indique si la transaction s'est bien pass\xe9e, et ",(0,i.jsx)(s.strong,{children:"un contenu"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Pour faire une API REST, il va s'agir de trouver les ressources \xe0 partir des API goals qu'on a pu analyser par exemple avec le canvas, et ensuite de leur attribuer des actions."}),"\n",(0,i.jsxs)(s.li,{children:["Quand on a plusieurs ressources cit\xe9es dans un API goal, il faut identifier la ressource principale. C'est sur elle que porte l'action. L'autre n'\xe9tant en g\xe9n\xe9ral qu'une information donn\xe9e dans le chemin ou le contenu additionnel de la requ\xeate.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Exemple : Rechercher des produits dans un catalogue avec une requ\xeate textuelle : c'est bien le catalogue qui est la ressource principale."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Les chemins doivent refl\xe9ter cette organisation, en ayant un nom compr\xe9hensible pour la ressource au d\xe9but (/catalogue), suivi des param\xe8tres.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["La mani\xe8re la plus standard de faire des chemins c'est d'avoir un nom pluriel pour les collections, suivi d'un identifiant d'une des ressources de cette collection :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"/ressources/{ressourceId}"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"/ressources/{ressourceId}/sub-ressources/{subRessourceId}"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Si on a un param\xe8tre \xe0 donner dans une requ\xeate qui doit simplement r\xe9cup\xe9rer un r\xe9sultat (par exemple faire une recherche), alors on utilise GET et on donne la cha\xeene de recherche dans un param\xe8tre de l'URL.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Ex : GET /products?free-query=blabla"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["De m\xeame que le path et l'action de l'API doit \xeatre con\xe7ue selon les besoins du client et non pas selon la structure du backend, le contenu des donn\xe9es doit aussi \xeatre structur\xe9 dans ce but :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Si certaines propri\xe9t\xe9s ne sont pas n\xe9cessaires au client pour son usage, on les supprime."}),"\n",(0,i.jsx)(s.li,{children:"Si certaines propri\xe9t\xe9s seraient plus claires dans ce contexte sous un autre nom : on les renomme."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Quand on ne sait pas quelle m\xe9thode REST choisir pour une action, par d\xe9faut on choisit ",(0,i.jsx)(s.strong,{children:"POST"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Il est facile de faire correspondre une action m\xe9tier avec une API REST, tant qu'on est dans du CRUD d'une ressource. Mais quand on veut faire des actions plus complexes, alors il faut faire des ",(0,i.jsx)(s.strong,{children:"compromis"})," entre la ",(0,i.jsx)(s.strong,{children:"user-friendlyness"}),", et la ",(0,i.jsx)(s.strong,{children:"conformit\xe9 avec le standard REST"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Ex : Valider son panier peut \xeatre fait avec :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"POST /cart/check-out, ce qui est tr\xe8s user friendly, mais pas tr\xe8s conforme \xe0 la norme de manipulation de ressources de REST."}),"\n",(0,i.jsx)(s.li,{children:"POST /orders, ce qui est plus conforme \xe0 REST mais on perd la notion m\xe9tier de panier dans l'histoire."}),"\n",(0,i.jsx)(s.li,{children:"En r\xe9alit\xe9 il n'y a pas de “bonne solution”, il s'agit de faire un compromis. Il n'y a pas toujours de bonne API."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["L'architecture REST :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"a \xe9t\xe9 \xe9labor\xe9e par un th\xe9sard en 2000, et a depuis envahi l'univers des API r\xe9seau."}),"\n",(0,i.jsxs)(s.li,{children:["a \xe9t\xe9 con\xe7ue sp\xe9cifiquement pour les ",(0,i.jsx)(s.strong,{children:"architectures distribu\xe9es"}),", dont d'ailleurs l'architecture navigateur / serveur en est un rudiment. Il s'agit de favoriser l'efficacit\xe9, la stabilit\xe9, la scalabilit\xe9."]}),"\n",(0,i.jsxs)(s.li,{children:["Pour \xeatre RESTful, il faut respecter ces 6 principes :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.strong,{children:"S\xe9paration Client / Serveur"})}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Statelessness"})," : toute l'information d'une requ\xeate est contenue dans la requ\xeate. Le serveur ne conserve pas de session."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Cacheability"})," : une r\xe9ponse doit indiquer si elle peut \xeatre stock\xe9e par le client, et si oui pour combien de temps avant qu'il faille qu'il refasse la requ\xeate."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Layered system"})," : quand le client interagit avec le serveur, il n'en voit qu'une couche, le reste est cach\xe9 derri\xe8re l'API."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Code on demand"})," (optionnel) : le serveur peut transf\xe9rer du code ex\xe9cutable au client, par exemple du JavaScript."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Uniform Interface"})," :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Toutes les interactions se font au travers d'actions standardis\xe9es sur des ressources, et en fonction de l'\xe9tat de ces ressources (qu'on obtient par GET, et qu'on modifie par PATCH etc.)."}),"\n",(0,i.jsx)(s.li,{children:"Les interactions doivent aussi fournir les metadata suffisantes pour comprendre la structure de ces \xe9tats et ce qu'il est possible de faire aux ressources."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Si on se rend compte qu'un des param\xe8tres d'une m\xe9thode de notre API ne peut pas \xeatre fournie par le client, alors c'est qu'on a sans doute oubli\xe9 quelque chose… Il faut revoir l'API, ajouter une m\xe9thode etc."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"4---describing-an-api-with-an-api-description-format",children:"4 - Describing an API with an API description format"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"D\xe9crire une API selon un format standardis\xe9 permet de la partager avec des \xeatres humains qui vont savoir la lire, et avec des outils automatis\xe9s qui pourront l'exploiter pour g\xe9n\xe9rer une documentation HTML, ou dans n'importe quel autre but."}),"\n",(0,i.jsxs)(s.li,{children:["L'OAS (Open API Specification) est un format ouvert, communautaire, et tr\xe8s utilis\xe9 pour REST.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Initialement la sp\xe9cification s'appelait Swagger, mais elle a \xe9t\xe9 renomm\xe9e OpenAPI en 2016."}),"\n",(0,i.jsx)(s.li,{children:"On peut utiliser JSON ou YAML pour \xe9crire le document, mais Arnaud recommande YAML pour la lisibilit\xe9 accrue pour les humains."}),"\n",(0,i.jsx)(s.li,{children:"On \xe9dite le fichier \xe0 la main et on le versionne."}),"\n",(0,i.jsx)(s.li,{children:"VSCode a une extension Swagger viewer qui aide \xe0 visualiser ce qu'on a \xe9crit."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Tips YAML :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Pour indiquer qu'il n'y a rien, il faut mettre des ",", par exemple quand il n'y a pas encore de paths : ",(0,i.jsx)(s.code,{children:"paths: {}"})]}),"\n",(0,i.jsxs)(s.li,{children:["Pour \xe9crire une string multiligne, on met un | d'abord :","\n",(0,i.jsx)(s.pre,{"data-language":"yaml","data-theme":"default",children:(0,i.jsxs)(s.code,{"data-language":"yaml","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"description"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"})]}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"blabla"})}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"blabla"})})]})}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Les noms de propri\xe9t\xe9 doivent \xeatre des strings en YAML, donc il faut entourer les chiffres par des guillemets quand ils sont en propri\xe9t\xe9."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Le format OpenAPI :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Il ne faut pas h\xe9siter \xe0 \xe9crire des descriptions."}),"\n",(0,i.jsxs)(s.li,{children:["ex","\n",(0,i.jsx)(s.pre,{"data-language":"yaml","data-theme":"default",children:(0,i.jsxs)(s.code,{"data-language":"yaml","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"paths"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"/objects"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"description"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"description du path"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"get"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"summary"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"r\xe9sum\xe9 court de la m\xe9thode"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"description"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"r\xe9sum\xe9 long de la m\xe9thode"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"responses"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"200"'}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"description"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"description de la r\xe9ponse"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"content"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"application/json"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"schema"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# et on d\xe9crit le sch\xe9ma de la r\xe9ponse"})]})]})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Dans le cas o\xf9 une m\xe9thode GET prend un param\xe8tre, \xe7a se passe dans parameter :","\n",(0,i.jsx)(s.pre,{"data-language":"yaml","data-theme":"default",children:(0,i.jsxs)(s.code,{"data-language":"yaml","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"get"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"parameters"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# il s'agit du nom qui va appara\xeetre dans l'URL"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    - "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"name"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"nom-du-parametre"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"description"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"description du param\xe8tre"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# o\xf9 se trouve le param\xe8tre"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"in"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"query"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# caract\xe8re obligatoire ou non"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"required"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"false"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"schema"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# type de donn\xe9es du param\xe8tre"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"string"})]})]})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["M\xeame chose pour les ",(0,i.jsx)(s.strong,{children:"path parameters"})," quand un morceau du path est param\xe9tris\xe9. Dans ce cas il faut l'indiquer entre accolades :","\n",(0,i.jsx)(s.pre,{"data-language":"yaml","data-theme":"default",children:(0,i.jsxs)(s.code,{"data-language":"yaml","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"paths"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsx)(s.span,{className:"line",children:(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"/objects/{objectId}"})}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"delete"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"parameters"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        - "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"name"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"objectId"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"in"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"path"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# obligatoire, sinon \xe7a ne compilera pas"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"required"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"true"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"schema"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"string"})]})]})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Pour d\xe9crire les formats JSON attendus en entr\xe9e, ou en r\xe9ponse, OpenAPI utilise la ",(0,i.jsx)(s.strong,{children:"sp\xe9cification JSON-schema"})," :\nExemple pour ",(0,i.jsx)(s.code,{children:'{prop1: "", prop2: { prop2-1: ""}}'}),"\n",(0,i.jsx)(s.pre,{"data-language":"yaml","data-theme":"default",children:(0,i.jsxs)(s.code,{"data-language":"yaml","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"object"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"description"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"une description de l'objet JSON"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"required"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"- "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"prop1"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"- "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"prop2"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"properties"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"prop1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"string"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"description"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"description de prop1"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"example"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"Exemple de valeur"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"prop2"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"object"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"properties"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"prop2-1"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"string"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"example"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"Exemple de valeur"})]})]})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Pour les m\xe9thodes comme POST qui ont besoin de donn\xe9es en entr\xe9e, \xe7a se fait dans ",(0,i.jsx)(s.strong,{children:"requestBody"}),", \xe0 c\xf4t\xe9 de ",(0,i.jsx)(s.strong,{children:"responses"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["On peut ",(0,i.jsx)(s.strong,{children:"r\xe9utiliser des sch\xe9mas"})," JSON d\xe9j\xe0 d\xe9finis pour \xe9viter de les r\xe9p\xe9ter dans notre fichier OpenAPI :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Il faut renseigner le sch\xe9ma \xe0 la racine du document, dans :","\n",(0,i.jsx)(s.pre,{"data-language":"yaml","data-theme":"default",children:(0,i.jsxs)(s.code,{"data-language":"yaml","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"components"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"schemas"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"mon_objet"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"object"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"properties"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# [...]"})]})]})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Et ensuite on peut le r\xe9f\xe9rencer avec :","\n",(0,i.jsx)(s.pre,{"data-language":"yaml","data-theme":"default",children:(0,i.jsxs)(s.code,{"data-language":"yaml","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"schema"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"$ref"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"#/components/schemas/mon_objet"})]})]})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["On peut placer le mot-cl\xe9 ",(0,i.jsx)(s.strong,{children:"parameters"})," non seulement au niveau des actions (get, post etc.), mais aussi un niveau au-dessus, au niveau des ressources (c'est-\xe0-dire au niveau du path). Et alors \xe0 ce moment l\xe0 ces param\xe8tres s'appliquent \xe0 toutes les m\xe9thodes du path. \xc7a \xe9vite de les r\xe9p\xe9ter, f\xfbt-ce avec un $ref."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"5---designing-a-straightforward-api",children:"5 - Designing a straightforward API"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Une des cl\xe9s d'un design “straitforward” est de ",(0,i.jsx)(s.strong,{children:"reproduire l'habitude des gens"}),", et \xe7a dans tous les domaines."]}),"\n",(0,i.jsxs)(s.li,{children:["Il faut des noms de propri\xe9t\xe9 clairs et \xe9vocateurs.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"\xc9viter les abr\xe9viations (min ou max c'est OK parce que c'est entr\xe9 dans la langue commune)"}),"\n",(0,i.jsx)(s.li,{children:"\xc9viter les d\xe9tails techniques qu'on peut retrouver autrement (ex. type de variable bool\xe9enne)"}),"\n",(0,i.jsx)(s.li,{children:"\xc9viter ce qui n'int\xe9resse pas le consommateur de mani\xe8re g\xe9n\xe9rale."}),"\n",(0,i.jsx)(s.li,{children:"Essayer de ne pas d\xe9passer 3 mots dans un nom quel qu'il soit."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Il faut des ",(0,i.jsx)(s.strong,{children:"formats de donn\xe9es bien choisis"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Par exemple le format ISO 8601 pour une date."}),"\n",(0,i.jsxs)(s.li,{children:["Adopter le point de vue du consommateur :\n",(0,i.jsx)(s.code,{children:'"type": "checking"'})," plut\xf4t que ",(0,i.jsx)(s.code,{children:'"type": 1'})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Il faut aussi que les donn\xe9es qu'on donne soient pertinentes pour le consommateur.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Ne pas h\xe9siter \xe0 ",(0,i.jsx)(s.strong,{children:"ajouter des donn\xe9es"})," pour que le consommateur ait ce qu'il lui faut d\xe9j\xe0 pr\xe9par\xe9."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["A propos des erreurs :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Il faut bien distinguer 3 types d'erreurs par leur type :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"erreur de format parmi les param\xe8tres fournis"}),"\n",(0,i.jsx)(s.li,{children:"erreur fonctionnelle"}),"\n",(0,i.jsx)(s.li,{children:"erreur interne du serveur"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Pour une erreur interne, en g\xe9n\xe9ral la seule chose qu'a besoin de savoir l'utilisateur c'est qu'il y a eu une erreur et que ce n'est pas de sa faute."}),"\n",(0,i.jsxs)(s.li,{children:["En HTTP, les codes ",(0,i.jsx)(s.strong,{children:"4XX"})," concernent les erreurs caus\xe9s par l'utilisateur, alors que les codes ",(0,i.jsx)(s.strong,{children:"5XX"})," concernent les erreurs sur lesquelles l'utilisateur n'a pas d'influence."]}),"\n",(0,i.jsxs)(s.li,{children:["Le code de statut ne suffit pas. Il faut aussi donner d'autres informations, ",(0,i.jsx)(s.strong,{children:"\xe0 la fois du texte pour les \xeatres humains, et des informations pour les machines"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Pour les machines \xe7a peut \xeatre un string repr\xe9sentant un type d'erreur pr\xe9cis, une valeur d'ID etc."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Dans le cas o\xf9 il y a plusieurs erreurs, il vaut mieux ",(0,i.jsx)(s.strong,{children:"les signaler toutes"})," dans la m\xeame r\xe9ponse.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Si les erreurs sont de plusieurs types (par ex donn\xe9es mal form\xe9es et erreur fonctionnelle), on peut utiliser le code de retour 400 qui est g\xe9n\xe9rique."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Pour les messages de succ\xe8s c'est comme pour les erreurs :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Bien renseigner le bon code ",(0,i.jsx)(s.strong,{children:"2XX"})]}),"\n",(0,i.jsx)(s.li,{children:"Donner des informations suppl\xe9mentaires, comme par exemple retourner l'objet qu'on vient de cr\xe9er avec son ID g\xe9n\xe9r\xe9e."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Il faut regarder le flow dans son ensemble, et rep\xe9rer ce dont l'utilisateur d'API a besoin pour lui \xe9viter des erreurs qui seraient de son fait.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Une fois qu'on a rep\xe9r\xe9 les choses dont il aurait besoin, on les lui fournit avec une API pour lui faciliter le travail."}),"\n",(0,i.jsxs)(s.li,{children:["Ne pas h\xe9siter \xe0 agr\xe9ger des donn\xe9es ensemble dans une API, si \xe7a peut aider le consommateur \xe0 consulter une autre API en \xe9vitant des erreurs","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Par exemple lui fournir les \xe9l\xe9ments qui ont ",(0,i.jsx)(s.em,{children:"une particularit\xe9"})," plut\xf4t que bruts, pour qu'il puisse les utiliser dans une autre API qui a besoin en param\xe8tre d'un \xe9l\xe9ment qui a ",(0,i.jsx)(s.em,{children:"la particularit\xe9"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"6---designing-a-predictable-api",children:"6 - Designing a predictable API"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Il faut rester ",(0,i.jsx)(s.strong,{children:"consistant au sein de l'API"})," :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Dans le nommage et le format des diff\xe9rents param\xe8tres dans notre API.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Ex : si on a choisi ",(0,i.jsx)(s.code,{children:"accountNumber"})," quelque part, on ne le change pas en juste ",(0,i.jsx)(s.code,{children:"number"})," dans un des autres endpoints."]}),"\n",(0,i.jsx)(s.li,{children:"Et si c'\xe9tait un nombre, \xe7a reste un nombre."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Entre les diff\xe9rents paths de nos API endpoints."}),"\n",(0,i.jsx)(s.li,{children:"Dans la structure des donn\xe9es prises en param\xe8tre ou renvoy\xe9es."}),"\n",(0,i.jsx)(s.li,{children:"Dans les flows permis par les diff\xe9rents API endpoints."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["En plus de la consistance au sein de l'API, il faut respecter la consistance au sein de ",(0,i.jsx)(s.strong,{children:"l'organisation"}),", au sein du ",(0,i.jsx)(s.strong,{children:"domaine m\xe9tier"}),", et enfin avec ce qui est partag\xe9 par le ",(0,i.jsx)(s.strong,{children:"reste du monde"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Ne pas h\xe9siter \xe0 utiliser des standards ISO et autres.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"TIP : chercher “<some data> standard” ou “<some data> format” sur google."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Ne pas h\xe9siter \xe0 copier ce que fait une autre API connue, les utilisateurs se sentiront chez eux et tout le monde sera gagnant."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Il faut formaliser les r\xe8gles choisies pour l'API dans un document (cf. chapitre 13), au risque de les oublier et de faire perdre \xe0 l'API peu \xe0 peu sa consistance."}),"\n",(0,i.jsxs)(s.li,{children:["Il peut \xeatre int\xe9ressant de rendre l'API ",(0,i.jsx)(s.strong,{children:"adaptable"})," aux besoins de l'utilisateur :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Un m\xeame endpoint peut proposer d'envoyer les donn\xe9es sous ",(0,i.jsx)(s.strong,{children:"plusieurs formats"}),", par ex CSV et JSON.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["On peut utiliser un param\xe8tre dans l'URL : ",(0,i.jsx)(s.code,{children:"/ressource?format=csv"})]}),"\n",(0,i.jsxs)(s.li,{children:["Et on peut aussi utiliser un header HTTP fait pour \xe7a : ",(0,i.jsx)(s.code,{children:"Accept: text/csv"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Si le serveur ne peut pas r\xe9pondre dans ce format, il peut renvoyer le code ",(0,i.jsx)(s.code,{children:"406 Not Acceptable"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["A contrario, quand c'est le client qui envoie par exemple du contenu XML, il peut le sp\xe9cifier avec le header ",(0,i.jsx)(s.code,{children:"HTTP Content-type: application/xml"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Si le serveur ne comprend pas ce format, il peut r\xe9pondre ",(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"415 Unsupported Media"})}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["De la m\xeame mani\xe8re que pour les formats, un endpoint peut supporter ",(0,i.jsx)(s.strong,{children:"plusieurs langues"})," (traduction des phrases, syst\xe8me de mesure etc.).","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["On peut l\xe0 aussi tirer avantage du protocole HTTP en utilisant ses headers :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"Accept-Language: en-US"})," pour dire qu'on accepte l'anglais US."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"Content-Language: en-US"})," pour dire que le body sera en anglais US."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Enfin on peut aussi permettre \xe0 l'utilisateur des fonctionnalit\xe9s de ",(0,i.jsx)(s.strong,{children:"pagination, de filtrage ou d'ordre des \xe9l\xe9ments"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Le plus courant est d'utiliser des param\xe8tres dans l'URL :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"/ressources?page=3&sort=-amount&category=car"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Pour la pagination on pourrait penser au header HTTP ",(0,i.jsx)(s.code,{children:"Range: items=10-19"})," qui dit qu'on veut les items du 10\xe8me au 19\xe8me."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Il peut \xeatre tr\xe8s pratique le notre API soit ",(0,i.jsx)(s.strong,{children:"discoverable"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["On peut faire \xe7a \xe0 l'aide de ",(0,i.jsx)(s.strong,{children:"metadata"})," qu'on place dans le body. Par exemple, si on renvoie du contenu pagin\xe9, avoir un attribut “pagination” qui va donner la page actuelle et le nombre total de pages, pour aider l'utilisateur."]}),"\n",(0,i.jsxs)(s.li,{children:["On peut aussi ajouter des URLs pour aider l'utilisateur \xe0 faire ses prochaines requ\xeates d'API : \xe7a fait des ",(0,i.jsx)(s.strong,{children:"hypermedia API"}),". Par exemple pour la pagination, ajouter en plus un attribut ",(0,i.jsx)(s.code,{children:"next"})," et un ",(0,i.jsx)(s.code,{children:"last"})," avec en valeur les URLs permettant d'obtenir ces pages.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Il s'agit d'une certaine mani\xe8re de faire la m\xeame chose qu'avec les pages web et leurs liens, mais avec les APIs."}),"\n",(0,i.jsxs)(s.li,{children:["Usuellement, les URLs vers le reste de l'API sont mis dans des attributs nomm\xe9s ",(0,i.jsx)(s.code,{children:"href"}),", ",(0,i.jsx)(s.code,{children:"links"}),", ou ",(0,i.jsx)(s.code,{children:"_links"}),"."]}),"\n",(0,i.jsx)(s.li,{children:"Plusieurs sp\xe9cifications ont \xe9t\xe9 cr\xe9\xe9es sur la mani\xe8re d'organiser ces URLs d'API, parmi eux HAL, Collection+JSON, JSON API, JSON-LD, Hydra et Siren."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Un des moyens d'obtenir des informations sur un endpoint est d'utiliser la m\xe9thode HTTP ",(0,i.jsx)(s.code,{children:"OPTIONS"}),", qui devrait renvoyer les autres m\xe9thodes disponibles sur cet endpoint, mais aussi des informations sur le format, ou encore des URLs vers d'autres endpoints utiles li\xe9s.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Attention cependant \xe0 bien documenter ce qu'on impl\xe9mente dans notre API, les utilisateurs sont rarement des experts du protocole HTTP…"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"7---designing-a-concise-and-well-organized-api",children:"7 - Designing a concise and well-organized API"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Il faut bien ",(0,i.jsx)(s.strong,{children:"organiser"})," son API :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Organiser les ",(0,i.jsx)(s.strong,{children:"donn\xe9es"})," :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Par exemple en groupant les propri\xe9t\xe9s li\xe9es entre elles ensemble, c\xf4te \xe0 c\xf4te ou m\xeame au sein d'un objet.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Dans le cas o\xf9 une propri\xe9t\xe9 est optionnelle, et qu'une autre propri\xe9t\xe9 n'a de sens que si la premi\xe8re est utilis\xe9e, les grouper dans un objet serait une bonne id\xe9e."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"En classant les propri\xe9t\xe9s des plus importantes aux moins importantes \xe0 mesure qu'on descend"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Organiser le ",(0,i.jsx)(s.strong,{children:"feedback"})," :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Quand des erreurs se produisent, on peut les cat\xe9goriser avec un type pr\xe9cis avec un syst\xe8me d'enums (en plus du statut HTTP)."}),"\n",(0,i.jsx)(s.li,{children:"Et on peut les classer de la plus importante \xe0 la moins importante."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Organiser les ",(0,i.jsx)(s.strong,{children:"API endpoints"})," :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["On peut les grouper par cat\xe9gorie fonctionnelle dans notre document OpenAPI, pour plus de clart\xe9.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Et dans chaque cat\xe9gorie, classer du plus important au moins important."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Il faut bien ",(0,i.jsx)(s.strong,{children:"dimensionner"})," ses endpoints :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Bien r\xe9fl\xe9chir au ",(0,i.jsx)(s.strong,{children:"nombre de propri\xe9t\xe9s"})," d'une structure de donn\xe9es, et \xe0 la ",(0,i.jsx)(s.strong,{children:"profondeur d'imbrication"})," en fonction de son cas d'usage.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Pour la profondeur, il est recommand\xe9 de ne pas d\xe9passer 3 niveaux."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Bien r\xe9fl\xe9chir aux endpoints eux-m\xeames et \xe0 la ",(0,i.jsx)(s.strong,{children:"complexit\xe9"})," qu'ils peuvent embarquer pour l'utilisateur :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Par exemple, un endpoint qui permet d'avoir des infos sur un compte en banque, et qui donne en m\xeame temps la liste de toutes les transactions du compte sera probablement surcharg\xe9 inutilement si l'utilisateur veut juste les infos sur le compte."}),"\n",(0,i.jsxs)(s.li,{children:["Il vaut mieux s'assurer que ",(0,i.jsx)(s.strong,{children:"notre endpoint ne fait pas 2 choses tr\xe8s diff\xe9rentes"})," (ou plus) en m\xeame temps."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Le dimensionnement d\xe9pend en fait du contexte et doit \xeatre optimis\xe9 pour l'exp\xe9rience utilisateur des consommateurs. En g\xe9n\xe9ral, les petites unit\xe9s fonctionnent mieux qu'un \xe9norme couteau suisse."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"8---designing-a-secure-api",children:"8 - Designing a secure API"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Une des techniques utilis\xe9es couramment pour s\xe9curiser des API web est le framework ",(0,i.jsx)(s.strong,{children:"OAuth"})," 2.0.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["il faut enregistrer des ",(0,i.jsx)(s.strong,{children:"consumers"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Ca peut se faire par exemple sur un portail de d\xe9veloppement o\xf9 on va se connecter, payer ce qu'il faut etc."}),"\n",(0,i.jsxs)(s.li,{children:["Quand on enregistre le consumer, on va lui attribuer des ",(0,i.jsx)(s.strong,{children:"scopes"})," d'autorisation, qui vont correspondre \xe0 la possibilit\xe9 d'acc\xe9der \xe0 un certain nombre d'API endpoints et de m\xe9thodes."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"2",children:["\n",(0,i.jsxs)(s.li,{children:["le ",(0,i.jsx)(s.strong,{children:"client"})," consumer va pouvoir demander un token au ",(0,i.jsx)(s.strong,{children:"serveur d'authentification"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"L'utilisateur final propri\xe9taire entre ses identifiants sur la page du serveur d'authentification, et apr\xe8s v\xe9rification le serveur d'authentification envoie le token au client."}),"\n",(0,i.jsx)(s.li,{children:"Il existe d'autres flows possibles dans OAuth."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.ol,{start:"3",children:["\n",(0,i.jsx)(s.li,{children:"Le client va pouvoir consommer l'API en fournissant \xe0 chaque fois le token."}),"\n"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"A chaque requ\xeate, le serveur qui a les ressources va valider aupr\xe8s du serveur d'authentification que le token est valide et poss\xe8de les bons scopes d'autorisation."}),"\n",(0,i.jsxs)(s.li,{children:["Le serveur de ressources a connaissance du user ID et du scope d'autorisation attach\xe9 au token, et donc va pouvoir \xe9ventuellement ",(0,i.jsx)(s.strong,{children:"filtrer le contenu"})," avant de le renvoyer ce que sp\xe9cifie l'API."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["L'ID de l'utilisateur et les scopes attach\xe9s \xe0 son compte ne sont en g\xe9n\xe9ral pas dans le body de la requ\xeate ou les param\xe8tres d'URL, mais sont pourtant l\xe0 de par l'authentification initiale. Il est donc int\xe9ressant de remarquer qu'un m\xeame API endpoint peut ",(0,i.jsx)(s.strong,{children:"renvoyer diff\xe9rentes donn\xe9es en fonction de l'utilisateur qui y fait appel"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Selon l'organisation internationale OWASP, il faut ",(0,i.jsx)(s.strong,{children:"r\xe9duire la surface d'attaque"})," pour r\xe9duire le risque. Et donc il faut \xe9viter de donner la possibilit\xe9 de faire certaines actions \xe0 des utilisateurs qui n'en ont pas besoin."]}),"\n",(0,i.jsxs)(s.li,{children:["Comment bien d\xe9finir les ",(0,i.jsx)(s.strong,{children:"scopes d'autorisation"})," ?","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Il faut choisir la bonne ",(0,i.jsx)(s.strong,{children:"granularit\xe9"})," : un scope par endpoint et m\xe9thode c'est tr\xe8s flexible mais tr\xe8s complexe \xe0 configurer pour les utilisateurs, et si on a trop peu de scopes on risque d'\xeatre oblig\xe9 de donner trop de pouvoir \xe0 certains utilisateurs."]}),"\n",(0,i.jsx)(s.li,{children:"On peut par exemple partir de l'API goals canvas qui nous a permis de construire notre API en fonction des besoins de l'utilisateur qu'on a d\xe9finis, et regrouper sous un m\xeame scope les actions qui concernent un m\xeame flow."}),"\n",(0,i.jsx)(s.li,{children:"On peut aussi avoir des scopes arbitraires, comme un scope “admin” qui a acc\xe8s \xe0 tout."}),"\n",(0,i.jsx)(s.li,{children:"Il existe plusieurs mani\xe8res de d\xe9finir des scopes et pas de solution magique, et la bonne mani\xe8re d\xe9pend en fait du contexte."}),"\n",(0,i.jsx)(s.li,{children:"On peut aussi d\xe9finir plusieurs granularit\xe9s en m\xeame temps : des scopes grossiers mais faciles \xe0 configurer, et des scopes plus fins. L'utilisateur pourra alors utiliser un m\xe9lange et configurer plus finement les parties qu'il veut."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["OpenAPI permet de sp\xe9cifier des scopes pour chaque endpoint/m\xe9thode d\xe9fini :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Ca se fait dans components -> securitySchemes","\n",(0,i.jsx)(s.pre,{"data-language":"yaml","data-theme":"default",children:(0,i.jsxs)(s.code,{"data-language":"yaml","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"components"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"securitySchemes"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BankingAPIScopes"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"type"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"oauth2"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"flows"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"implicit"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"authorizationURL"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"https://..."'})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"scopes"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"beneficiary:read"'}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"List beneficiaries"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"beneficiary:manage"'}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"Create, list beneficiaries"})]})]})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Et ensuite on les indique dans nos paths existants :","\n",(0,i.jsx)(s.pre,{"data-language":"yaml","data-theme":"default",children:(0,i.jsxs)(s.code,{"data-language":"yaml","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"paths"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"/beneficiaries"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"get"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"description"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"Get beneficiaries list"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"security"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    - "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"BankingAPIScopes"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        - "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"beneficiary:read"'})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        - "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"beneficiary:manage"'})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"responses"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"…"})]})]})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Toujours dans l'optique de r\xe9duire la surface d'attaque, il faut ",(0,i.jsx)(s.strong,{children:"identifier les donn\xe9es sensibles"})," et ne pas les fournir quand ce n'est pas n\xe9cessaire.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Par exemple, quand on obtient les informations d'un compte, on peut donner par d\xe9faut les autres infos mais pas le num\xe9ro du compte, ou seulement les 4 derniers chiffres."}),"\n",(0,i.jsxs)(s.li,{children:["Quand il faut les fournir quand m\xeame, ou quand il faut fournir une action avec des cons\xe9quences jug\xe9es sensibles, alors on peut y faire attention et utiliser des techniques pour s'assurer qu'elles sont prot\xe9g\xe9es :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Isoler l'action sensible dans un ",(0,i.jsx)(s.strong,{children:"endpoint d\xe9di\xe9"})," qu'on va pouvoir mieux prot\xe9ger, dans le cas o\xf9 il y a une vraie diff\xe9rence de nature entre la version sensible et la version non sensible d'un point de vue utilisateur."]}),"\n",(0,i.jsxs)(s.li,{children:["Utiliser un ",(0,i.jsx)(s.strong,{children:"scope d\xe9di\xe9"}),", pour que par d\xe9faut la donn\xe9e sensible ne soit pas retourn\xe9e ou actionn\xe9e, et le soit si le scope d'autorisation est activ\xe9."]}),"\n",(0,i.jsxs)(s.li,{children:["Se baser sur les ",(0,i.jsx)(s.strong,{children:"permissions de l'utilisateur"})," qui fait l'appel pour ne d\xe9voiler la donn\xe9e sensible qu'\xe0 certaines personnes."]}),"\n",(0,i.jsxs)(s.li,{children:["Et enfin on peut ",(0,i.jsx)(s.strong,{children:"combiner"})," l'access control de l'utilisateur et du consommateur (scope) pour \xeatre s\xfbr qu'il s'agit de la bonne personne (et non pas d'une personne qui a une d\xe9l\xe9gation par exemple) et qu'elle le fait dans un cadre o\xf9 elle a la permission de le faire."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Concernant le feedback li\xe9 \xe0 la s\xe9curit\xe9, quand on demande quelque chose auquel on n'a pas acc\xe8s, on peut recevoir une r\xe9ponse ",(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"401 Unauthorized"})})," si on n'est pas correctement authentifi\xe9, ou ",(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"403 Forbidden"})})," si les scopes qui nous sont associ\xe9s ne sont pas suffisants pour qu'on fasse l'action.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Attention \xe0 ne pas d\xe9voiler inutilement des informations : il vaut parfois mieux renvoyer syst\xe9matiquement ",(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"404 Not Found"})})," plut\xf4t qu'un 403 m\xeame si la donn\xe9e existe, pour \xe9viter qu'un attaquant essaye de nombreuses donn\xe9es et puisse savoir lesquelles existent m\xeame s'il n'a pas les autorisations d'y acc\xe9der."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"9---evolving-an-api-design",children:"9 - Evolving an API design"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Quand on change notre API, il faut surtout \xe9viter les ",(0,i.jsx)(s.strong,{children:"breaking changes"}),", c'est-\xe0-dire ce qui obligerait les consommateurs \xe0 changer leur code pour ne pas que leur application casse.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Sur les ",(0,i.jsx)(s.strong,{children:"donn\xe9es en sortie"})," de l'API :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Il ne faut pas :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Enlever, modifier ou d\xe9placer des propri\xe9t\xe9s."}),"\n",(0,i.jsx)(s.li,{children:"Modifier le format / type d'une donn\xe9e."}),"\n",(0,i.jsx)(s.li,{children:"Augmenter la taille d'une cha\xeene qui \xe9tait limit\xe9e."}),"\n",(0,i.jsx)(s.li,{children:"Rendre optionnelle une propri\xe9t\xe9 qui \xe9tait obligatoire."}),"\n",(0,i.jsx)(s.li,{children:"Ajouter des valeurs \xe0 un enum."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["En revanche on peut :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Ajouter des propri\xe9t\xe9s, optionnelles ou obligatoires."}),"\n",(0,i.jsx)(s.li,{children:"Rendre obligatoire une propri\xe9t\xe9 qui ne l'\xe9tait pas."}),"\n",(0,i.jsx)(s.li,{children:"Diminuer la taille maximale de cha\xeenes limit\xe9es."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Une des possibilit\xe9s c'est d'ajouter des donn\xe9es d\xe9j\xe0 existantes dans de nouvelles propri\xe9t\xe9s, mais sous une autre forme. \xc7a peut par contre avoir des limites dans la mesure o\xf9 \xe7a complique aussi l'API."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Sur les ",(0,i.jsx)(s.strong,{children:"donn\xe9es en entr\xe9e"})," et les param\xe8tres :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["C'est pareil que pour les donn\xe9es en entr\xe9e, sauf :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"On peut rendre optionnelle une propri\xe9t\xe9 qui \xe9tait obligatoire, mais pas l'inverse."}),"\n",(0,i.jsx)(s.li,{children:"On peut augmenter la taille maximale d'une cha\xeene et pas la diminuer."}),"\n",(0,i.jsx)(s.li,{children:"On peut ajouter des valeurs \xe0 un enum."}),"\n",(0,i.jsx)(s.li,{children:"Si on ajoute une propri\xe9t\xe9, il faut qu'elle soit optionnelle."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Sur le ",(0,i.jsx)(s.strong,{children:"feedback"})," :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Le feedback peut \xeatre trait\xe9 comme des donn\xe9es de sortie.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"On ne peut donc pas ajouter un \xe9l\xe9ment \xe0 un enum d'erreurs existant."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Pour les codes de statut HTTP, la sp\xe9cification dit que les clients sont cens\xe9s au moins comprendre les classes d'erreur (2XX, 4XX, 5XX etc.), et donc que s'ils rencontrent une erreur qu'ils ne savent pas g\xe9rer (par ex 429), ils doivent se rabattre sur l'erreur par d\xe9faut de la classe (par ex 400).","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Dans la r\xe9alit\xe9, les clients ne vont pas forc\xe9ment suivre la spec, et n'importe quel changement de feedback pourrait les impacter (sauf peut \xeatre d'enlever un code d'erreur qui ne peut plus arriver). Donc si on peut \xe9viter d'introduire de nouvelles erreurs avec des clients qu'on connait pas, c'est mieux."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Sur les ",(0,i.jsx)(s.strong,{children:"endpoints et les flows d'appels"})," eux-m\xeames :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Renommer le path d'un endpoint est en th\xe9orie possible en renvoyant ",(0,i.jsx)(s.code,{children:"301 Moved Permanently"})," sur l'ancien path, mais dans les faits les clients ne vont pas forc\xe9ment le prendre en compte et se retrouver en \xe9tat d'erreur."]}),"\n",(0,i.jsx)(s.li,{children:"On ne peut pas non plus enlever des endpoints sans casser les clients."}),"\n",(0,i.jsxs)(s.li,{children:["On peut en ajouter, mais \xe0 condition que \xe7a ne change pas les flows existants.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:'Par exemple, si on ajoute un endpoint de validation qui devra \xeatre appel\xe9 juste apr\xe8s un ancien endpoint pour am\xe9liorer la s\xe9curit\xe9, les clients non mis \xe0 jour ne l\'appelleront pas, et auront des \xe9checs "silencieux", parce que le flow aura chang\xe9.'}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["M\xeame sans changer le contrat d'API, on peut quand m\xeame casser les clients par des changements d'apparence anodins du ",(0,i.jsx)(s.strong,{children:"contrat invisible"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["La loi de Hyrum dit : ",(0,i.jsx)(s.em,{children:"“With a sufficient number of users of an API, it does not matter what you promise in the contract: all observable behaviors of your system will be depended on by somebody”"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Les breaking changes sont bien plus graves sur les API publiques. Sur les API priv\xe9es on peut en g\xe9n\xe9ral se d\xe9brouiller pour mettre \xe0 jour les clients. Mais c'est quand m\xeame un poids non n\xe9gligeable, qui doit nous amener \xe0 nous poser la question pour chaque breaking change, de savoir si on le veut vraiment."}),"\n",(0,i.jsxs)(s.li,{children:["Quand les breaking changes deviennent in\xe9vitables, on peut ",(0,i.jsx)(s.strong,{children:"versionner son API"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Le semantic versioning classique des impl\xe9mentations (Major.Minor.patch) pourrait se transcrire dans l'univers des API par une version \xe0 2 chiffres : ",(0,i.jsx)(s.strong,{children:"Breaking.Non-breaking"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["Pour cr\xe9er les nouvelles versions, on peut :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Utiliser l'URL (blabla.com/apiv2/) ou les sous-domaines (v2.blabla.com/api/). C'est ce qui est le plus courant."}),"\n",(0,i.jsx)(s.li,{children:"Ajouter des param\xe8tres aux requ\xeates, que ce soit dans l'URL, dans le header HTTP ou autre. Mais globalement cette option-l\xe0 est moins claire, et moins appr\xe9ci\xe9e des consommateurs."}),"\n",(0,i.jsx)(s.li,{children:"Utiliser le fait que l'utilisateur de l'API est identifi\xe9, et donc stocker c\xf4t\xe9 provider une association UserID / Version. C'est plus simple pour le consommateur qui n'a rien \xe0 faire de son c\xf4t\xe9 \xe0 part demander \xe0 passer \xe0 la V2, mais moins flexible aussi."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Il est possible de versionner avec une plus grande granularit\xe9 que l'API enti\xe8re, par exemple ajouter une V2 seulement pour certains endpoints, seulement certaines m\xe9thodes, ou encore donner la possibilit\xe9 de visionner le contenu du body avec des headers HTTP.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Mais c'est peu connu des consommateurs, surtout dans le monde de REST, et \xe7a peut porter \xe0 confusion. Donc bien r\xe9fl\xe9chir avant d'aller par l\xe0."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Pour \xe9viter d'avoir \xe0 faire des breaking changes, on peut essayer d\xe8s le d\xe9but d'avoir des structures ",(0,i.jsx)(s.strong,{children:"extensibles"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Par exemple, prendre l'habitude d'",(0,i.jsx)(s.strong,{children:"encapsuler dans un objet"})," toute propri\xe9t\xe9 qui nous para\xeet importante va nous permettre d'y ajouter des propri\xe9t\xe9s par la suite."]}),"\n",(0,i.jsxs)(s.li,{children:["Si on a des propri\xe9t\xe9s similaires, il peut \xeatre judicieux de les ",(0,i.jsx)(s.strong,{children:"mettre dans une liste"})," ou un objet, pour pouvoir facilement les \xe9tendre plus tard.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Par ex si on a une date de d\xe9but, de fin, on peut les mettre dans une liste d'\xe9v\xe9nements, pour peut \xeatre plus tard ajouter une date d'ex\xe9cution comme \xe9l\xe9ment de liste suppl\xe9mentaire."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Utiliser des formats de donn\xe9es standard permet aussi de baisser le risque de vouloir les changer plus tard."}),"\n",(0,i.jsxs)(s.li,{children:["Concernant les erreurs, les mettre dans une liste, avec chacune dans son objet permet de les rendre extensibles, et de pouvoir en ajouter aussi.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["La propri\xe9t\xe9 ",(0,i.jsx)(s.code,{children:"type"})," correspondant \xe0 un enum indiquant le type d'erreur doit \xeatre le plus g\xe9n\xe9rique possible parce qu'on ne peut pas changer les enums sans breaking change.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Ex : ",(0,i.jsx)(s.code,{children:"MISSING_MANDATORY_ATTRIBUTE"}),", plut\xf4t que ",(0,i.jsx)(s.code,{children:"MISSING_AMOUNT"})," si la propri\xe9t\xe9 manquante \xe9tait un amount."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Autre exemple : l'auteur conseille de ne pas retourner d'erreur si l'utilisateur demande 150 r\xe9sultats par page et que le maximum est de 100, mais d'en retourner simplement 100. Et plus tard, si on veut abaisser ce maximum \xe0 50, on ne provoquera pas non plus d'erreurs chez les clients.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Bien s\xfbr, si l'utilisateur veut transf\xe9rer 1500€ et qu'il a 1000€, il ne faut pas faire le transfert de 1000€ silencieusement, quand \xe7a concerne le domaine m\xe9tier ce genre de choix doit \xeatre r\xe9fl\xe9chi avec soin :)"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Plus l'API va grossir, et plus l'\xe9tendre va devenir difficile sans casser soit les donn\xe9es, soit les flows. Une bonne pratique est de garder les API petites, et d'en faire plusieurs autonomes."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"10---designing-a-network-efficient-api",children:"10 - Designing a network-efficient API"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Le “design id\xe9al” d'API est contrebalanc\xe9 par des facteurs suppl\xe9mentaires \xe0 prendre en compte. L'un d'entre eux est la performance r\xe9seau. Il faut trouver un ",(0,i.jsx)(s.strong,{children:"compromis"})," entre les deux."]}),"\n",(0,i.jsxs)(s.li,{children:["Les probl\xe8mes de performance r\xe9seau d\xe9pendent :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"de la vitesse du r\xe9seau"}),"\n",(0,i.jsx)(s.li,{children:"du volume de donn\xe9es \xe9chang\xe9e"}),"\n",(0,i.jsx)(s.li,{children:"du nombre d'appels API"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Il y a d'abord des ",(0,i.jsx)(s.strong,{children:"optimisations au niveau du protocole"})," :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["La ",(0,i.jsx)(s.strong,{children:"compression"})," et les ",(0,i.jsx)(s.strong,{children:"connexions persistantes"})," sont disponibles par d\xe9faut dans HTTP, et peuvent \xeatre activ\xe9es d\xe8s le d\xe9but.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["La compression permet de ",(0,i.jsx)(s.strong,{children:"r\xe9duire les donn\xe9es \xe9chang\xe9es"})]}),"\n",(0,i.jsxs)(s.li,{children:["Les connexions persistantes permettent de r\xe9utiliser les m\xeames connexions pour plusieurs requ\xeates, pour ",(0,i.jsx)(s.strong,{children:"gagner de la latence"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Chaque endpoint/m\xe9thode peut renvoyer des m\xe9tadonn\xe9es indiquant combien de temps la r\xe9ponse doit \xeatre ",(0,i.jsx)(s.strong,{children:"mise en cache"})," (donc conserv\xe9e sans refaire d'appel API) par le client.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Pour le protocole HTTP \xe7a se fait avec le header ",(0,i.jsx)(s.code,{children:"Cache-Control"}),"."]}),"\n",(0,i.jsx)(s.li,{children:"Pour choisir la valeur on se base sur le contexte au cas par cas : est-ce qu'il est probable statistiquement que telle donn\xe9e soit chang\xe9e dans l'heure ? Dans les 10 mn ? Est-ce que c'est important d'avoir des donn\xe9es tr\xe8s \xe0 jour sur telle ou telle donn\xe9e ?"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["En plus du cache on peut aussi utiliser les ",(0,i.jsx)(s.strong,{children:"requ\xeates conditionnelles"})," : cette fois il s'agira pour le backend de soit retourner la donn\xe9e si elle a \xe9t\xe9 modifi\xe9e depuis la derni\xe8re fois, soit une simple r\xe9ponse ",(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"304 Not Modified"})})," sans rien dans le body.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"On gagne en bande passante."}),"\n",(0,i.jsxs)(s.li,{children:["Le m\xe9canisme consiste \xe0 ce que le backend envoie un ",(0,i.jsx)(s.code,{children:"Etag"})," dans le header HTTP la premi\xe8re fois, et que ce tag soit renvoy\xe9 par le client pour les prochaines fois. Le backend peut alors savoir si depuis cet Etag la donn\xe9e a chang\xe9 ou non. Si elle a chang\xe9, il renverra un nouvel Etag pour la prochaine fois."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Mais on peut aussi optimiser l'utilisation r\xe9seau gr\xe2ce \xe0 des ",(0,i.jsx)(s.strong,{children:"techniques de design d'API"})," :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Permettre la ",(0,i.jsx)(s.strong,{children:"pagination"})," et le ",(0,i.jsx)(s.strong,{children:"filtrage"})," est une des pani\xe8res d'envoyer moins de donn\xe9es \xe0 la fois.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Dans le cas d'une pagination, si des \xe9l\xe9ments sont ajout\xe9s au fur et \xe0 mesure et qu'on veut garder une fiabilit\xe9 et une exhaustivit\xe9 de ce qui est affich\xe9, on peut demander les X prochains \xe9l\xe9ments \xe0 partir de l'\xe9l\xe9ment qui a tel ID, plut\xf4t que juste la page 2."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Bien ",(0,i.jsx)(s.strong,{children:"choisir les propri\xe9t\xe9s"})," pour les ",(0,i.jsx)(s.strong,{children:"\xe9l\xe9ments d'une liste"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Il faut trouver une balance entre trop de propri\xe9t\xe9s (voir toutes) quand on fait GET sur une ressource sans pr\xe9ciser laquelle, et pas assez de propri\xe9t\xe9s. Dans un cas on a beaucoup de donn\xe9es quelle que soit l'utilisation, dans l'autre on peut se retrouver \xe0 devoir refaire un GET mais cette fois avec l'ID de chaque objet, pour obtenir le d\xe9tail avec les propri\xe9t\xe9s qui nous int\xe9ressent."}),"\n",(0,i.jsx)(s.li,{children:"La solution est de trouver les propri\xe9t\xe9s qui sont souvent utiles quand on traite une liste d'objets, et les ajouter \xe0 la r\xe9ponse de l'API de liste."}),"\n",(0,i.jsxs)(s.li,{children:["Une autre solution serait d'accepter un param\xe8tre ou un header HTTP (par ex ",(0,i.jsx)(s.code,{children:"Accept:application/notre.content.type.custom+json"}),"), et de renvoyer la version courte, compl\xe8te, ou m\xeame enrichie en propri\xe9t\xe9s en fonction de ce qui est demand\xe9 par le client."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Agr\xe9ger des donn\xe9es"})," venant de ressources diff\xe9rentes dans une m\xeame r\xe9ponse d'API. Il s'agit de d\xe9normalisation de donn\xe9es dans l'API.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\xc7a peut permettre d'\xe9conomiser des appels d'API.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Par exemple en obtenant dans un m\xeame appel le profil d'une personne, et la liste de ses adresses qui sont d'habitude dans une ressource s\xe9par\xe9e."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Mais c'est \xe0 manipuler avec pr\xe9caution :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"D'abord c'est pas s\xfbr que \xe7a nous fasse \xe9conomiser du temps dans tous les cas : parfois une \xe9norme requ\xeate peut prendre plus de temps que plusieurs en parall\xe8le, ou m\xeame \xeatre plus fragile sur des r\xe9seaux lents (type 3G), et donc plus souvent sujette \xe0 \xeatre retent\xe9e de z\xe9ro."}),"\n",(0,i.jsx)(s.li,{children:"Ensuite \xe7a peut \xeatre plus difficile \xe0 mettre en cache, sachant que le temps de cache sera alors celui de la ressource contenue dans l'agr\xe9gation qui a le temps de vie le plus court.\nDonc mauvaise id\xe9e de grouper une ressource qui change peu souvent et une ressource qui change tr\xe8s souvent dans un m\xeame endpoint."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["On peut aussi le faire de l'",(0,i.jsx)(s.strong,{children:"expansion"})," \xe0 la demande avec un param\xe8tre : d\xe9normaliser les donn\xe9es des propri\xe9t\xe9s indiqu\xe9es par le client, si c'est possible.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["M\xeame exemple que le profil avec ses adresses, sauf que le client ajoute un param\xe8tre ",(0,i.jsx)(s.code,{children:"/profile?expand=addresses"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Permettre le ",(0,i.jsx)(s.strong,{children:"querying c\xf4t\xe9 client"})," avec des API du type ",(0,i.jsx)(s.strong,{children:"GraphQL"}),". Les clients indiquent alors chaque propri\xe9t\xe9 qu'ils veulent parmi celles disponibles pour une m\xeame ressource.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"C'est utile quand le r\xe9seau est vraiment important pour nous, et que chaque milliseconde compte."}),"\n",(0,i.jsxs)(s.li,{children:["Par contre GraphQL utilise uniquement la m\xe9thode POST sur un unique endpoint HTTP, donc les m\xe9canismes de cache usuels qu'on peut mettre en place avec les API REST et les headers HTTP (",(0,i.jsx)(s.code,{children:"Cache-Control"})," etc.) ne marchent pas.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"L'\xe9ventuelle mise en cache doit \xeatre g\xe9r\xe9e par le client plut\xf4t qu'un niveau du protocole, mais c'est de toute fa\xe7on assez compliqu\xe9 \xe9tant donn\xe9 qu'on fait en fait de l'agr\xe9gation dans tous les sens."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["De mani\xe8re g\xe9n\xe9rale, revenir aux bases et ",(0,i.jsx)(s.strong,{children:"envoyer aux utilisateurs ce dont ils ont besoin"})," peut probablement permettre de r\xe9duire les appels r\xe9seau. Que ce soit avec de l'agr\xe9gation, l'ajout d'une propri\xe9t\xe9 ici ou l\xe0, l'ajout de nouveaux endpoints sp\xe9cifiques pour pour des besoins pr\xe9cis etc.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Mais comme toujours il faut trouver le bon compromis. En cr\xe9ant trop d'endpoints personnalis\xe9s on risque aussi d'obtenir une API compliqu\xe9e et pas tr\xe8s r\xe9utilisable. Une solution peut \xeatre alors de cr\xe9er des ",(0,i.jsx)(s.strong,{children:"couches d'API interm\xe9diaires"})," consommant l'API initiale, et fournissant des endpoints sp\xe9cifiques \xe0 un contexte donn\xe9.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Par exemple, les ",(0,i.jsx)(s.strong,{children:"BFF (Backend For Frontend)"})," sont des API qui vont consommer des API de donn\xe9es plus g\xe9n\xe9riques, et fournir des endpoints personnalis\xe9s pour r\xe9pondre exactement aux besoins du frontend qu'ils ont en charge."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"11---designing-an-api-in-context",children:"11 - Designing an API in context"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["La nature des informations et de la relation provider / consumer peut lourdement influencer le design d'API. On peut avoir parfois besoin d'une ",(0,i.jsx)(s.strong,{children:"communication initi\xe9e par le provider"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Exemple : une transaction initi\xe9e par le client est accept\xe9e tout de suite (donc r\xe9ponse ",(0,i.jsx)(s.code,{children:"202 Accepted"}),"), mais doit ensuite \xeatre valid\xe9e puis ex\xe9cut\xe9e, et \xe7a peut prendre des minutes, heures voire jours.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Le client peut faire des appels r\xe9guliers pour voir o\xf9 \xe7a en est, et le header ",(0,i.jsx)(s.code,{children:"Cache-Control"})," peut donner au client une id\xe9e de la fr\xe9quence \xe0 laquelle faire ces appels."]}),"\n",(0,i.jsx)(s.li,{children:"Pour autant, il est hors de question que le client patiente pendant des heures ou des jours en faisant des appels r\xe9guliers, c'est trop inefficace."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["La solution peut \xeatre la mise en place d'un ",(0,i.jsx)(s.strong,{children:"webhook"})," c\xf4t\xe9 client.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Il s'agit d'une API HTTP, standardis\xe9e par le provider (pour que ce ne soit pas l'anarchie) et mise en place par le client, et dont le client a donn\xe9 l'URL au provider au moment de souscrire pour avoir un token et pouvoir consommer l'API du provider."}),"\n",(0,i.jsx)(s.li,{children:"Une fois que la transaction a \xe9t\xe9 ex\xe9cut\xe9e, le provider va alors faire un appel POST sur ce webhook, en donnant les infos de l'\xe9v\xe9nement qui s'est produit. Ce backend maintenu par le client peut alors utiliser les moyens n\xe9cessaires pour envoyer l'info au t\xe9l\xe9phone, ou au navigateur (par des m\xe9canismes push, des websockets, du simple polling HTTP de la part du navigateur etc.)."}),"\n",(0,i.jsx)(s.li,{children:"Attention \xe0 penser \xe0 la s\xe9curit\xe9 du webhook. Une des possibilit\xe9s c'est d'en faire un event assez g\xe9n\xe9rique qui va pousser le client \xe0 faire une autre requ\xeate pour obtenir les infos d\xe9taill\xe9es de l'event."}),"\n",(0,i.jsxs)(s.li,{children:["Ce syst\xe8me de webhooks est standardis\xe9 par le W3C sous le nom ",(0,i.jsx)(s.strong,{children:"WebSub"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Dans le cas o\xf9 c'est le client qui veut obtenir des ",(0,i.jsx)(s.strong,{children:"updates tr\xe8s fr\xe9quents"})," pendant un certain temps, et pour \xe9viter qu'il fasse des calls permanents, il peut faire un appel qui initie une communication ",(0,i.jsx)(s.strong,{children:"SSE (Server-Sent Events)"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Les SSE se basent sur HTTP, et ont \xe9t\xe9 standardis\xe9s par le W3C pour HTML5, donc fonctionnent tr\xe8s bien avec les navigateurs."}),"\n",(0,i.jsx)(s.li,{children:"La connexion HTTP reste ouverte, et le serveur peut simplement envoyer des donn\xe9es d\xe8s qu'il les a, jusqu'\xe0 ce que l'un des deux demande \xe0 fermer la connexion."}),"\n",(0,i.jsx)(s.li,{children:"Par contre c'est unidirectionnel : c'est le serveur qui envoie les donn\xe9es."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Si on veut une ",(0,i.jsx)(s.strong,{children:"connexion bidirectionnelle"})," (par exemple pour les chats), on peut recourir aux ",(0,i.jsx)(s.strong,{children:"WebSockets"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Les WebSockets ne se basent pas sur HTTP mais directement sur TCP, donc la mise en place peut \xeatre plus compliqu\xe9e vis-\xe0-vis des proxies et autres."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Parfois, pour \xe9conomiser des requ\xeates on peut vouloir faire des ",(0,i.jsx)(s.strong,{children:"PATCH, PUT, POST ou DELETE sur une liste d'\xe9l\xe9ments"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Il suffit d'envoyer en body une liste d'objets avec la m\xeame information qu'on aurait donn\xe9 pour faire l'op\xe9ration sur un seul \xe9l\xe9ment."}),"\n",(0,i.jsxs)(s.li,{children:["C\xf4t\xe9 r\xe9ponse, dans un cas comme \xe7a on peut valider les \xe9l\xe9ments qui r\xe9ussissent m\xeame si certains ont \xe9chou\xe9.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"On peut retourner une liste avec l\xe0 aussi la r\xe9ponse qu'on aurait renvoy\xe9 pour chaque \xe9l\xe9ment seul : le statut, la ou les erreurs \xe9ventuelles ou le contenu pour chaque \xe9l\xe9ment."}),"\n",(0,i.jsxs)(s.li,{children:["Le statut de la r\xe9ponse HTTP peut \xeatre alors ",(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"207 Multi-Status"})}),"."]}),"\n",(0,i.jsx)(s.li,{children:"Attention \xe0 bien v\xe9rifier que dans notre cas valider certains \xe9l\xe9ments et avoir des \xe9l\xe9ments sur d'autres ne cr\xe9e pas d'incoh\xe9rence."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Le type d'API qu'on utilise doit \xeatre choisi en fonction du contexte, \xe0 la fois celui du consumer parce que l'API est pour lui, et celui du provider parce qu'il a aussi des contraintes. Il faut \xe9viter de c\xe9der au ",(0,i.jsx)(s.strong,{children:"biais de choisir l'outil ou le format qu'on conna\xeet le mieux"})," \xe0 chaque fois."]}),"\n",(0,i.jsxs)(s.li,{children:["Actuellement il y a 3 types d'API connues : ",(0,i.jsx)(s.strong,{children:"REST"}),", ",(0,i.jsx)(s.strong,{children:"GraphQL"})," et ",(0,i.jsx)(s.strong,{children:"gRPC"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["REST \xe9tant de loin le plus connu, et r\xe9pondant \xe0 la plupart des besoins, il est consid\xe9r\xe9 comme celui \xe0 prendre par d\xe9faut si on n'a pas de contraintes particuli\xe8res. Les autres peuvent aussi \xeatre tr\xe8s bien en fonction du contexte.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["REST est bas\xe9 sur les ",(0,i.jsx)(s.strong,{children:"ressources"})," et suit le protocole HTTP de tr\xe8s pr\xe8s. Il est le plus standardis\xe9, et permet de profiter nativement des fonctionnalit\xe9s de HTTP (content-negotiation, caching, requ\xeates conditionnelles etc.)."]}),"\n",(0,i.jsx)(s.li,{children:"La gestion d'erreur est standardis\xe9e : 4XX, 5XX."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["gRPC (g pour Google, et RPC pour Remote Procedure Call) consiste \xe0 ",(0,i.jsx)(s.strong,{children:"appeler des fonctions"})," dans son code en leur donnant des param\xe8tres. Ces fonctions sont compl\xe8tement custom de la part du provider, et ne se basent pas sur un mod\xe8le comme les ressources pour REST.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Il est en g\xe9n\xe9ral utilis\xe9 avec des donn\xe9es format\xe9es en ",(0,i.jsx)(s.strong,{children:"protobuf"})," (\xe0 la place de JSON), qui est un format binaire et ne r\xe9p\xe9tant pas le nom de chaque propri\xe9t\xe9 contrairement \xe0 JSON (donc peut diviser par presque 2 la taille des donn\xe9es transf\xe9r\xe9es). Par contre c'est moins connu que JSON, et moins facile \xe0 afficher / d\xe9bugger parce que binaire."]}),"\n",(0,i.jsx)(s.li,{children:"Il est construit par dessus HTTP mais n'utilise pas la plupart de ses fonctionnalit\xe9s comme REST. Par contre, il permet les communications bidirectionnelles gr\xe2ce \xe0 HTTP2."}),"\n",(0,i.jsx)(s.li,{children:"Il a un format standard d'erreurs inspir\xe9 de REST, et pas de m\xe9canisme standard de caching."}),"\n",(0,i.jsxs)(s.li,{children:["Il faut l'utiliser plut\xf4t que REST quand on a une API ",(0,i.jsx)(s.strong,{children:"priv\xe9e vers client priv\xe9"})," (communication entre services d'un m\xeame backend), quand les millisecondes gagn\xe9es importent vraiment."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["GraphQL adopte le m\xeame ",(0,i.jsx)(s.strong,{children:"mod\xe8le bas\xe9 sur les fonctions"})," que gRPC pour la cr\xe9ation/modification, par contre pour le querying il a un ",(0,i.jsx)(s.strong,{children:"mod\xe8le bas\xe9 sur les donn\xe9es"})," : c'est l'utilisateur qui sp\xe9cifie non seulement les propri\xe9t\xe9s qu'il veut, mais aussi avec quel autre donn\xe9e il veut faire un lien etc.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Pour le query l'utilisateur a une grande flexibilit\xe9, mais il est aussi en capacit\xe9 de demander ",(0,i.jsx)(s.strong,{children:"des requ\xeates extr\xeamement complexes et co\xfbteuses"}),". Le rate-limiting peut ne pas suffire pour se prot\xe9ger parce qu'on ne peut pas pr\xe9voir ce que le client va faire."]}),"\n",(0,i.jsx)(s.li,{children:"Il est agnostique niveau protocole, et est utilis\xe9 la plupart du temps par dessus HTTP avec des POST sur un endpoint unique."}),"\n",(0,i.jsx)(s.li,{children:"Il a un format standard d'erreurs qui consiste \xe0 donner un texte d'erreur, et la ligne qui a caus\xe9 l'erreur dans la requ\xeate GraphQL et la propri\xe9t\xe9 probl\xe9matique dans la donn\xe9e en r\xe9ponse (si une r\xe9ponse partielle a pu \xeatre faite)."}),"\n",(0,i.jsx)(s.li,{children:"Il n'a pas de m\xe9canisme standard pour le caching, et celui-ci est difficile \xe9tant donn\xe9 la flexibilit\xe9 des donn\xe9es."}),"\n",(0,i.jsxs)(s.li,{children:["Il faut aller vers GraphQL plut\xf4t que REST quand on est dans un contexte d'",(0,i.jsx)(s.strong,{children:"API priv\xe9e"})," et alimentant des ",(0,i.jsx)(s.strong,{children:"p\xe9riph\xe9riques mobiles"})," qui ont besoin d'\xe9conomiser la quantit\xe9 de donn\xe9es \xe9chang\xe9e."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"A noter qu'on peut tout \xe0 fait avoir par ex une API BFF sp\xe9cialis\xe9e qui expose du GraphQL pour les mobiles, et qui consomme une API REST ou gRPC plus g\xe9n\xe9rique dans notre backend."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"12---documenting-an-api",children:"12 - Documenting an API"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Cr\xe9er une documentation est une mani\xe8re de tester le design : si on est incapable de l'expliquer c'est qu'il y a peut \xeatre des incoh\xe9rences."}),"\n",(0,i.jsxs)(s.li,{children:["Dans la documentation d'une API, il faut bien \xe9videmment ",(0,i.jsx)(s.strong,{children:"une r\xe9f\xe9rence des endpoints possibles"}),". Typiquement le genre de documentation qu'on peut g\xe9n\xe9rer \xe0 partir d'une sp\xe9cification OpenAPI.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Pour fournir plusieurs exemples dans OpenAPI :","\n",(0,i.jsx)(s.pre,{"data-language":"yaml","data-theme":"default",children:(0,i.jsxs)(s.code,{"data-language":"yaml","data-theme":"default",children:[(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"requestBody"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"content"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"application/json"'}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"#..."})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"examples"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"premierExemple"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"# ..."})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"deuxiemeExemple"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"summary"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"R\xe9sum\xe9 du 2\xe8me exemple"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"description"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"Description du 2\xe8me exemple"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"value"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"prop1"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"blablabla"'})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"prop2"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"3"})]}),"\n",(0,i.jsxs)(s.span,{className:"line",children:[(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"prop3"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"bliblibli"'})]})]})}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Les outils comme ReDoc sont m\xeame capables de g\xe9n\xe9rer des exemples de donn\xe9es JSON complets \xe0 partir des types et formats d\xe9clar\xe9s dans la sp\xe9cification OpenAPI."}),"\n",(0,i.jsx)(s.li,{children:"Il faut d\xe9crire ce que fait chaque endpoint, les donn\xe9es qu'il prend et renvoie, mais aussi chaque cas possible de r\xe9ponse de r\xe9ussite ou d'erreur. Et ne pas oublier la s\xe9curit\xe9 (scopes, autorisations). Tout \xe7a se fait dans OpenAPI."}),"\n",(0,i.jsxs)(s.li,{children:["A propos de l'id\xe9e de g\xe9n\xe9rer la documentation \xe0 partir du code (avec \xe9ventuellement un format OpenAPI automatique interm\xe9diaire) versus maintenir le fichier OpenAPI \xe0 la main :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"L'avantage c'est la synchronisation plus facile entre le code et la doc."}),"\n",(0,i.jsx)(s.li,{children:"Les inconv\xe9nients sont surtout le manque de flexibilit\xe9 : la documentation finale contiendra moins de choses si tout vient du code. Et le risque que l'API ait plus tendance \xe0 exposer le point de vue du provider, ce qu'on souhaite \xe9viter."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Il faut aussi un ",(0,i.jsx)(s.strong,{children:"guide utilisateur"})," qui va expliquer l'API d'un point de vue global, les principes g\xe9n\xe9raux, comment \xe9ventuellement s'inscrire pour avoir un token etc.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Pour le coup cette partie doit \xeatre \xe9crite \xe0 la main, par exemple en markdown."}),"\n",(0,i.jsx)(s.li,{children:"On y ajoute des cas d'usage d\xe9taill\xe9s, qui seront le reflet de l'API goal canvas qu'on a utilis\xe9 pour designer notre API : telle personne a besoin de telle et telle info pour pour faire telle chose + le d\xe9tail des infos qu'elle donne, les API calls, les r\xe9ponses qu'elle re\xe7oit."}),"\n",(0,i.jsx)(s.li,{children:"On peut aussi y ajouter les choses communes \xe0 l'API comme le type de pagination utilis\xe9e, les formats de donn\xe9es et plus g\xe9n\xe9ralement les headers HTTP support\xe9s etc."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Il peut \xeatre utile d'avoir une ",(0,i.jsx)(s.strong,{children:"documentation sp\xe9cifique pour les d\xe9veloppeurs de l'impl\xe9mentation"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Elle peut contenir des choses que les consommateurs n'ont pas besoin de savoir, et qui sont li\xe9es \xe0 la mani\xe8re dont l'API s'int\xe8gre avec l'impl\xe9mentation. Par exemple des infos sur d'o\xf9 vient telle ou telle propri\xe9t\xe9 dans le syst\xe8me, des liens vers des formats pour aider \xe0 impl\xe9menter etc."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Et enfin il faut un ",(0,i.jsx)(s.strong,{children:"changelog"})," listant pour chaque version ce qui est ajout\xe9/modifi\xe9, et surtout les breaking changes.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["OpenAPI ne permet pas de faire de changelog, mais il permet d'ajouter une propri\xe9t\xe9 ",(0,i.jsx)(s.code,{children:"deprecated: true"})," sur les param\xe8tres, les endpoints, les propri\xe9t\xe9s."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"13---growing-apis",children:"13 - Growing APIs"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["A partir du moment o\xf9 plusieurs personnes travaillent sur l'API, ou qu'il y a plusieurs APIs dans l'organisation, il y a de fortes chances pour que de l'incoh\xe9rence s'installe entre APIs et au sein d'une API. Il faut pour \xe7a r\xe9diger des ",(0,i.jsx)(s.strong,{children:"API guidelines"})," \xe0 destination des designers d'API.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Il y a 3 parties :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Il y a d'abord les ",(0,i.jsx)(s.strong,{children:"reference guidelines"})," qui sont le minimum : le document d\xe9crit quelles m\xe9thodes, codes de statut, headers sont utilis\xe9s couramment dans l'API, le format des ressources (la structure de leur path), la structure habituelle des donn\xe9es, la mani\xe8re dont la pagination est g\xe9r\xe9e etc.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"On y d\xe9finit aussi les termes utilis\xe9s dans l'API (ressource, version etc.) \xe0 l'image du langage ubiquitaire du DDD."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Ensuite il faut les ",(0,i.jsx)(s.strong,{children:"use case guidelines"})," qui sont une version plus digeste et pr\xeate \xe0 l'emploi pour \xe9tendre l'API. Par exemple comment cr\xe9er un nouvel \xe9l\xe9ment dans l'API, et on montre pas \xe0 pas, comme un tuto.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"On fait bien attention \xe0 utiliser le m\xeame vocabulaire partag\xe9 que celui d\xe9fini dans les reference guidelines."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Enfin, on peut ajouter des ",(0,i.jsx)(s.strong,{children:"design process guidelines"})," o\xf9 on va donner des r\xe9f\xe9rence vers des ressources utiles pour creuser tel ou tel aspect utile pour le design de l'API. Par exemple des liens vers des sp\xe9cifications, tutoriels, livres etc."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Le site ",(0,i.jsx)(s.a,{href:"https://webconcepts.info/",children:"webconcepts.info"})," rassemble des informations fiables sur HTTP, OAuth et d'autres concepts li\xe9s avec des liens vers les sp\xe9cifications, int\xe9ressant quand on cherche la bonne sp\xe9cification \xe0 suivre."]}),"\n",(0,i.jsxs)(s.li,{children:["Le site ",(0,i.jsx)(s.a,{href:"http://apistylebook.com/",children:"apistylebook.com"})," rassemble des API guidelines c\xe9l\xe8bres dont on peut s'inspirer."]}),"\n",(0,i.jsxs)(s.li,{children:["Il faut \xe9crire les guidelines ",(0,i.jsx)(s.strong,{children:"petit \xe0 petit"})," de mani\xe8re ",(0,i.jsx)(s.strong,{children:"it\xe9rative"}),", en n'y mettant que ce dont on est s\xfbr \xe0 chaque fois, et en \xe9tant pr\xeat \xe0 revoir le contenu.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Il faut aussi que ce soit un travail collectif et permanent de tous ceux qui sont en charge du design de l'API, sinon les guidelines ne seront pas respect\xe9es."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Une API \xe9tant potentiellement difficile \xe0 changer, et pouvant poser des probl\xe8mes importants de s\xe9curit\xe9, il est important qu'il y ait une proc\xe9dure de ",(0,i.jsx)(s.strong,{children:"review"})," s\xe9rieuse \xe0 chaque changement.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Il faut avant tout identifier les ",(0,i.jsx)(s.strong,{children:"besoins"})," derri\xe8re un changement d'API.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"La m\xe9thode des 5 “Pourquoi ?” (Pourquoi vouloir faire ceci ? Parce que cela. Et pourquoi cela ? etc.) permet en g\xe9n\xe9ral de remonter au besoin racine."}),"\n",(0,i.jsx)(s.li,{children:"Il faut aussi bien comprendre le contexte des utilisateurs, du provider de l'API, les aspects s\xe9curit\xe9 concern\xe9s (donn\xe9es sensibles ?) etc."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Ensuite il faut ",(0,i.jsx)(s.strong,{children:"linter"})," l'API :","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Examiner si le design propos\xe9 suit bien les guidelines."}),"\n",(0,i.jsx)(s.li,{children:"S'il est coh\xe9rent avec le reste de l'API (m\xeame si c'est pas encore \xe9crit dans les guidelines)."}),"\n",(0,i.jsx)(s.li,{children:"Si des erreurs de forme ne sont pas gliss\xe9es dedans. Par exemple des propri\xe9t\xe9s abr\xe9g\xe9es ou manifestement pas user friendly."}),"\n",(0,i.jsx)(s.li,{children:"Une partie peut \xeatre faite avec des outils automatiques pour gagner du temps."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Il faut reviewer le design du ",(0,i.jsx)(s.strong,{children:"point de vue du provider"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Il faut v\xe9rifier que l'API est extensible, s\xe9curis\xe9e et ne devrait \xe0 priori pas poser de probl\xe8mes de performance ou d'impl\xe9mentation."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Le reviewer du ",(0,i.jsx)(s.strong,{children:"point de vue du consommateur"}),".","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Se demander si on n'expose pas la structure interne du provider au lieu de r\xe9pondre au besoin de l'utilisateur. V\xe9rifier que l'API est facile \xe0 utiliser, que le flow est suffisamment simple etc."}),"\n",(0,i.jsx)(s.li,{children:"Obtenir du feedback des clients peut aussi avoir de la valeur pour obtenir une bonne API."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Et enfin une fois que l'impl\xe9mentation est faite (ou en cours), v\xe9rifier qu'elle correspond bien avec la sp\xe9cification de l'API.","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"\xc7a se fait avec des tests unitaires, et des tests au niveau de l'API."}),"\n",(0,i.jsx)(s.li,{children:"Il faut toujours r\xe9aliser les tests de s\xe9curit\xe9 (v\xe9rifier le contr\xf4le d'acc\xe8s, v\xe9rifier que les donn\xe9es sensibles ne fuitent pas)."}),"\n",(0,i.jsx)(s.li,{children:"Il faut tester que l'API fonctionne comme pr\xe9vu au runtime, pas seulement avec des techniques statiques sans faire tourner l'API."}),"\n",(0,i.jsx)(s.li,{children:"Il ne faut pas oublier de tester le caract\xe8re obligatoire des propri\xe9t\xe9s ou encore le fait qu'une valeur doive \xeatre entre un min et un max."}),"\n",(0,i.jsx)(s.li,{children:"Il faut tester l'API aussi dans toute la cha\xeene r\xe9seau pour v\xe9rifier que des proxis, pare-feux, routeurs ne nous causent pas de probl\xe8mes."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}let a=(0,r.n)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,l.R)(),e.components);return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)},pageOpts:{filePath:"pages/books/the-design-of-web-apis.mdx",route:"/books/the-design-of-web-apis",title:"The Design of Web APIs",headings:t},pageNextRoute:"/books/the-design-of-web-apis"})}},e=>{var s=s=>e(e.s=s);e.O(0,[301,636,593,792],()=>s(2700)),_N_E=e.O()}]);